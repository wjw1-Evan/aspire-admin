---
globs: Platform.ServiceDefaults/**/*.cs,Platform.ApiService/**/*.cs
description: 后端数据模型与软删除字段规范 - ITimestamped/ISoftDeletable/BaseEntity 字段要求
---
# 后端数据模型与软删除字段规范

本规则适用于后端 C# 代码，规范数据模型的时间戳与软删除字段，确保一致性。

## 必须字段与接口

- `ITimestamped` 必须包含：
  - `DateTime CreatedAt { get; set; }`
  - `DateTime UpdatedAt { get; set; }`
  - `DateTime? DeletedAt { get; set; }`

- `ISoftDeletable` 必须包含：
  - `bool IsDeleted { get; set; }`
  - `DateTime? DeletedAt { get; set; }`
  - `string? DeletedBy { get; set; }`
  - `string? DeletedReason { get; set; }`

- `BaseEntity` 必须包含（BSON 映射已配置）：
  - `Id`, `CreatedAt`, `UpdatedAt`, `IsDeleted`
  - `DeletedAt`, `DeletedBy`, `DeletedReason`
  - `CreatedBy`, `CreatedByUsername`, `UpdatedBy`, `UpdatedByUsername`

代码参考：
- [Platform.ServiceDefaults/Models/BaseEntity.cs](mdc:Platform.ServiceDefaults/Models/BaseEntity.cs)

## 编码要点

- 不要在实体上手动省略上述字段；按规范完整实现，便于审计与一致性。
- 软删除应仅切换 `IsDeleted=true` 并设置 `DeletedAt`、`DeletedBy`，不要直接物理删除（除非确有需要）。

## 关联规范

- 配合“数据工厂自动审计与时间戳规范”使用，避免在服务层手动维护时间戳与操作者信息。
