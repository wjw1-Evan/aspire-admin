---
globs: Platform.ApiService/Services/*.cs,Platform.ServiceDefaults/Services/*.cs
description: è®¾è®¡æ¨¡å¼å’Œæ¶æ„åŸåˆ™è§„èŒƒ
---
# è®¾è®¡æ¨¡å¼å’Œæ¶æ„åŸåˆ™è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### éµå¾ª SOLID åŸåˆ™å’Œå¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼Œæ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•çš„è½¯ä»¶æ¶æ„

## âœ… SOLID åŸåˆ™åº”ç”¨

### å•ä¸€èŒè´£åŸåˆ™ (SRP)

```csharp
// âœ… æ­£ç¡® - å•ä¸€èŒè´£
public class UserService : IUserService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;
    private readonly ILogger<UserService> _logger;

    public UserService(
        IDatabaseOperationFactory<User> userFactory,
        ILogger<UserService> logger)
    {
        _userFactory = userFactory;
        _logger = logger;
    }

    // åªè´Ÿè´£ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        await ValidateCreateUserRequestAsync(request);
        
        var user = new User
        {
            Username = request.Username,
            Email = request.Email,
            CompanyId = _userFactory.GetRequiredCompanyId(),
            CreatedBy = _userFactory.GetCurrentUserId(),
            CreatedAt = DateTime.UtcNow
        };
        
        return await _userFactory.CreateAsync(user);
    }

    public async Task<User?> GetUserByIdAsync(string id)
    {
        if (string.IsNullOrEmpty(id))
            throw new ArgumentException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º", nameof(id));

        return await _userFactory.GetByIdAsync(id);
    }

    private async Task ValidateCreateUserRequestAsync(CreateUserRequest request)
    {
        if (string.IsNullOrEmpty(request.Username))
            throw new ArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º", nameof(request.Username));
    }
}

// âŒ é”™è¯¯ - è¿åå•ä¸€èŒè´£
public class UserService : IUserService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;
    private readonly IDatabaseOperationFactory<Role> _roleFactory;
    private readonly IDatabaseOperationFactory<Company> _companyFactory;
    private readonly IEmailService _emailService;
    private readonly IFileService _fileService;

    // è´Ÿè´£å¤ªå¤šèŒè´£ï¼šç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€ä¼ä¸šç®¡ç†ã€é‚®ä»¶å‘é€ã€æ–‡ä»¶å¤„ç†
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        // ç”¨æˆ·åˆ›å»ºé€»è¾‘
        var user = await _userFactory.CreateAsync(new User());
        
        // è§’è‰²åˆ†é…é€»è¾‘
        await _roleFactory.CreateAsync(new Role());
        
        // ä¼ä¸šå…³è”é€»è¾‘
        await _companyFactory.CreateAsync(new Company());
        
        // é‚®ä»¶å‘é€é€»è¾‘
        await _emailService.SendWelcomeEmailAsync(user.Email);
        
        // æ–‡ä»¶å¤„ç†é€»è¾‘
        await _fileService.CreateUserFolderAsync(user.Id);
        
        return user;
    }
}
```

### å¼€é—­åŸåˆ™ (OCP)

```csharp
// âœ… æ­£ç¡® - å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
public interface IUserValidator
{
    Task<bool> ValidateAsync(User user);
}

public class BasicUserValidator : IUserValidator
{
    public async Task<bool> ValidateAsync(User user)
    {
        return !string.IsNullOrEmpty(user.Username) && 
               !string.IsNullOrEmpty(user.Email);
    }
}

public class AdvancedUserValidator : IUserValidator
{
    private readonly IUserValidator _basicValidator;
    private readonly IEmailService _emailService;

    public AdvancedUserValidator(IUserValidator basicValidator, IEmailService emailService)
    {
        _basicValidator = basicValidator;
        _emailService = emailService;
    }

    public async Task<bool> ValidateAsync(User user)
    {
        // åŸºç¡€éªŒè¯
        if (!await _basicValidator.ValidateAsync(user))
            return false;

        // é«˜çº§éªŒè¯
        return await _emailService.ValidateEmailAsync(user.Email);
    }
}

public class UserService : IUserService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;
    private readonly IUserValidator _userValidator;

    public UserService(
        IDatabaseOperationFactory<User> userFactory,
        IUserValidator userValidator)
    {
        _userFactory = userFactory;
        _userValidator = userValidator;
    }

    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email
        };

        // ä½¿ç”¨å¯æ‰©å±•çš„éªŒè¯å™¨
        if (!await _userValidator.ValidateAsync(user))
            throw new ArgumentException("ç”¨æˆ·éªŒè¯å¤±è´¥");

        return await _userFactory.CreateAsync(user);
    }
}

// âŒ é”™è¯¯ - è¿åå¼€é—­åŸåˆ™
public class UserService : IUserService
{
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email
        };

        // ç¡¬ç¼–ç éªŒè¯é€»è¾‘ï¼Œéš¾ä»¥æ‰©å±•
        if (string.IsNullOrEmpty(user.Username))
            throw new ArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");

        if (string.IsNullOrEmpty(user.Email))
            throw new ArgumentException("é‚®ç®±ä¸èƒ½ä¸ºç©º");

        // å¦‚æœéœ€è¦æ·»åŠ æ–°çš„éªŒè¯è§„åˆ™ï¼Œå¿…é¡»ä¿®æ”¹è¿™ä¸ªæ–¹æ³•
        return await _userFactory.CreateAsync(user);
    }
}
```

### é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)

```csharp
// âœ… æ­£ç¡® - å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
public abstract class BaseService
{
    protected readonly ILogger Logger;

    protected BaseService(ILogger logger)
    {
        Logger = logger;
    }

    public abstract Task<bool> ValidateAsync();
}

public class UserService : BaseService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;

    public UserService(
        IDatabaseOperationFactory<User> userFactory,
        ILogger<UserService> logger)
        : base(logger)
    {
        _userFactory = userFactory;
    }

    public override async Task<bool> ValidateAsync()
    {
        // ç”¨æˆ·æœåŠ¡ç‰¹å®šçš„éªŒè¯é€»è¾‘
        var userCount = await _userFactory.CountAsync();
        return userCount >= 0;
    }
}

public class RoleService : BaseService
{
    private readonly IDatabaseOperationFactory<Role> _roleFactory;

    public RoleService(
        IDatabaseOperationFactory<Role> roleFactory,
        ILogger<RoleService> logger)
        : base(logger)
    {
        _roleFactory = roleFactory;
    }

    public override async Task<bool> ValidateAsync()
    {
        // è§’è‰²æœåŠ¡ç‰¹å®šçš„éªŒè¯é€»è¾‘
        var roleCount = await _roleFactory.CountAsync();
        return roleCount >= 0;
    }
}

// ä½¿ç”¨åŸºç±»å¼•ç”¨ï¼Œå­ç±»å¯ä»¥æ­£ç¡®æ›¿æ¢
public class ServiceValidator
{
    private readonly BaseService _service;

    public ServiceValidator(BaseService service)
    {
        _service = service;
    }

    public async Task<bool> ValidateService()
    {
        return await _service.ValidateAsync();
    }
}

// âŒ é”™è¯¯ - è¿åé‡Œæ°æ›¿æ¢åŸåˆ™
public abstract class BaseService
{
    public abstract Task<bool> ValidateAsync();
}

public class UserService : BaseService
{
    public override async Task<bool> ValidateAsync()
    {
        // æŠ›å‡ºå¼‚å¸¸ï¼Œè¿åäº†LSP
        throw new NotImplementedException("ç”¨æˆ·æœåŠ¡éªŒè¯æœªå®ç°");
    }
}
```

### æ¥å£éš”ç¦»åŸåˆ™ (ISP)

```csharp
// âœ… æ­£ç¡® - æ¥å£éš”ç¦»
public interface IUserReader
{
    Task<User?> GetUserByIdAsync(string id);
    Task<List<User>> GetUsersAsync(UserListRequest request);
}

public interface IUserWriter
{
    Task<User> CreateUserAsync(CreateUserRequest request);
    Task<bool> UpdateUserAsync(UpdateUserRequest request);
    Task<bool> DeleteUserAsync(string id);
}

public interface IUserValidator
{
    Task<bool> ValidateUserAsync(User user);
}

public class UserService : IUserReader, IUserWriter, IUserValidator
{
    private readonly IDatabaseOperationFactory<User> _userFactory;

    public UserService(IDatabaseOperationFactory<User> userFactory)
    {
        _userFactory = userFactory;
    }

    // IUserReader å®ç°
    public async Task<User?> GetUserByIdAsync(string id)
    {
        return await _userFactory.GetByIdAsync(id);
    }

    public async Task<List<User>> GetUsersAsync(UserListRequest request)
    {
        var filter = _userFactory.CreateFilterBuilder()
            .ExcludeDeleted()
            .WithTenant()
            .Build();

        return await _userFactory.FindAsync(filter);
    }

    // IUserWriter å®ç°
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email,
            CompanyId = _userFactory.GetRequiredCompanyId(),
            CreatedBy = _userFactory.GetCurrentUserId(),
            CreatedAt = DateTime.UtcNow
        };

        return await _userFactory.CreateAsync(user);
    }

    public async Task<bool> UpdateUserAsync(UpdateUserRequest request)
    {
        var user = await _userFactory.GetByIdAsync(request.Id);
        if (user == null)
            return false;

        var update = _userFactory.CreateUpdateBuilder()
            .Set(u => u.Username, request.Username)
            .SetCurrentTimestamp()
            .SetOperationTracking(_userFactory.GetCurrentUserId(), _userFactory.GetCurrentUsername())
            .Build();

        return await _userFactory.UpdateAsync(user, new OperationContext
        {
            UserId = _userFactory.GetCurrentUserId(),
            Username = _userFactory.GetCurrentUsername(),
            CompanyId = _userFactory.GetCurrentCompanyId(),
            OperationType = OperationType.Update,
            Description = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯"
        });
    }

    public async Task<bool> DeleteUserAsync(string id)
    {
        return await _userFactory.SoftDeleteAsync(id, new OperationContext
        {
            UserId = _userFactory.GetCurrentUserId(),
            Username = _userFactory.GetCurrentUsername(),
            CompanyId = _userFactory.GetCurrentCompanyId(),
            OperationType = OperationType.Delete,
            Description = "åˆ é™¤ç”¨æˆ·"
        });
    }

    // IUserValidator å®ç°
    public async Task<bool> ValidateUserAsync(User user)
    {
        return !string.IsNullOrEmpty(user.Username) && 
               !string.IsNullOrEmpty(user.Email);
    }
}

// âŒ é”™è¯¯ - è¿åæ¥å£éš”ç¦»åŸåˆ™
public interface IUserService
{
    // æ¥å£è¿‡äºåºå¤§ï¼ŒåŒ…å«äº†å¤ªå¤šä¸ç›¸å…³çš„æ–¹æ³•
    Task<User?> GetUserByIdAsync(string id);
    Task<List<User>> GetUsersAsync(UserListRequest request);
    Task<User> CreateUserAsync(CreateUserRequest request);
    Task<bool> UpdateUserAsync(UpdateUserRequest request);
    Task<bool> DeleteUserAsync(string id);
    Task<bool> ValidateUserAsync(User user);
    Task<bool> SendEmailAsync(string email);
    Task<bool> UploadFileAsync(string fileName, byte[] content);
    Task<bool> ProcessPaymentAsync(decimal amount);
}
```

### ä¾èµ–å€’ç½®åŸåˆ™ (DIP)

```csharp
// âœ… æ­£ç¡® - ä¾èµ–å€’ç½®
public interface IUserRepository
{
    Task<User?> GetByIdAsync(string id);
    Task<List<User>> FindAsync(FilterDefinition<User> filter);
    Task<User> CreateAsync(User user);
    Task<bool> UpdateAsync(User user);
    Task<bool> DeleteAsync(string id);
}

public interface IUserValidator
{
    Task<bool> ValidateAsync(User user);
}

public interface IUserLogger
{
    Task LogUserOperationAsync(string operation, string userId, object data);
}

public class UserService : IUserService
{
    private readonly IUserRepository _userRepository;
    private readonly IUserValidator _userValidator;
    private readonly IUserLogger _userLogger;

    // ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°
    public UserService(
        IUserRepository userRepository,
        IUserValidator userValidator,
        IUserLogger userLogger)
    {
        _userRepository = userRepository;
        _userValidator = userValidator;
        _userLogger = userLogger;
    }

    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email
        };

        // ä½¿ç”¨æŠ½è±¡æ¥å£
        if (!await _userValidator.ValidateAsync(user))
            throw new ArgumentException("ç”¨æˆ·éªŒè¯å¤±è´¥");

        var createdUser = await _userRepository.CreateAsync(user);
        
        await _userLogger.LogUserOperationAsync("åˆ›å»ºç”¨æˆ·", createdUser.Id, new { Username = request.Username });
        
        return createdUser;
    }
}

// âŒ é”™è¯¯ - è¿åä¾èµ–å€’ç½®åŸåˆ™
public class UserService : IUserService
{
    private readonly MongoDbUserRepository _userRepository;
    private readonly EmailUserValidator _userValidator;
    private readonly FileUserLogger _userLogger;

    // ä¾èµ–å…·ä½“å®ç°
    public UserService(
        MongoDbUserRepository userRepository,
        EmailUserValidator userValidator,
        FileUserLogger userLogger)
    {
        _userRepository = userRepository;
        _userValidator = userValidator;
        _userLogger = userLogger;
    }
}
```

## ğŸ¯ å¸¸ç”¨è®¾è®¡æ¨¡å¼

### å·¥å‚æ¨¡å¼

```csharp
// âœ… æ­£ç¡® - å·¥å‚æ¨¡å¼
public interface IDatabaseOperationFactory<T> where T : class, IEntity, ISoftDeletable, ITimestamped
{
    FilterBuilder<T> CreateFilterBuilder();
    SortBuilder<T> CreateSortBuilder();
    UpdateBuilder<T> CreateUpdateBuilder();
    OperationContextBuilder CreateOperationContext();
    
    Task<T> CreateAsync(T entity, OperationContext? context = null);
    Task<List<T>> CreateManyAsync(IEnumerable<T> entities, OperationContext? context = null);
    Task<bool> UpdateAsync(T entity, OperationContext? context = null);
    Task<List<T>> FindAsync(FilterDefinition<T>? filter = null, SortDefinition<T>? sort = null, int? limit = null);
}

public class DatabaseOperationFactory<T> : IDatabaseOperationFactory<T> where T : class, IEntity, ISoftDeletable, ITimestamped
{
    private readonly IMongoCollection<T> _collection;
    private readonly IAuditService _auditService;
    private readonly ITenantContext _tenantContext;

    public DatabaseOperationFactory(
        IMongoCollection<T> collection,
        IAuditService auditService,
        ITenantContext tenantContext)
    {
        _collection = collection;
        _auditService = auditService;
        _tenantContext = tenantContext;
    }

    public FilterBuilder<T> CreateFilterBuilder()
    {
        return new FilterBuilder<T>();
    }

    public SortBuilder<T> CreateSortBuilder()
    {
        return new SortBuilder<T>();
    }

    public UpdateBuilder<T> CreateUpdateBuilder()
    {
        return new UpdateBuilder<T>();
    }

    public OperationContextBuilder CreateOperationContext()
    {
        return new OperationContextBuilder()
            .WithUser(_tenantContext.GetCurrentUserId(), _tenantContext.GetCurrentUsername())
            .WithCompany(_tenantContext.GetCurrentCompanyId());
    }

    public async Task<T> CreateAsync(T entity, OperationContext? context = null)
    {
        // è®¾ç½®æ“ä½œè·Ÿè¸ªä¿¡æ¯
        if (entity is IOperationTrackable trackable)
        {
            trackable.CreatedBy = context?.UserId ?? _tenantContext.GetCurrentUserId();
            trackable.CreatedByUsername = context?.Username ?? _tenantContext.GetCurrentUsername();
            trackable.LastOperationType = OperationType.Create.ToString();
            trackable.LastOperationAt = DateTime.UtcNow;
        }

        // è®¾ç½®æ—¶é—´æˆ³
        if (entity is ITimestamped timestamped)
        {
            timestamped.CreatedAt = DateTime.UtcNow;
            timestamped.UpdatedAt = DateTime.UtcNow;
        }

        // è®¾ç½®å¤šç§Ÿæˆ·ä¿¡æ¯
        if (entity is IMultiTenant multiTenant)
        {
            multiTenant.CompanyId = context?.CompanyId ?? _tenantContext.GetCurrentCompanyId();
        }

        await _collection.InsertOneAsync(entity);

        // è®°å½•å®¡è®¡æ—¥å¿—
        if (context != null)
        {
            await _auditService.RecordOperationAsync<T>(entity, OperationType.Create, context);
        }

        return entity;
    }

    // å…¶ä»–æ–¹æ³•å®ç°...
}
```

### ç­–ç•¥æ¨¡å¼

```csharp
// âœ… æ­£ç¡® - ç­–ç•¥æ¨¡å¼
public interface IUserValidationStrategy
{
    Task<bool> ValidateAsync(User user);
    string GetValidationType();
}

public class BasicUserValidationStrategy : IUserValidationStrategy
{
    public async Task<bool> ValidateAsync(User user)
    {
        return !string.IsNullOrEmpty(user.Username) && 
               !string.IsNullOrEmpty(user.Email);
    }

    public string GetValidationType()
    {
        return "Basic";
    }
}

public class AdvancedUserValidationStrategy : IUserValidationStrategy
{
    private readonly IEmailService _emailService;

    public AdvancedUserValidationStrategy(IEmailService emailService)
    {
        _emailService = emailService;
    }

    public async Task<bool> ValidateAsync(User user)
    {
        if (string.IsNullOrEmpty(user.Username) || string.IsNullOrEmpty(user.Email))
            return false;

        return await _emailService.ValidateEmailAsync(user.Email);
    }

    public string GetValidationType()
    {
        return "Advanced";
    }
}

public class UserValidationContext
{
    private readonly IUserValidationStrategy _strategy;

    public UserValidationContext(IUserValidationStrategy strategy)
    {
        _strategy = strategy;
    }

    public async Task<bool> ValidateUserAsync(User user)
    {
        return await _strategy.ValidateAsync(user);
    }

    public string GetValidationType()
    {
        return _strategy.GetValidationType();
    }
}

public class UserService : IUserService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;
    private readonly UserValidationContext _validationContext;

    public UserService(
        IDatabaseOperationFactory<User> userFactory,
        UserValidationContext validationContext)
    {
        _userFactory = userFactory;
        _validationContext = validationContext;
    }

    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email
        };

        if (!await _validationContext.ValidateUserAsync(user))
            throw new ArgumentException("ç”¨æˆ·éªŒè¯å¤±è´¥");

        return await _userFactory.CreateAsync(user);
    }
}
```

### è§‚å¯Ÿè€…æ¨¡å¼

```csharp
// âœ… æ­£ç¡® - è§‚å¯Ÿè€…æ¨¡å¼
public interface IUserEvent
{
    string EventType { get; }
    string UserId { get; }
    DateTime Timestamp { get; }
}

public class UserCreatedEvent : IUserEvent
{
    public string EventType => "UserCreated";
    public string UserId { get; }
    public DateTime Timestamp { get; }
    public string Username { get; }
    public string Email { get; }

    public UserCreatedEvent(string userId, string username, string email)
    {
        UserId = userId;
        Username = username;
        Email = email;
        Timestamp = DateTime.UtcNow;
    }
}

public interface IUserEventHandler
{
    Task HandleAsync(IUserEvent userEvent);
}

public class EmailNotificationHandler : IUserEventHandler
{
    private readonly IEmailService _emailService;

    public EmailNotificationHandler(IEmailService emailService)
    {
        _emailService = emailService;
    }

    public async Task HandleAsync(IUserEvent userEvent)
    {
        if (userEvent is UserCreatedEvent createdEvent)
        {
            await _emailService.SendWelcomeEmailAsync(createdEvent.Email);
        }
    }
}

public class AuditLogHandler : IUserEventHandler
{
    private readonly IAuditService _auditService;

    public AuditLogHandler(IAuditService auditService)
    {
        _auditService = auditService;
    }

    public async Task HandleAsync(IUserEvent userEvent)
    {
        await _auditService.RecordEventAsync(userEvent);
    }
}

public class UserEventPublisher
{
    private readonly List<IUserEventHandler> _handlers;

    public UserEventPublisher()
    {
        _handlers = new List<IUserEventHandler>();
    }

    public void Subscribe(IUserEventHandler handler)
    {
        _handlers.Add(handler);
    }

    public async Task PublishAsync(IUserEvent userEvent)
    {
        foreach (var handler in _handlers)
        {
            try
            {
                await handler.HandleAsync(userEvent);
            }
            catch (Exception ex)
            {
                // è®°å½•é”™è¯¯ä½†ä¸å½±å“å…¶ä»–å¤„ç†å™¨
                Console.WriteLine($"Error handling event {userEvent.EventType}: {ex.Message}");
            }
        }
    }
}

public class UserService : IUserService
{
    private readonly IDatabaseOperationFactory<User> _userFactory;
    private readonly UserEventPublisher _eventPublisher;

    public UserService(
        IDatabaseOperationFactory<User> userFactory,
        UserEventPublisher eventPublisher)
    {
        _userFactory = userFactory;
        _eventPublisher = eventPublisher;
    }

    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User
        {
            Username = request.Username,
            Email = request.Email,
            CompanyId = _userFactory.GetRequiredCompanyId(),
            CreatedBy = _userFactory.GetCurrentUserId(),
            CreatedAt = DateTime.UtcNow
        };

        var createdUser = await _userFactory.CreateAsync(user);

        // å‘å¸ƒäº‹ä»¶
        var userEvent = new UserCreatedEvent(createdUser.Id, createdUser.Username, createdUser.Email);
        await _eventPublisher.PublishAsync(userEvent);

        return createdUser;
    }
}
```

## ğŸš« ç¦æ­¢çš„åšæ³•

### ä¸è¦è¿åå•ä¸€èŒè´£åŸåˆ™

```csharp
// âŒ é”™è¯¯ - è¿åå•ä¸€èŒè´£
public class UserService : IUserService
{
    // è´Ÿè´£å¤ªå¤šèŒè´£
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        // ç”¨æˆ·åˆ›å»º
        var user = await _userFactory.CreateAsync(new User());
        
        // è§’è‰²åˆ†é…
        await _roleFactory.CreateAsync(new Role());
        
        // é‚®ä»¶å‘é€
        await _emailService.SendEmailAsync(user.Email);
        
        // æ–‡ä»¶å¤„ç†
        await _fileService.CreateFolderAsync(user.Id);
        
        return user;
    }
}

// âœ… æ­£ç¡® - å•ä¸€èŒè´£
public class UserService : IUserService
{
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        // åªè´Ÿè´£ç”¨æˆ·åˆ›å»º
        var user = new User
        {
            Username = request.Username,
            Email = request.Email
        };
        
        return await _userFactory.CreateAsync(user);
    }
}
```

### ä¸è¦ç¡¬ç¼–ç ä¾èµ–

```csharp
// âŒ é”™è¯¯ - ç¡¬ç¼–ç ä¾èµ–
public class UserService : IUserService
{
    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        // ç¡¬ç¼–ç ä¾èµ–å…·ä½“å®ç°
        var mongoDb = new MongoDbUserRepository();
        var emailValidator = new EmailUserValidator();
        var fileLogger = new FileUserLogger();
        
        var user = new User { Username = request.Username };
        return await mongoDb.CreateAsync(user);
    }
}

// âœ… æ­£ç¡® - ä¾èµ–æ³¨å…¥
public class UserService : IUserService
{
    private readonly IUserRepository _userRepository;
    private readonly IUserValidator _userValidator;
    private readonly IUserLogger _userLogger;

    public UserService(
        IUserRepository userRepository,
        IUserValidator userValidator,
        IUserLogger userLogger)
    {
        _userRepository = userRepository;
        _userValidator = userValidator;
        _userLogger = userLogger;
    }

    public async Task<User> CreateUserAsync(CreateUserRequest request)
    {
        var user = new User { Username = request.Username };
        return await _userRepository.CreateAsync(user);
    }
}
```

### ä¸è¦å¿½ç•¥æ¥å£éš”ç¦»

```csharp
// âŒ é”™è¯¯ - æ¥å£è¿‡äºåºå¤§
public interface IUserService
{
    // åŒ…å«äº†å¤ªå¤šä¸ç›¸å…³çš„æ–¹æ³•
    Task<User> CreateUserAsync(CreateUserRequest request);
    Task<bool> UpdateUserAsync(UpdateUserRequest request);
    Task<bool> DeleteUserAsync(string id);
    Task<bool> SendEmailAsync(string email);
    Task<bool> UploadFileAsync(string fileName, byte[] content);
    Task<bool> ProcessPaymentAsync(decimal amount);
}

// âœ… æ­£ç¡® - æ¥å£éš”ç¦»
public interface IUserService
{
    Task<User> CreateUserAsync(CreateUserRequest request);
    Task<bool> UpdateUserAsync(UpdateUserRequest request);
    Task<bool> DeleteUserAsync(string id);
}

public interface IEmailService
{
    Task<bool> SendEmailAsync(string email);
}

public interface IFileService
{
    Task<bool> UploadFileAsync(string fileName, byte[] content);
}

public interface IPaymentService
{
    Task<bool> ProcessPaymentAsync(decimal amount);
}
```

## ğŸ“‹ è®¾è®¡æ¨¡å¼å¼€å‘æ£€æŸ¥æ¸…å•

åˆ›å»ºæˆ–ä¿®æ”¹ä»£ç æ—¶æ£€æŸ¥ï¼š

- [ ] éµå¾ª SOLID åŸåˆ™
- [ ] ä½¿ç”¨é€‚å½“çš„è®¾è®¡æ¨¡å¼
- [ ] ä¿æŒå•ä¸€èŒè´£
- [ ] ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°
- [ ] æ¥å£è®¾è®¡åˆç†
- [ ] ä»£ç å¯æ‰©å±•æ€§
- [ ] ä»£ç å¯ç»´æŠ¤æ€§
- [ ] ä»£ç å¯æµ‹è¯•æ€§
- [ ] é¿å…è¿‡åº¦è®¾è®¡
- [ ] æ–‡æ¡£åŒ–è®¾è®¡å†³ç­–

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç”¨æˆ·æœåŠ¡å®ç°](mdc:Platform.ApiService/Services/UserService.cs)
- [è§’è‰²æœåŠ¡å®ç°](mdc:Platform.ApiService/Services/RoleService.cs)
- [ä¼ä¸šæœåŠ¡å®ç°](mdc:Platform.ApiService/Services/CompanyService.cs)
- [è®¾è®¡æ¨¡å¼å‚è€ƒ](https://refactoring.guru/design-patterns)
