---
globs: Platform.Admin/src/components/*.tsx,Platform.App/components/*.tsx
description: å‰ç«¯ç»„ä»¶è®¾è®¡æ¨¡å¼è§„èŒƒ
---

# å‰ç«¯ç»„ä»¶è®¾è®¡æ¨¡å¼è§„èŒƒ

## ğŸ¯ æ¦‚è¿°

åŸºäº React ç»„ä»¶è®¾è®¡åŸåˆ™ï¼Œæä¾›ç»Ÿä¸€çš„ç»„ä»¶è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ—ï¸ ç»„ä»¶æ¶æ„æ¨¡å¼

### ç»„ä»¶åˆ†å±‚æ¶æ„

```typescript
// âœ… ç»„ä»¶åˆ†å±‚æ¶æ„
// 1. é¡µé¢ç»„ä»¶ (Pages) - ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†
// 2. å®¹å™¨ç»„ä»¶ (Containers) - æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†
// 3. å±•ç¤ºç»„ä»¶ (Presentational) - çº¯å±•ç¤ºé€»è¾‘
// 4. åŸºç¡€ç»„ä»¶ (Base) - å¯å¤ç”¨çš„åŸºç¡€ç»„ä»¶
// 5. å¸ƒå±€ç»„ä»¶ (Layout) - é¡µé¢å¸ƒå±€ç»“æ„
```

### ç»„ä»¶è®¾è®¡åŸåˆ™

```typescript
// âœ… å•ä¸€èŒè´£åŸåˆ™
interface UserCardProps {
  user: User;
  onEdit: (user: User) => void;
  onDelete: (userId: string) => void;
}

// åªè´Ÿè´£ç”¨æˆ·ä¿¡æ¯çš„å±•ç¤ºå’ŒåŸºæœ¬æ“ä½œ
export const UserCard: React.FC<UserCardProps> = ({ user, onEdit, onDelete }) => {
  return (
    <Card>
      <CardHeader>
        <Avatar src={user.avatar} />
        <Typography>{user.name}</Typography>
      </CardHeader>
      <CardActions>
        <Button onClick={() => onEdit(user)}>ç¼–è¾‘</Button>
        <Button onClick={() => onDelete(user.id)}>åˆ é™¤</Button>
      </CardActions>
    </Card>
  );
};
```

## âœ… æ¨èåšæ³•

### 1. é«˜é˜¶ç»„ä»¶ (HOC) æ¨¡å¼

```typescript
// âœ… é«˜é˜¶ç»„ä»¶æ¨¡å¼
interface WithLoadingProps {
  loading: boolean;
}

export function withLoading<P extends object>(
  Component: React.ComponentType<P>
): React.ComponentType<P & WithLoadingProps> {
  return function WithLoadingComponent(props: P & WithLoadingProps) {
    const { loading, ...restProps } = props;
    
    if (loading) {
      return <LoadingSpinner />;
    }
    
    return <Component {...(restProps as P)} />;
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const UserListWithLoading = withLoading(UserList);

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
<UserListWithLoading users={users} loading={isLoading} />
```

### 2. æ¸²æŸ“å±æ€§ (Render Props) æ¨¡å¼

```typescript
// âœ… æ¸²æŸ“å±æ€§æ¨¡å¼
interface DataFetcherProps<T> {
  url: string;
  children: (data: {
    data: T | null;
    loading: boolean;
    error: string | null;
    refetch: () => void;
  }) => React.ReactNode;
}

export function DataFetcher<T>({ url, children }: DataFetcherProps<T>) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchData = useCallback(async () => {
    setLoading(true);
    setError(null);
    try {
      const response = await fetch(url);
      const result = await response.json();
      setData(result);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  }, [url]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return <>{children({ data, loading, error, refetch: fetchData })}</>;
}

// ä½¿ç”¨ç¤ºä¾‹
<DataFetcher<User[]> url="/api/users">
  {({ data, loading, error, refetch }) => (
    <div>
      {loading && <LoadingSpinner />}
      {error && <ErrorMessage message={error} />}
      {data && <UserList users={data} />}
      <Button onClick={refetch}>åˆ·æ–°</Button>
    </div>
  )}
</DataFetcher>
```

### 3. è‡ªå®šä¹‰ Hooks æ¨¡å¼

```typescript
// âœ… è‡ªå®šä¹‰ Hooks æ¨¡å¼
export const useUser = (userId: string) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchUser = useCallback(async () => {
    setLoading(true);
    setError(null);
    try {
      const userData = await userService.getUserById(userId);
      setUser(userData);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  }, [userId]);

  const updateUser = useCallback(async (userData: Partial<User>) => {
    try {
      const updatedUser = await userService.updateUser(userId, userData);
      setUser(updatedUser);
    } catch (err) {
      setError(err.message);
    }
  }, [userId]);

  useEffect(() => {
    fetchUser();
  }, [fetchUser]);

  return { user, loading, error, updateUser, refetch: fetchUser };
};

// ä½¿ç”¨ç¤ºä¾‹
const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
  const { user, loading, error, updateUser } = useUser(userId);

  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;
  if (!user) return <NotFound />;

  return <UserProfileForm user={user} onUpdate={updateUser} />;
};
```

### 4. å¤åˆç»„ä»¶æ¨¡å¼

```typescript
// âœ… å¤åˆç»„ä»¶æ¨¡å¼
interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;
}

interface ModalContextType {
  isOpen: boolean;
  onClose: () => void;
}

const ModalContext = createContext<ModalContextType | undefined>(undefined);

export const Modal: React.FC<ModalProps> & {
  Header: React.FC<{ children: React.ReactNode }>;
  Body: React.FC<{ children: React.ReactNode }>;
  Footer: React.FC<{ children: React.ReactNode }>;
} = ({ isOpen, onClose, children }) => {
  const contextValue = useMemo(() => ({ isOpen, onClose }), [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <ModalContext.Provider value={contextValue}>
      <div className="modal-overlay">
        <div className="modal-content">
          {children}
        </div>
      </div>
    </ModalContext.Provider>
  );
};

Modal.Header = ({ children }) => {
  const { onClose } = useContext(ModalContext)!;
  return (
    <div className="modal-header">
      {children}
      <button onClick={onClose}>Ã—</button>
    </div>
  );
};

Modal.Body = ({ children }) => (
  <div className="modal-body">{children}</div>
);

Modal.Footer = ({ children }) => (
  <div className="modal-footer">{children}</div>
);

// ä½¿ç”¨ç¤ºä¾‹
<Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)}>
  <Modal.Header>
    <h2>ç¼–è¾‘ç”¨æˆ·</h2>
  </Modal.Header>
  <Modal.Body>
    <UserForm user={user} onSubmit={handleSubmit} />
  </Modal.Body>
  <Modal.Footer>
    <Button onClick={() => setIsModalOpen(false)}>å–æ¶ˆ</Button>
    <Button type="submit" form="user-form">ä¿å­˜</Button>
  </Modal.Footer>
</Modal>
```

### 5. æä¾›è€…æ¨¡å¼

```typescript
// âœ… æä¾›è€…æ¨¡å¼
interface ThemeProviderProps {
  children: React.ReactNode;
  defaultTheme?: Theme;
}

export const ThemeProvider: React.FC<ThemeProviderProps> = ({
  children,
  defaultTheme = 'light'
}) => {
  const [theme, setTheme] = useState<Theme>(defaultTheme);

  const toggleTheme = useCallback(() => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  }, []);

  const value = useMemo(() => ({
    theme,
    toggleTheme,
    isDark: theme === 'dark',
    isLight: theme === 'light'
  }), [theme, toggleTheme]);

  return (
    <ThemeContext.Provider value={value}>
      <div className={`theme-${theme}`}>
        {children}
      </div>
    </ThemeContext.Provider>
  );
};

// ä½¿ç”¨ç¤ºä¾‹
<ThemeProvider defaultTheme="light">
  <App />
</ThemeProvider>
```

### 6. è§‚å¯Ÿè€…æ¨¡å¼

```typescript
// âœ… è§‚å¯Ÿè€…æ¨¡å¼
interface EventEmitter {
  on(event: string, callback: Function): void;
  off(event: string, callback: Function): void;
  emit(event: string, data?: any): void;
}

class EventBus implements EventEmitter {
  private events: Map<string, Function[]> = new Map();

  on(event: string, callback: Function): void {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(callback);
  }

  off(event: string, callback: Function): void {
    const callbacks = this.events.get(event);
    if (callbacks) {
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    }
  }

  emit(event: string, data?: any): void {
    const callbacks = this.events.get(event);
    if (callbacks) {
      callbacks.forEach(callback => callback(data));
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const eventBus = new EventBus();

// ç»„ä»¶ä¸­ç›‘å¬äº‹ä»¶
useEffect(() => {
  const handleUserUpdate = (user: User) => {
    setUser(user);
  };

  eventBus.on('user:updated', handleUserUpdate);
  return () => eventBus.off('user:updated', handleUserUpdate);
}, []);

// è§¦å‘äº‹ä»¶
const updateUser = (user: User) => {
  eventBus.emit('user:updated', user);
};
```

## âŒ é¿å…çš„åšæ³•

### 1. ä¸è¦åˆ›å»ºè¿‡å¤§çš„ç»„ä»¶

```typescript
// âŒ é”™è¯¯ï¼šè¿‡å¤§çš„ç»„ä»¶
export const UserManagement: React.FC = () => {
  // 500+ è¡Œä»£ç 
  // åŒ…å«ç”¨æˆ·åˆ—è¡¨ã€ç¼–è¾‘è¡¨å•ã€åˆ é™¤ç¡®è®¤ç­‰æ‰€æœ‰é€»è¾‘
  return (
    <div>
      {/* å¤§é‡ JSX */}
    </div>
  );
};

// âœ… æ­£ç¡®ï¼šæ‹†åˆ†ä¸ºå°ç»„ä»¶
export const UserManagement: React.FC = () => {
  return (
    <div>
      <UserList />
      <UserForm />
      <UserDeleteConfirm />
    </div>
  );
};
```

### 2. ä¸è¦ç›´æ¥æ“ä½œ DOM

```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥æ“ä½œ DOM
export const UserCard: React.FC<UserCardProps> = ({ user }) => {
  useEffect(() => {
    const element = document.getElementById(`user-${user.id}`);
    element?.addEventListener('click', handleClick);
    return () => element?.removeEventListener('click', handleClick);
  }, [user.id]);

  return <div id={`user-${user.id}`}>{user.name}</div>;
};

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ React äº‹ä»¶å¤„ç†
export const UserCard: React.FC<UserCardProps> = ({ user, onClick }) => {
  return <div onClick={onClick}>{user.name}</div>;
};
```

### 3. ä¸è¦å¿½ç•¥æ€§èƒ½ä¼˜åŒ–

```typescript
// âŒ é”™è¯¯ï¼šå¿½ç•¥æ€§èƒ½ä¼˜åŒ–
export const UserList: React.FC<{ users: User[] }> = ({ users }) => {
  return (
    <div>
      {users.map(user => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  );
};

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ€§èƒ½ä¼˜åŒ–
export const UserList: React.FC<{ users: User[] }> = ({ users }) => {
  const UserCard = memo(({ user }: { user: User }) => (
    <div>{user.name}</div>
  ));

  return (
    <div>
      {users.map(user => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  );
};
```

### 4. ä¸è¦å¿½ç•¥é”™è¯¯è¾¹ç•Œ

```typescript
// âŒ é”™è¯¯ï¼šæ²¡æœ‰é”™è¯¯è¾¹ç•Œ
export const App: React.FC = () => {
  return (
    <div>
      <UserManagement />
      <ProductManagement />
    </div>
  );
};

// âœ… æ­£ç¡®ï¼šæ·»åŠ é”™è¯¯è¾¹ç•Œ
export const App: React.FC = () => {
  return (
    <ErrorBoundary>
      <div>
        <UserManagement />
        <ProductManagement />
      </div>
    </ErrorBoundary>
  );
};
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. ç»„ä»¶ç»„åˆ

```typescript
// âœ… ç»„ä»¶ç»„åˆ
interface FormFieldProps {
  label: string;
  error?: string;
  children: React.ReactNode;
}

export const FormField: React.FC<FormFieldProps> = ({ label, error, children }) => (
  <div className="form-field">
    <label className="form-label">{label}</label>
    {children}
    {error && <span className="form-error">{error}</span>}
  </div>
);

// ä½¿ç”¨ç¤ºä¾‹
<FormField label="ç”¨æˆ·å" error={errors.username}>
  <Input
    value={values.username}
    onChange={handleUsernameChange}
    placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
  />
</FormField>
```

### 2. ç»„ä»¶æµ‹è¯•

```typescript
// âœ… ç»„ä»¶æµ‹è¯•
describe('UserCard', () => {
  it('should render user information correctly', () => {
    const user = { id: '1', name: 'John Doe', email: 'john@example.com' };
    const { getByText } = render(<UserCard user={user} />);
    
    expect(getByText('John Doe')).toBeInTheDocument();
    expect(getByText('john@example.com')).toBeInTheDocument();
  });

  it('should call onEdit when edit button is clicked', () => {
    const user = { id: '1', name: 'John Doe', email: 'john@example.com' };
    const onEdit = jest.fn();
    const { getByText } = render(<UserCard user={user} onEdit={onEdit} />);
    
    fireEvent.click(getByText('ç¼–è¾‘'));
    expect(onEdit).toHaveBeenCalledWith(user);
  });
});
```

### 3. ç»„ä»¶æ–‡æ¡£

```typescript
// âœ… ç»„ä»¶æ–‡æ¡£
/**
 * ç”¨æˆ·å¡ç‰‡ç»„ä»¶
 * 
 * @param user - ç”¨æˆ·ä¿¡æ¯
 * @param onEdit - ç¼–è¾‘å›è°ƒå‡½æ•°
 * @param onDelete - åˆ é™¤å›è°ƒå‡½æ•°
 * @param className - è‡ªå®šä¹‰æ ·å¼ç±»å
 * 
 * @example
 * ```tsx
 * <UserCard
 *   user={user}
 *   onEdit={handleEdit}
 *   onDelete={handleDelete}
 * />
 * ```
 */
export const UserCard: React.FC<UserCardProps> = ({
  user,
  onEdit,
  onDelete,
  className
}) => {
  // ç»„ä»¶å®ç°
};
```

## ğŸ“‹ ç»„ä»¶è®¾è®¡æ£€æŸ¥æ¸…å•

è®¾è®¡ç»„ä»¶æ—¶æ£€æŸ¥ï¼š

- [ ] å•ä¸€èŒè´£åŸåˆ™
- [ ] é€‚å½“çš„ç»„ä»¶å¤§å°
- [ ] æ¸…æ™°çš„ Props æ¥å£
- [ ] æ€§èƒ½ä¼˜åŒ–è€ƒè™‘
- [ ] é”™è¯¯å¤„ç†
- [ ] å¯è®¿é—®æ€§æ”¯æŒ
- [ ] ç±»å‹å®‰å…¨
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] å¯å¤ç”¨æ€§

## ğŸ“š ç›¸å…³èµ„æº

- [React ç»„ä»¶è®¾è®¡åŸåˆ™](https://react.dev/learn/thinking-in-react)
- [ç»„ä»¶æ¨¡å¼æŒ‡å—](https://reactpatterns.com/)
- [é«˜é˜¶ç»„ä»¶](https://react.dev/reference/react/Component#caveats)
- [è‡ªå®šä¹‰ Hooks](https://react.dev/reference/react/useCallback)
- [ç»„ä»¶åº“](mdc:Platform.Admin/src/components/)

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **å•ä¸€èŒè´£** - æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **å¯å¤ç”¨æ€§** - è®¾è®¡å¯å¤ç”¨çš„ç»„ä»¶
3. **å¯æµ‹è¯•æ€§** - ä¾¿äºå•å…ƒæµ‹è¯•
4. **æ€§èƒ½ä¼˜åŒ–** - è€ƒè™‘æ¸²æŸ“æ€§èƒ½
5. **ç±»å‹å®‰å…¨** - ä½¿ç”¨ TypeScript ç±»å‹
6. **å¯è®¿é—®æ€§** - æ”¯æŒæ— éšœç¢è®¿é—®
7. **æ–‡æ¡£å®Œæ•´** - æä¾›å®Œæ•´çš„æ–‡æ¡£
8. **é”™è¯¯å¤„ç†** - é€‚å½“çš„é”™è¯¯å¤„ç†