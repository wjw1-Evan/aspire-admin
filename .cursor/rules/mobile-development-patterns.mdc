---
globs: **/Platform.App/**,**/app/**,**/components/**,**/hooks/**,**/services/**,Platform.App/**/*.tsx,Platform.App/**/*.ts,*.tsx,*.ts,*.js,*.jsx,app.json,expo-env.d.ts
description: React Native å’Œ Expo ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ - ç»„ä»¶å¼€å‘ã€è·¯ç”±ã€çŠ¶æ€ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–
---

# ç§»åŠ¨ç«¯å¼€å‘æ¨¡å¼å’Œæœ€ä½³å®è·µ

## ğŸ¯ æ¦‚è¿°

åŸºäº React Native + Expo æŠ€æœ¯æ ˆï¼Œæä¾›ç»Ÿä¸€çš„ç§»åŠ¨ç«¯å¼€å‘æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

**ä½¿ç”¨ React Native + Expo æ„å»ºè·¨å¹³å°ç§»åŠ¨åº”ç”¨ï¼Œéµå¾ªç§»åŠ¨ç«¯æœ€ä½³å®è·µï¼Œè€ƒè™‘æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒå’Œè·¨å¹³å°å…¼å®¹æ€§**

## ğŸ—ï¸ ç§»åŠ¨ç«¯æ¶æ„

### Expo Router è·¯ç”±ç³»ç»Ÿ

```typescript
// âœ… Expo Router æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ç»“æ„
// app/
//   â”œâ”€â”€ (auth)/
//   â”‚   â”œâ”€â”€ login.tsx
//   â”‚   â””â”€â”€ register.tsx
//   â”œâ”€â”€ (tabs)/
//   â”‚   â”œâ”€â”€ index.tsx       // ä¸»é¡µé¢
//   â”‚   â”œâ”€â”€ profile.tsx     // ä¸ªäººèµ„æ–™é¡µé¢
//   â”‚   â””â”€â”€ settings.tsx    // è®¾ç½®é¡µé¢
//   â”œâ”€â”€ _layout.tsx         // æ ¹å¸ƒå±€
//   â””â”€â”€ +not-found.tsx      // 404 é¡µé¢

// âœ… æ ¹å¸ƒå±€é…ç½®
// app/_layout.tsx
import { Stack } from 'expo-router';
import { AuthProvider } from '@/contexts/AuthContext';
import { ThemeProvider } from '@/contexts/ThemeContext';
import { StatusBar } from 'expo-status-bar';

export default function RootLayout() {
  return (
    <ThemeProvider>
      <AuthProvider>
        <StatusBar style="auto" />
        <Stack screenOptions={{ headerShown: false }}>
          <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
          <Stack.Screen name="login" options={{ title: 'ç™»å½•' }} />
          <Stack.Screen name="register" options={{ title: 'æ³¨å†Œ' }} />
        </Stack>
      </AuthProvider>
    </ThemeProvider>
  );
}

// âœ… æ ‡ç­¾é¡µå¸ƒå±€
// app/(tabs)/_layout.tsx
import { Tabs } from 'expo-router';
import { Ionicons } from '@expo/vector-icons';

export default function TabLayout() {
  return (
    <Tabs screenOptions={{ headerShown: false }}>
      <Tabs.Screen 
        name="index" 
        options={{ 
          title: 'é¦–é¡µ',
          tabBarIcon: ({ color }) => <Ionicons name="home" size={24} color={color} />
        }} 
      />
      <Tabs.Screen 
        name="profile" 
        options={{ 
          title: 'ä¸ªäºº',
          tabBarIcon: ({ color }) => <Ionicons name="person" size={24} color={color} />
        }} 
      />
    </Tabs>
  );
}
```

### å¯¼èˆªå®ˆå«æ¨¡å¼

```typescript
// âœ… å¯¼èˆªå®ˆå«å®ç°
export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { isAuthenticated, isLoading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!isLoading && !isAuthenticated) {
      router.replace('/(auth)/login');
    }
  }, [isAuthenticated, isLoading, router]);

  if (isLoading) {
    return <LoadingScreen />;
  }

  if (!isAuthenticated) {
    return null;
  }

  return <>{children}</>;
}

// ä½¿ç”¨ç¤ºä¾‹
export default function TabLayout() {
  return (
    <AuthGuard>
      <Tabs>
        <Tabs.Screen name="index" options={{ title: 'é¦–é¡µ' }} />
        <Tabs.Screen name="profile" options={{ title: 'ä¸ªäººä¸­å¿ƒ' }} />
      </Tabs>
    </AuthGuard>
  );
}
```

## ğŸ¨ ç»„ä»¶å¼€å‘è§„èŒƒ

### åŸºç¡€ç»„ä»¶ç¤ºä¾‹

```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯ç»„ä»¶ç»“æ„
import React from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Ionicons } from '@expo/vector-icons';

interface UserCardProps {
  user: User;
  onPress?: (user: User) => void;
  onEdit?: (user: User) => void;
}

const UserCard: React.FC<UserCardProps> = ({ user, onPress, onEdit }) => {
  const handlePress = () => {
    onPress?.(user);
  };

  const handleEdit = () => {
    onEdit?.(user);
  };

  return (
    <TouchableOpacity style={styles.container} onPress={handlePress}>
      <View style={styles.content}>
        <Text style={styles.name}>{user.username}</Text>
        <Text style={styles.email}>{user.email}</Text>
        <Text style={styles.role}>{user.role}</Text>
      </View>
      <TouchableOpacity onPress={handleEdit} style={styles.editButton}>
        <Ionicons name="pencil" size={20} color="#007AFF" />
      </TouchableOpacity>
    </TouchableOpacity>
  );
};

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#fff',
    padding: 16,
    marginVertical: 4,
    marginHorizontal: 16,
    borderRadius: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  content: {
    flex: 1,
  },
  name: {
    fontSize: 16,
    fontWeight: '600',
    color: '#000',
  },
  email: {
    fontSize: 14,
    color: '#666',
    marginTop: 4,
  },
  role: {
    fontSize: 12,
    color: '#999',
    marginTop: 2,
  },
  editButton: {
    padding: 8,
  },
});

export default UserCard;
```

### è‡ªå®šä¹‰ Hooks

```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯è‡ªå®šä¹‰ Hook
import { useState, useEffect, useCallback } from 'react';
import { Alert } from 'react-native';

const useUserList = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(false);
  const [refreshing, setRefreshing] = useState(false);

  const fetchUsers = useCallback(async (showLoading = true) => {
    if (showLoading) setLoading(true);
    
    try {
      const response = await getUserList();
      setUsers(response.data);
    } catch (error) {
      Alert.alert('é”™è¯¯', 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, []);

  const refreshUsers = useCallback(async () => {
    setRefreshing(true);
    await fetchUsers(false);
    setRefreshing(false);
  }, [fetchUsers]);

  const deleteUser = useCallback(async (userId: string) => {
    try {
      await deleteUserById(userId);
      setUsers(prev => prev.filter(user => user.id !== userId));
      Alert.alert('æˆåŠŸ', 'ç”¨æˆ·åˆ é™¤æˆåŠŸ');
    } catch (error) {
      Alert.alert('é”™è¯¯', 'åˆ é™¤ç”¨æˆ·å¤±è´¥');
    }
  }, []);

  useEffect(() => {
    fetchUsers();
  }, [fetchUsers]);

  return {
    users,
    loading,
    refreshing,
    fetchUsers,
    refreshUsers,
    deleteUser,
  };
};
```

## âœ… æ¨èåšæ³•

### 1. ä¸»é¢˜åŒ–ç»„ä»¶

```typescript
// âœ… ä¸»é¢˜åŒ–ç»„ä»¶
interface ThemedComponentProps {
  children: React.ReactNode;
  style?: ViewStyle;
}

export const ThemedView: React.FC<ThemedComponentProps> = ({ children, style }) => {
  const { theme } = useTheme();
  
  return (
    <View style={[styles.container, { backgroundColor: theme.colors.background }, style]}>
      {children}
    </View>
  );
};

export const ThemedText: React.FC<ThemedComponentProps & { variant?: 'title' | 'body' | 'caption' }> = ({ 
  children, 
  style, 
  variant = 'body' 
}) => {
  const { theme } = useTheme();
  
  const textStyle = variant === 'title' ? styles.title : 
                   variant === 'caption' ? styles.caption : 
                   styles.body;
  
  return (
    <Text style={[textStyle, { color: theme.colors.text }, style]}>
      {children}
    </Text>
  );
};
```

### 2. å¹³å°é€‚é…

```typescript
// âœ… å¹³å°é€‚é…
import { Platform, StatusBar } from 'react-native';

export const PlatformAdapter = {
  // çŠ¶æ€æ é«˜åº¦
  getStatusBarHeight: () => {
    return Platform.OS === 'ios' ? 44 : StatusBar.currentHeight || 0;
  },

  // å®‰å…¨åŒºåŸŸ
  getSafeAreaInsets: () => {
    return Platform.OS === 'ios' ? 
      { top: 44, bottom: 34, left: 0, right: 0 } :
      { top: 0, bottom: 0, left: 0, right: 0 };
  },

  // å¹³å°ç‰¹å®šæ ·å¼
  getPlatformStyle: (iosStyle: any, androidStyle: any) => {
    return Platform.OS === 'ios' ? iosStyle : androidStyle;
  }
};

// ä½¿ç”¨ç¤ºä¾‹
const styles = StyleSheet.create({
  container: {
    paddingTop: PlatformAdapter.getStatusBarHeight(),
    ...PlatformAdapter.getPlatformStyle(
      { shadowColor: '#000', shadowOffset: { width: 0, height: 2 } },
      { elevation: 4 }
    )
  }
});
```

### 3. æ‰‹åŠ¿å¤„ç†

```typescript
// âœ… æ‰‹åŠ¿å¤„ç†
import { PanGestureHandler, State } from 'react-native-gesture-handler';

export const SwipeableCard: React.FC<{
  children: React.ReactNode;
  onSwipeLeft?: () => void;
  onSwipeRight?: () => void;
}> = ({ children, onSwipeLeft, onSwipeRight }) => {
  const translateX = useRef(new Animated.Value(0)).current;

  const onGestureEvent = Animated.event(
    [{ nativeEvent: { translationX: translateX } }],
    { useNativeDriver: true }
  );

  const onHandlerStateChange = (event: any) => {
    if (event.nativeEvent.state === State.END) {
      const { translationX, velocityX } = event.nativeEvent;
      
      if (translationX > 100 || velocityX > 500) {
        onSwipeRight?.();
      } else if (translationX < -100 || velocityX < -500) {
        onSwipeLeft?.();
      }
      
      Animated.spring(translateX, {
        toValue: 0,
        useNativeDriver: true
      }).start();
    }
  };

  return (
    <PanGestureHandler
      onGestureEvent={onGestureEvent}
      onHandlerStateChange={onHandlerStateChange}
    >
      <Animated.View style={{ transform: [{ translateX }] }}>
        {children}
      </Animated.View>
    </PanGestureHandler>
  );
};
```

### 4. ç¦»çº¿æ”¯æŒ

```typescript
// âœ… ç¦»çº¿æ”¯æŒ
export const useOfflineSupport = () => {
  const [isOnline, setIsOnline] = useState(true);
  const [offlineData, setOfflineData] = useState<any[]>([]);

  useEffect(() => {
    const unsubscribe = NetInfo.addEventListener(state => {
      setIsOnline(state.isConnected ?? false);
    });

    return unsubscribe;
  }, []);

  const syncOfflineData = useCallback(async () => {
    if (!isOnline || offlineData.length === 0) return;

    try {
      for (const data of offlineData) {
        await apiService.syncData(data);
      }
      setOfflineData([]);
    } catch (error) {
      console.error('Failed to sync offline data:', error);
    }
  }, [isOnline, offlineData]);

  const addOfflineData = useCallback((data: any) => {
    setOfflineData(prev => [...prev, { ...data, timestamp: Date.now() }]);
  }, []);

  return {
    isOnline,
    offlineData,
    syncOfflineData,
    addOfflineData
  };
};
```

### 5. æ€§èƒ½ä¼˜åŒ–

```typescript
// âœ… æ€§èƒ½ä¼˜åŒ–
export const OptimizedList: React.FC<{
  data: any[];
  renderItem: ({ item }: { item: any }) => React.ReactElement;
}> = ({ data, renderItem }) => {
  const keyExtractor = useCallback((item: any) => item.id, []);
  
  const getItemLayout = useCallback((data: any, index: number) => ({
    length: 80,
    offset: 80 * index,
    index
  }), []);

  return (
    <FlatList
      data={data}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      getItemLayout={getItemLayout}
      removeClippedSubviews={true}
      maxToRenderPerBatch={10}
      windowSize={10}
      initialNumToRender={10}
      updateCellsBatchingPeriod={50}
    />
  );
};

// å›¾ç‰‡ä¼˜åŒ–
export const OptimizedImage: React.FC<{
  source: { uri: string };
  style?: ImageStyle;
}> = ({ source, style }) => {
  return (
    <Image
      source={source}
      style={style}
      resizeMode="cover"
      loadingIndicatorSource={require('../assets/placeholder.png')}
      onError={() => console.log('Image load error')}
    />
  );
};
```

### 6. çŠ¶æ€ç®¡ç†

```typescript
// âœ… ç§»åŠ¨ç«¯çŠ¶æ€ç®¡ç†
interface AppState {
  user: User | null;
  theme: 'light' | 'dark';
  notifications: Notification[];
  isOnline: boolean;
}

type AppAction =
  | { type: 'SET_USER'; payload: User | null }
  | { type: 'SET_THEME'; payload: 'light' | 'dark' }
  | { type: 'ADD_NOTIFICATION'; payload: Notification }
  | { type: 'SET_ONLINE'; payload: boolean };

const appReducer = (state: AppState, action: AppAction): AppState => {
  switch (action.type) {
    case 'SET_USER':
      return { ...state, user: action.payload };
    case 'SET_THEME':
      return { ...state, theme: action.payload };
    case 'ADD_NOTIFICATION':
      return { ...state, notifications: [...state.notifications, action.payload] };
    case 'SET_ONLINE':
      return { ...state, isOnline: action.payload };
    default:
      return state;
  }
};

export const AppProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [state, dispatch] = useReducer(appReducer, initialState);

  const value = useMemo(() => ({
    state,
    dispatch,
    setUser: (user: User | null) => dispatch({ type: 'SET_USER', payload: user }),
    setTheme: (theme: 'light' | 'dark') => dispatch({ type: 'SET_THEME', payload: theme }),
    addNotification: (notification: Notification) => 
      dispatch({ type: 'ADD_NOTIFICATION', payload: notification }),
    setOnline: (isOnline: boolean) => dispatch({ type: 'SET_ONLINE', payload: isOnline })
  }), [state]);

  return (
    <AppContext.Provider value={value}>
      {children}
    </AppContext.Provider>
  );
};
```

## âŒ é¿å…çš„åšæ³•

### 1. ä¸è¦å¿½ç•¥å¹³å°å·®å¼‚

```typescript
// âŒ é”™è¯¯ï¼šå¿½ç•¥å¹³å°å·®å¼‚
const styles = StyleSheet.create({
  container: {
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 3.84,
    elevation: 5  // Android å’Œ iOS éƒ½ä½¿ç”¨
  }
});

// âœ… æ­£ç¡®ï¼šå¹³å°é€‚é…
const styles = StyleSheet.create({
  container: {
    ...Platform.select({
      ios: {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.25,
        shadowRadius: 3.84,
      },
      android: {
        elevation: 5,
      },
    }),
  }
});
```

### 2. ä¸è¦å¿½ç•¥æ€§èƒ½ä¼˜åŒ–

```typescript
// âŒ é”™è¯¯ï¼šå¿½ç•¥æ€§èƒ½ä¼˜åŒ–
export const UserList: React.FC<{ users: User[] }> = ({ users }) => {
  return (
    <ScrollView>
      {users.map(user => (
        <UserCard key={user.id} user={user} />
      ))}
    </ScrollView>
  );
};

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ FlatList
export const UserList: React.FC<{ users: User[] }> = ({ users }) => {
  const renderItem = useCallback(({ item }: { item: User }) => (
    <UserCard user={item} />
  ), []);

  return (
    <FlatList
      data={users}
      renderItem={renderItem}
      keyExtractor={(item) => item.id}
    />
  );
};
```

### 3. ä¸è¦å¿½ç•¥å†…å­˜ç®¡ç†

```typescript
// âŒ é”™è¯¯ï¼šå¿½ç•¥å†…å­˜ç®¡ç†
export const ImageGallery: React.FC<{ images: string[] }> = ({ images }) => {
  const [currentIndex, setCurrentIndex] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentIndex(prev => (prev + 1) % images.length);
    }, 3000);

    // å¿˜è®°æ¸…ç†å®šæ—¶å™¨
  }, [images.length]);

  return <Image source={{ uri: images[currentIndex] }} />;
};

// âœ… æ­£ç¡®ï¼šæ¸…ç†å‰¯ä½œç”¨
export const ImageGallery: React.FC<{ images: string[] }> = ({ images }) => {
  const [currentIndex, setCurrentIndex] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentIndex(prev => (prev + 1) % images.length);
    }, 3000);

    return () => clearInterval(timer);
  }, [images.length]);

  return <Image source={{ uri: images[currentIndex] }} />;
};
```

### 4. ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†

```typescript
// âŒ é”™è¯¯ï¼šå¿½ç•¥é”™è¯¯å¤„ç†
export const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]);

  return <UserCard user={user} />;
};

// âœ… æ­£ç¡®ï¼šæ·»åŠ é”™è¯¯å¤„ç†
export const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadUser = async () => {
      try {
        setLoading(true);
        setError(null);
        const userData = await fetchUser(userId);
        setUser(userData);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    loadUser();
  }, [userId]);

  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;
  if (!user) return <NotFound />;

  return <UserCard user={user} />;
};
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. å“åº”å¼è®¾è®¡

```typescript
// âœ… å“åº”å¼è®¾è®¡
import { Dimensions } from 'react-native';

const { width, height } = Dimensions.get('window');

export const useResponsive = () => {
  const isTablet = width >= 768;
  const isLandscape = width > height;

  return {
    width,
    height,
    isTablet,
    isLandscape,
    screenWidth: width,
    screenHeight: height
  };
};

// ä½¿ç”¨ç¤ºä¾‹
export const ResponsiveLayout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { isTablet } = useResponsive();

  return (
    <View style={[
      styles.container,
      isTablet ? styles.tabletContainer : styles.phoneContainer
    ]}>
      {children}
    </View>
  );
};
```

### 2. æ·±é“¾æ¥å¤„ç†

```typescript
// âœ… æ·±é“¾æ¥å¤„ç†
export const useDeepLinking = () => {
  const router = useRouter();

  useEffect(() => {
    const handleDeepLink = (url: string) => {
      const { pathname, queryParams } = Linking.parse(url);
      
      if (pathname === '/user') {
        router.push(`/user/${queryParams?.id}`);
      } else if (pathname === '/profile') {
        router.push('/profile');
      }
    };

    const subscription = Linking.addEventListener('url', ({ url }) => {
      handleDeepLink(url);
    });

    return () => subscription?.remove();
  }, [router]);
};
```

### 3. æ¨é€é€šçŸ¥

```typescript
// âœ… æ¨é€é€šçŸ¥
export const usePushNotifications = () => {
  const [expoPushToken, setExpoPushToken] = useState<string | null>(null);

  useEffect(() => {
    registerForPushNotificationsAsync().then(token => {
      setExpoPushToken(token);
    });
  }, []);

  useEffect(() => {
    const subscription = Notifications.addNotificationReceivedListener(notification => {
      console.log('Notification received:', notification);
    });

    return () => subscription.remove();
  }, []);

  return { expoPushToken };
};
```

## ğŸ“‹ ç§»åŠ¨ç«¯å¼€å‘æ£€æŸ¥æ¸…å•

å¼€å‘ç§»åŠ¨ç«¯åŠŸèƒ½æ—¶æ£€æŸ¥ï¼š

- [ ] å¹³å°é€‚é…ï¼ˆiOS/Androidï¼‰
- [ ] å“åº”å¼è®¾è®¡
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å†…å­˜ç®¡ç†
- [ ] é”™è¯¯å¤„ç†
- [ ] ç¦»çº¿æ”¯æŒ
- [ ] æ·±é“¾æ¥å¤„ç†
- [ ] æ¨é€é€šçŸ¥
- [ ] æ‰‹åŠ¿å¤„ç†
- [ ] ä¸»é¢˜åŒ–æ”¯æŒ

## ğŸ§ª ç§»åŠ¨ç«¯æµ‹è¯•

```typescript
// âœ… ç§»åŠ¨ç«¯æµ‹è¯•
describe('UserProfile', () => {
  it('should render user information correctly', () => {
    const user = { id: '1', name: 'John Doe', email: 'john@example.com' };
    render(<UserProfile user={user} />);
    
    expect(screen.getByText('John Doe')).toBeOnTheScreen();
    expect(screen.getByText('john@example.com')).toBeOnTheScreen();
  });

  it('should handle loading state', () => {
    render(<UserProfile userId="1" />);
    expect(screen.getByTestId('loading-spinner')).toBeOnTheScreen();
  });
});
```

## ğŸ“š ç›¸å…³èµ„æº

- [React Native æ–‡æ¡£](https://reactnative.dev/)
- [Expo æ–‡æ¡£](https://docs.expo.dev/)
- [Expo Router æ–‡æ¡£](https://expo.github.io/router/)
- [React Native æ€§èƒ½ä¼˜åŒ–](https://reactnative.dev/docs/performance)
- [ç§»åŠ¨ç«¯ç»„ä»¶åº“](mdc:Platform.App/components/)

### è·¯ç”±å®ˆå«å’Œè®¤è¯

```tsx
// âœ… æ­£ç¡®ï¼šè·¯ç”±å®ˆå«å®ç°
// app/_layout.tsx ä¸­ä½¿ç”¨
import { useEffect } from 'react';
import { useRouter, useSegments } from 'expo-router';
import { useAuth } from '@/contexts/AuthContext';

export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { user, isLoading } = useAuth();
  const router = useRouter();
  const segments = useSegments();

  useEffect(() => {
    if (isLoading) return;

    const inAuthGroup = segments[0] === '(tabs)';

    if (!user && inAuthGroup) {
      router.replace('/login');
    } else if (user && !inAuthGroup) {
      router.replace('/(tabs)');
    }
  }, [user, isLoading, segments, router]);

  return <>{children}</>;
}

// âœ… æ­£ç¡®ï¼šé¡µé¢ä¸­è·¯ç”±è·³è½¬
import { useRouter } from 'expo-router';
import { useAuth } from '@/contexts/AuthContext';

export default function ProfileScreen() {
  const { user, logout } = useAuth();
  const router = useRouter();

  const handleLogout = async () => {
    await logout();
    router.replace('/login');
  };

  return (
    <View style={styles.container}>
      <Text style={styles.username}>{user?.username}</Text>
      <Text style={styles.email}>{user?.email}</Text>
      
      <TouchableOpacity style={styles.logoutButton} onPress={handleLogout}>
        <Text style={styles.logoutText}>é€€å‡ºç™»å½•</Text>
      </TouchableOpacity>
    </View>
  );
}
```

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **å¹³å°é€‚é…** - è€ƒè™‘ iOS å’Œ Android å·®å¼‚
2. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨ FlatListã€å›¾ç‰‡ä¼˜åŒ–ç­‰
3. **å“åº”å¼è®¾è®¡** - é€‚é…ä¸åŒå±å¹•å°ºå¯¸
4. **å†…å­˜ç®¡ç†** - æ¸…ç†å‰¯ä½œç”¨å’Œå®šæ—¶å™¨
5. **é”™è¯¯å¤„ç†** - é€‚å½“çš„é”™è¯¯è¾¹ç•Œå’Œé‡è¯•
6. **ç¦»çº¿æ”¯æŒ** - ç½‘ç»œçŠ¶æ€æ£€æµ‹å’Œæ•°æ®åŒæ­¥
7. **ç”¨æˆ·ä½“éªŒ** - æµç•…çš„åŠ¨ç”»å’Œäº¤äº’
8. **å¯è®¿é—®æ€§** - æ”¯æŒå±å¹•é˜…è¯»å™¨ç­‰è¾…åŠ©åŠŸèƒ½
