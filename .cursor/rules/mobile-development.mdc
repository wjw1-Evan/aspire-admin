---
globs: **/Platform.App/**,**/app/**,**/components/**,**/hooks/**,**/services/**
description: React Native å’Œ Expo ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒ
---

# React Native å’Œ Expo ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒ

## ğŸ“± é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ ˆ
- **React Native** - è·¨å¹³å°ç§»åŠ¨åº”ç”¨æ¡†æ¶
- **Expo** - React Native å¼€å‘å¹³å°
- **Expo Router** - åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±
- **TypeScript** - ç±»å‹å®‰å…¨çš„ JavaScript
- **AsyncStorage** - æœ¬åœ°æ•°æ®å­˜å‚¨

### ç›®å½•ç»“æ„
```
Platform.App/
â”œâ”€â”€ app/                    # é¡µé¢è·¯ç”± (Expo Router)
â”‚   â”œâ”€â”€ (tabs)/            # æ ‡ç­¾é¡µè·¯ç”±
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â””â”€â”€ _layout.tsx        # æ ¹å¸ƒå±€
â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶
â”œâ”€â”€ contexts/              # React Context
â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”œâ”€â”€ services/              # API æœåŠ¡
â”œâ”€â”€ types/                 # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â””â”€â”€ constants/             # å¸¸é‡é…ç½®
```

## ğŸ¯ è·¯ç”±ç³»ç»Ÿ

### Expo Router ä½¿ç”¨
```typescript
// âœ… æ¨èï¼šé¡µé¢è·¯ç”±å®šä¹‰
// app/(tabs)/index.tsx - é¦–é¡µ
// app/(tabs)/profile.tsx - ä¸ªäººä¸­å¿ƒ
// app/auth/login.tsx - ç™»å½•é¡µé¢
// app/auth/register.tsx - æ³¨å†Œé¡µé¢

// âœ… æ¨èï¼šå¯¼èˆªä½¿ç”¨
import { router } from 'expo-router';

const navigateToProfile = () => {
  router.push('/profile');
};

const navigateBack = () => {
  router.back();
};

const replaceRoute = () => {
  router.replace('/auth/login');
};
```

### æ ‡ç­¾é¡µé…ç½®
```typescript
// âœ… æ¨èï¼šæ ‡ç­¾é¡µå¸ƒå±€
import { Tabs } from 'expo-router';
import { IconSymbol } from '@/components/ui/icon-symbol';

export default function TabLayout() {
  return (
    <Tabs
      screenOptions={{
        tabBarActiveTintColor: Colors.light.tint,
        headerShown: false,
      }}
    >
      <Tabs.Screen
        name="index"
        options={{
          title: 'é¦–é¡µ',
          tabBarIcon: ({ color, focused }) => (
            <IconSymbol name="house" color={color} size={24} />
          ),
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'æˆ‘',
          tabBarIcon: ({ color, focused }) => (
            <IconSymbol name="person" color={color} size={24} />
          ),
        }}
      />
    </Tabs>
  );
}
```

## ğŸ¨ ä¸»é¢˜åŒ–ç»„ä»¶

### ä¸»é¢˜åŒ–ç»„ä»¶ä½¿ç”¨
```typescript
// âœ… æ¨èï¼šä½¿ç”¨ä¸»é¢˜åŒ–ç»„ä»¶
import { ThemedText, ThemedView, ThemedButton, ThemedInput } from '@/components';

export default function MyScreen() {
  return (
    <ThemedView style={styles.container}>
      <ThemedText type="title">æ ‡é¢˜</ThemedText>
      <ThemedText type="subtitle">å‰¯æ ‡é¢˜</ThemedText>
      <ThemedInput placeholder="è¾“å…¥å†…å®¹" />
      <ThemedButton title="æŒ‰é’®" />
    </ThemedView>
  );
}
```

### ä¸»é¢˜é¢œè‰²è·å–
```typescript
// âœ… æ¨èï¼šè·å–ä¸»é¢˜é¢œè‰²
import { useThemeColor } from '@/hooks/use-theme-color';

export default function CustomComponent() {
  const backgroundColor = useThemeColor({}, 'background');
  const textColor = useThemeColor({}, 'text');
  const borderColor = useThemeColor({}, 'border');
  
  return (
    <View style={{ backgroundColor, borderColor }}>
      <Text style={{ color: textColor }}>è‡ªå®šä¹‰ç»„ä»¶</Text>
    </View>
  );
}
```

## ğŸ”§ ç»„ä»¶å¼€å‘

### ç»„ä»¶ç»“æ„
```typescript
// âœ… æ¨èï¼šæ ‡å‡†ç»„ä»¶ç»“æ„
import React from 'react';
import { View, StyleSheet } from 'react-native';
import { ThemedText } from '@/components';

interface CustomCardProps {
  readonly title: string;
  readonly content: string;
  readonly onPress?: () => void;
}

export function CustomCard({ title, content, onPress }: CustomCardProps) {
  return (
    <View style={styles.container}>
      <ThemedText type="subtitle">{title}</ThemedText>
      <ThemedText>{content}</ThemedText>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
    borderRadius: 8,
    marginVertical: 8,
  },
});
```

### å›¾æ ‡ä½¿ç”¨
```typescript
// âœ… æ¨èï¼šä½¿ç”¨ IconSymbol ç»„ä»¶
import { IconSymbol } from '@/components/ui/icon-symbol';

export function IconExample() {
  return (
    <View>
      <IconSymbol name="house" size={24} color="#000" />
      <IconSymbol name="person" size={32} color="#007AFF" />
      <IconSymbol name="gear" size={20} color="#FF3B30" />
    </View>
  );
}
```

## ğŸ“± å¹³å°é€‚é…

### å¹³å°ç‰¹å®šä»£ç 
```typescript
// âœ… æ¨èï¼šå¹³å°é€‚é…
import { Platform, StyleSheet } from 'react-native';

const styles = StyleSheet.create({
  container: {
    paddingTop: Platform.OS === 'ios' ? 44 : 24,
    paddingBottom: Platform.OS === 'ios' ? 34 : 24,
  },
  shadow: Platform.select({
    ios: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 2 },
      shadowOpacity: 0.1,
      shadowRadius: 4,
    },
    android: {
      elevation: 4,
    },
  }),
});
```

### çŠ¶æ€æ å¤„ç†
```typescript
// âœ… æ¨èï¼šçŠ¶æ€æ é…ç½®
import { StatusBar } from 'expo-status-bar';
import { useTheme } from '@/contexts/ThemeContext';

export default function App() {
  const { isDark } = useTheme();
  
  return (
    <>
      <StatusBar style={isDark ? 'light' : 'dark'} />
      {/* åº”ç”¨å†…å®¹ */}
    </>
  );
}
```

## ğŸ’¾ æ•°æ®å­˜å‚¨

### AsyncStorage ä½¿ç”¨
```typescript
// âœ… æ¨èï¼šæ•°æ®å­˜å‚¨æœåŠ¡
import AsyncStorage from '@react-native-async-storage/async-storage';

export class StorageService {
  static async setItem(key: string, value: any): Promise<void> {
    try {
      const jsonValue = JSON.stringify(value);
      await AsyncStorage.setItem(key, jsonValue);
    } catch (error) {
      console.error('Error saving data:', error);
    }
  }
  
  static async getItem<T>(key: string): Promise<T | null> {
    try {
      const jsonValue = await AsyncStorage.getItem(key);
      return jsonValue != null ? JSON.parse(jsonValue) : null;
    } catch (error) {
      console.error('Error reading data:', error);
      return null;
    }
  }
  
  static async removeItem(key: string): Promise<void> {
    try {
      await AsyncStorage.removeItem(key);
    } catch (error) {
      console.error('Error removing data:', error);
    }
  }
}
```

### è®¤è¯çŠ¶æ€ç®¡ç†
```typescript
// âœ… æ¨èï¼šè®¤è¯çŠ¶æ€ Hook
import { useState, useEffect } from 'react';
import { StorageService } from '@/services/StorageService';

export function useAuth() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    checkAuthStatus();
  }, []);
  
  const checkAuthStatus = async () => {
    try {
      const token = await StorageService.getItem<string>('auth_token');
      const userInfo = await StorageService.getItem<User>('user_info');
      
      if (token && userInfo) {
        setUser(userInfo);
        setIsAuthenticated(true);
      }
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setLoading(false);
    }
  };
  
  const login = async (credentials: LoginRequest) => {
    try {
      const response = await AuthService.login(credentials);
      await StorageService.setItem('auth_token', response.token);
      await StorageService.setItem('user_info', response.user);
      
      setUser(response.user);
      setIsAuthenticated(true);
      return response;
    } catch (error) {
      throw error;
    }
  };
  
  const logout = async () => {
    await StorageService.removeItem('auth_token');
    await StorageService.removeItem('user_info');
    setUser(null);
    setIsAuthenticated(false);
  };
  
  return { isAuthenticated, user, loading, login, logout };
}
```

## ğŸ£ è‡ªå®šä¹‰ Hooks

### æ•°æ®è·å– Hook
```typescript
// âœ… æ¨èï¼šæ•°æ®è·å– Hook
import { useState, useEffect, useCallback } from 'react';
import { UserService } from '@/services/UserService';

export function useUsers() {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  const fetchUsers = useCallback(async () => {
    setLoading(true);
    setError(null);
    
    try {
      const data = await UserService.getUsers();
      setUsers(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, []);
  
  useEffect(() => {
    fetchUsers();
  }, [fetchUsers]);
  
  return { users, loading, error, refetch: fetchUsers };
}
```

### ä¸»é¢˜ Hook
```typescript
// âœ… æ¨èï¼šä¸»é¢˜ Hook
import { useTheme } from '@/contexts/ThemeContext';
import { useThemeColor } from '@/hooks/use-theme-color';

export function useThemedStyles() {
  const { isDark, themeMode } = useTheme();
  const backgroundColor = useThemeColor({}, 'background');
  const textColor = useThemeColor({}, 'text');
  const cardColor = useThemeColor({}, 'card');
  const borderColor = useThemeColor({}, 'border');
  
  return {
    isDark,
    themeMode,
    colors: {
      background: backgroundColor,
      text: textColor,
      card: cardColor,
      border: borderColor,
    },
  };
}
```

## ğŸš« é¿å…çš„åšæ³•

- ä¸è¦ç›´æ¥ä½¿ç”¨ `fetch`ï¼Œä½¿ç”¨å°è£…çš„æœåŠ¡ç±»
- ä¸è¦å¿˜è®°å¤„ç†ç½‘ç»œé”™è¯¯å’ŒåŠ è½½çŠ¶æ€
- ä¸è¦ç¡¬ç¼–ç æ ·å¼å€¼ï¼Œä½¿ç”¨ä¸»é¢˜ç³»ç»Ÿ
- ä¸è¦å¿½ç•¥å¹³å°å·®å¼‚
- ä¸è¦å¿˜è®°æ¸…ç†å‰¯ä½œç”¨å’Œç›‘å¬å™¨

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### åˆ—è¡¨ä¼˜åŒ–
```typescript
// âœ… æ¨èï¼šFlatList ä¼˜åŒ–
import { FlatList } from 'react-native';

export function UserList({ users }: { users: User[] }) {
  const renderItem = useCallback(({ item }: { item: User }) => (
    <UserCard user={item} />
  ), []);
  
  const keyExtractor = useCallback((item: User) => item.id, []);
  
  return (
    <FlatList
      data={users}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      removeClippedSubviews={true}
      maxToRenderPerBatch={10}
      windowSize={10}
    />
  );
}
```

### å›¾ç‰‡ä¼˜åŒ–
```typescript
// âœ… æ¨èï¼šä½¿ç”¨ Expo Image
import { Image } from 'expo-image';

export function OptimizedImage({ uri, style }: { uri: string; style?: any }) {
  return (
    <Image
      source={{ uri }}
      style={style}
      contentFit="cover"
      transition={200}
      cachePolicy="memory-disk"
    />
  );
}
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ä¸»é¢˜åŒ–ç»„ä»¶** - ç¡®ä¿æ‰€æœ‰ UI å…ƒç´ éƒ½èƒ½æ­£ç¡®é€‚é…ä¸»é¢˜
2. **å¹³å°é€‚é…** - è€ƒè™‘ iOS å’Œ Android çš„å·®å¼‚
3. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨é€‚å½“çš„ä¼˜åŒ–æŠ€æœ¯
4. **é”™è¯¯å¤„ç†** - æä¾›è‰¯å¥½çš„é”™è¯¯åé¦ˆ
5. **ç”¨æˆ·ä½“éªŒ** - å…³æ³¨åŠ è½½çŠ¶æ€å’Œäº¤äº’åé¦ˆ