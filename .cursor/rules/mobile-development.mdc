---
globs: Platform.App/**/*.tsx,Platform.App/**/*.ts
description: ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
---
# ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### ä½¿ç”¨ React Native + Expo æ„å»ºè·¨å¹³å°ç§»åŠ¨åº”ç”¨ï¼Œéµå¾ªç§»åŠ¨ç«¯æœ€ä½³å®è·µ

## âœ… ç»„ä»¶å¼€å‘è§„èŒƒ

### åŸºç¡€ç»„ä»¶
```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯ç»„ä»¶ç»“æ„
import React from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Ionicons } from '@expo/vector-icons';

interface UserCardProps {
  user: User;
  onPress?: (user: User) => void;
  onEdit?: (user: User) => void;
}

const UserCard: React.FC<UserCardProps> = ({ user, onPress, onEdit }) => {
  const handlePress = () => {
    onPress?.(user);
  };

  const handleEdit = () => {
    onEdit?.(user);
  };

  return (
    <TouchableOpacity style={styles.container} onPress={handlePress}>
      <View style={styles.content}>
        <Text style={styles.name}>{user.username}</Text>
        <Text style={styles.email}>{user.email}</Text>
        <Text style={styles.role}>{user.role}</Text>
      </View>
      <TouchableOpacity onPress={handleEdit} style={styles.editButton}>
        <Ionicons name="pencil" size={20} color="#007AFF" />
      </TouchableOpacity>
    </TouchableOpacity>
  );
};

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#fff',
    padding: 16,
    marginVertical: 4,
    marginHorizontal: 16,
    borderRadius: 8,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  content: {
    flex: 1,
  },
  name: {
    fontSize: 16,
    fontWeight: '600',
    color: '#000',
  },
  email: {
    fontSize: 14,
    color: '#666',
    marginTop: 4,
  },
  role: {
    fontSize: 12,
    color: '#999',
    marginTop: 2,
  },
  editButton: {
    padding: 8,
  },
});

export default UserCard;
```

### è‡ªå®šä¹‰ Hooks
```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯è‡ªå®šä¹‰ Hook
import { useState, useEffect, useCallback } from 'react';
import { Alert } from 'react-native';

const useUserList = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(false);
  const [refreshing, setRefreshing] = useState(false);

  const fetchUsers = useCallback(async (showLoading = true) => {
    if (showLoading) setLoading(true);
    
    try {
      const response = await getUserList();
      setUsers(response.data);
    } catch (error) {
      Alert.alert('é”™è¯¯', 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }, []);

  const refreshUsers = useCallback(async () => {
    setRefreshing(true);
    await fetchUsers(false);
    setRefreshing(false);
  }, [fetchUsers]);

  const deleteUser = useCallback(async (userId: string) => {
    try {
      await deleteUserById(userId);
      setUsers(prev => prev.filter(user => user.id !== userId));
      Alert.alert('æˆåŠŸ', 'ç”¨æˆ·åˆ é™¤æˆåŠŸ');
    } catch (error) {
      Alert.alert('é”™è¯¯', 'åˆ é™¤ç”¨æˆ·å¤±è´¥');
    }
  }, []);

  useEffect(() => {
    fetchUsers();
  }, [fetchUsers]);

  return {
    users,
    loading,
    refreshing,
    fetchUsers,
    refreshUsers,
    deleteUser,
  };
};
```

## ğŸ¨ é¡µé¢ç»„ä»¶è§„èŒƒ

### åˆ—è¡¨é¡µé¢
```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯åˆ—è¡¨é¡µé¢
import React from 'react';
import {
  View,
  FlatList,
  RefreshControl,
  ActivityIndicator,
  StyleSheet,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import UserCard from '../components/UserCard';

const UserListScreen: React.FC = () => {
  const {
    users,
    loading,
    refreshing,
    refreshUsers,
    deleteUser,
  } = useUserList();

  const handleUserPress = (user: User) => {
    // å¯¼èˆªåˆ°ç”¨æˆ·è¯¦æƒ…é¡µ
    navigation.navigate('UserDetail', { userId: user.id });
  };

  const handleEditUser = (user: User) => {
    // å¯¼èˆªåˆ°ç¼–è¾‘é¡µé¢
    navigation.navigate('UserEdit', { userId: user.id });
  };

  const renderUser = ({ item }: { item: User }) => (
    <UserCard
      user={item}
      onPress={handleUserPress}
      onEdit={handleEditUser}
    />
  );

  const renderEmpty = () => (
    <View style={styles.emptyContainer}>
      <Text style={styles.emptyText}>æš‚æ— ç”¨æˆ·æ•°æ®</Text>
    </View>
  );

  const renderFooter = () => {
    if (!loading) return null;
    return (
      <View style={styles.footer}>
        <ActivityIndicator size="small" color="#007AFF" />
      </View>
    );
  };

  return (
    <SafeAreaView style={styles.container}>
      <FlatList
        data={users}
        renderItem={renderUser}
        keyExtractor={(item) => item.id}
        refreshControl={
          <RefreshControl
            refreshing={refreshing}
            onRefresh={refreshUsers}
            colors={['#007AFF']}
            tintColor="#007AFF"
          />
        }
        ListEmptyComponent={renderEmpty}
        ListFooterComponent={renderFooter}
        contentContainerStyle={styles.listContent}
      />
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  listContent: {
    paddingVertical: 8,
  },
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 50,
  },
  emptyText: {
    fontSize: 16,
    color: '#999',
  },
  footer: {
    paddingVertical: 20,
    alignItems: 'center',
  },
});

export default UserListScreen;
```

### è¡¨å•é¡µé¢
```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯è¡¨å•é¡µé¢
import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  ScrollView,
  Alert,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';

const UserFormScreen: React.FC = () => {
  const [formData, setFormData] = useState({
    username: '',
    email: '',
    password: '',
  });
  const [loading, setLoading] = useState(false);

  const handleSubmit = async () => {
    if (!formData.username || !formData.email || !formData.password) {
      Alert.alert('é”™è¯¯', 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
      return;
    }

    setLoading(true);
    try {
      await createUser(formData);
      Alert.alert('æˆåŠŸ', 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ', [
        { text: 'ç¡®å®š', onPress: () => navigation.goBack() },
      ]);
    } catch (error) {
      Alert.alert('é”™è¯¯', 'åˆ›å»ºç”¨æˆ·å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView style={styles.scrollView}>
        <View style={styles.form}>
          <View style={styles.inputGroup}>
            <Text style={styles.label}>ç”¨æˆ·å</Text>
            <TextInput
              style={styles.input}
              value={formData.username}
              onChangeText={(text) => setFormData(prev => ({ ...prev, username: text }))}
              placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
              autoCapitalize="none"
            />
          </View>

          <View style={styles.inputGroup}>
            <Text style={styles.label}>é‚®ç®±</Text>
            <TextInput
              style={styles.input}
              value={formData.email}
              onChangeText={(text) => setFormData(prev => ({ ...prev, email: text }))}
              placeholder="è¯·è¾“å…¥é‚®ç®±"
              keyboardType="email-address"
              autoCapitalize="none"
            />
          </View>

          <View style={styles.inputGroup}>
            <Text style={styles.label}>å¯†ç </Text>
            <TextInput
              style={styles.input}
              value={formData.password}
              onChangeText={(text) => setFormData(prev => ({ ...prev, password: text }))}
              placeholder="è¯·è¾“å…¥å¯†ç "
              secureTextEntry
            />
          </View>

          <TouchableOpacity
            style={[styles.submitButton, loading && styles.submitButtonDisabled]}
            onPress={handleSubmit}
            disabled={loading}
          >
            <Text style={styles.submitButtonText}>
              {loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºç”¨æˆ·'}
            </Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  scrollView: {
    flex: 1,
  },
  form: {
    padding: 16,
  },
  inputGroup: {
    marginBottom: 20,
  },
  label: {
    fontSize: 16,
    fontWeight: '600',
    color: '#333',
    marginBottom: 8,
  },
  input: {
    backgroundColor: '#fff',
    borderWidth: 1,
    borderColor: '#ddd',
    borderRadius: 8,
    paddingHorizontal: 16,
    paddingVertical: 12,
    fontSize: 16,
  },
  submitButton: {
    backgroundColor: '#007AFF',
    borderRadius: 8,
    paddingVertical: 16,
    alignItems: 'center',
    marginTop: 20,
  },
  submitButtonDisabled: {
    backgroundColor: '#ccc',
  },
  submitButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: '600',
  },
});

export default UserFormScreen;
```

## ğŸ”§ API æœåŠ¡è§„èŒƒ

### ç§»åŠ¨ç«¯ API å®¢æˆ·ç«¯
```tsx
// âœ… æ¨èï¼šç§»åŠ¨ç«¯ API å®¢æˆ·ç«¯
import AsyncStorage from '@react-native-async-storage/async-storage';

class MobileApiClient {
  private baseURL: string;
  private token: string | null = null;

  constructor(baseURL: string) {
    this.baseURL = baseURL;
    this.loadToken();
  }

  private async loadToken() {
    try {
      this.token = await AsyncStorage.getItem('auth_token');
    } catch (error) {
      console.error('Failed to load token:', error);
    }
  }

  async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
    const url = `${this.baseURL}${endpoint}`;
    
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...options.headers,
    };

    if (this.token) {
      headers.Authorization = `Bearer ${this.token}`;
    }

    const response = await fetch(url, {
      ...options,
      headers,
    });

    if (response.status === 401) {
      // Token è¿‡æœŸï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨
      await AsyncStorage.removeItem('auth_token');
      this.token = null;
      throw new Error('TOKEN_EXPIRED');
    }

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
    }

    return response.json();
  }

  async get<T>(endpoint: string): Promise<T> {
    return this.request<T>(endpoint, { method: 'GET' });
  }

  async post<T>(endpoint: string, data: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: 'POST',
      body: JSON.stringify(data),
    });
  }

  async put<T>(endpoint: string, data: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  }

  async delete<T>(endpoint: string): Promise<T> {
    return this.request<T>(endpoint, { method: 'DELETE' });
  }

  async setToken(token: string) {
    this.token = token;
    await AsyncStorage.setItem('auth_token', token);
  }

  async clearToken() {
    this.token = null;
    await AsyncStorage.removeItem('auth_token');
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const apiClient = new MobileApiClient('https://api.example.com');

export const getUserList = () => 
  apiClient.get<UserListResponse>('/users');

export const createUser = (data: CreateUserRequest) =>
  apiClient.post<User>('/users', data);
```

## ğŸ¯ å¯¼èˆªè§„èŒƒ

### Expo Router é…ç½®
```tsx
// âœ… æ¨èï¼šä½¿ç”¨ Expo Router è¿›è¡Œå¯¼èˆª
import { Stack } from 'expo-router';

export default function RootLayout() {
  return (
    <Stack>
      <Stack.Screen
        name="index"
        options={{
          title: 'é¦–é¡µ',
          headerShown: false,
        }}
      />
      <Stack.Screen
        name="users"
        options={{
          title: 'ç”¨æˆ·ç®¡ç†',
        }}
      />
      <Stack.Screen
        name="user-detail/[id]"
        options={{
          title: 'ç”¨æˆ·è¯¦æƒ…',
        }}
      />
    </Stack>
  );
}
```

### é¡µé¢å¯¼èˆª
```tsx
// âœ… æ¨èï¼šé¡µé¢é—´å¯¼èˆª
import { useRouter, useLocalSearchParams } from 'expo-router';

const UserListScreen: React.FC = () => {
  const router = useRouter();

  const handleUserPress = (userId: string) => {
    router.push(`/user-detail/${userId}`);
  };

  const handleCreateUser = () => {
    router.push('/user-form');
  };

  return (
    // ç»„ä»¶å†…å®¹
  );
};

const UserDetailScreen: React.FC = () => {
  const { id } = useLocalSearchParams<{ id: string }>();
  const router = useRouter();

  const handleEdit = () => {
    router.push(`/user-edit/${id}`);
  };

  return (
    // ç»„ä»¶å†…å®¹
  );
};
```

## âŒ é¿å…çš„åšæ³•

### ä¸è¦å¿½ç•¥æ€§èƒ½ä¼˜åŒ–
```tsx
// âŒ é”™è¯¯ï¼šæ²¡æœ‰ä¼˜åŒ–çš„å¤§åˆ—è¡¨
const UserList = ({ users }: { users: User[] }) => {
  return (
    <ScrollView>
      {users.map(user => (
        <UserCard key={user.id} user={user} />
      ))}
    </ScrollView>
  );
};

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ FlatList ä¼˜åŒ–æ€§èƒ½
const UserList = ({ users }: { users: User[] }) => {
  const renderUser = ({ item }: { item: User }) => (
    <UserCard user={item} />
  );

  return (
    <FlatList
      data={users}
      renderItem={renderUser}
      keyExtractor={(item) => item.id}
      removeClippedSubviews
      maxToRenderPerBatch={10}
      windowSize={10}
    />
  );
};
```

### ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†
```tsx
// âŒ é”™è¯¯ï¼šæ²¡æœ‰é”™è¯¯å¤„ç†
const fetchData = async () => {
  const response = await fetch('/api/data');
  const data = await response.json();
  setData(data);
};

// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†
const fetchData = async () => {
  try {
    const response = await fetch('/api/data');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const data = await response.json();
    setData(data);
  } catch (error) {
    Alert.alert('é”™è¯¯', 'è·å–æ•°æ®å¤±è´¥');
    console.error('Fetch error:', error);
  }
};
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [React Native å®˜æ–¹æ–‡æ¡£](https://reactnative.dev/)
- [Expo æ–‡æ¡£](https://docs.expo.dev/)
- [Expo Router æ–‡æ¡£](https://expo.github.io/router/)
- [React Native æ€§èƒ½ä¼˜åŒ–](https://reactnative.dev/docs/performance)
