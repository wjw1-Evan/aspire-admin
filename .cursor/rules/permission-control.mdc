---
alwaysApply: true
description: æƒé™æ§åˆ¶å®ç°è§„èŒƒå’Œæœ€ä½³å®è·µ
---

# æƒé™æ§åˆ¶å®ç°è§„èŒƒ

## ğŸ¯ ç»Ÿä¸€æ ‡å‡†

**æ‰€æœ‰éœ€è¦æƒé™éªŒè¯çš„ API æ¥å£å¿…é¡»ä½¿ç”¨ `[RequirePermission]` ç‰¹æ€§ï¼ˆå£°æ˜å¼ï¼‰ï¼Œé™¤ééœ€è¦æ¡ä»¶æƒé™æ£€æŸ¥ã€‚**

## âœ… æ¨èï¼šä½¿ç”¨ [RequirePermission] ç‰¹æ€§

### æ ‡å‡†å®ç°

```csharp
[ApiController]
[Route("api/[controller]")]
[Authorize]  // æ§åˆ¶å™¨çº§åˆ«è¦æ±‚ç™»å½•
public class ResourceController : BaseApiController
{
    [HttpGet]
    [RequirePermission("resource", "read")]
    public async Task<IActionResult> GetAll()
    {
        var data = await _service.GetAllAsync();
        return Success(data);
    }
    
    [HttpPost]
    [RequirePermission("resource", "create")]
    public async Task<IActionResult> Create([FromBody] CreateRequest request)
    {
        var result = await _service.CreateAsync(request);
        return Success(result, "åˆ›å»ºæˆåŠŸ");
    }
    
    [HttpPut("{id}")]
    [RequirePermission("resource", "update")]
    public async Task<IActionResult> Update(string id, [FromBody] UpdateRequest request)
    {
        var success = await _service.UpdateAsync(id, request);
        if (!success)
            throw new KeyNotFoundException("èµ„æºä¸å­˜åœ¨");
        return Success("æ›´æ–°æˆåŠŸ");
    }
    
    [HttpDelete("{id}")]
    [RequirePermission("resource", "delete")]
    public async Task<IActionResult> Delete(string id)
    {
        var success = await _service.DeleteAsync(id);
        if (!success)
            throw new KeyNotFoundException("èµ„æºä¸å­˜åœ¨");
        return Success("åˆ é™¤æˆåŠŸ");
    }
}
```

### ä¼˜åŠ¿

- âœ… **å£°æ˜å¼** - æƒé™è¦æ±‚åœ¨æ–¹æ³•ç­¾åä¸Šä¸€ç›®äº†ç„¶
- âœ… **ç®€æ´** - ä¸éœ€è¦åœ¨æ–¹æ³•å†…éƒ¨ç¼–å†™æƒé™æ£€æŸ¥ä»£ç 
- âœ… **AOP** - æƒé™æ£€æŸ¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è‡ªåŠ¨å®Œæˆ
- âœ… **å¯ç»´æŠ¤** - æ˜“äºä»£ç å®¡æŸ¥å’Œç»´æŠ¤
- âœ… **ç¬¦åˆæœ€ä½³å®è·µ** - ASP.NET Core æ¨èçš„æ–¹å¼

## âš ï¸ ç‰¹æ®Šæƒ…å†µï¼šä½¿ç”¨ RequirePermissionAsync æ–¹æ³•

ä»…åœ¨ä»¥ä¸‹åœºæ™¯ä½¿ç”¨æ–¹æ³•è°ƒç”¨ï¼š

### åœºæ™¯ 1: æ¡ä»¶æƒé™æ£€æŸ¥

```csharp
[HttpPost("bulk-action")]
[Authorize]
public async Task<IActionResult> BulkAction([FromBody] BulkActionRequest request)
{
    // æ ¹æ®æ“ä½œç±»å‹æ£€æŸ¥ä¸åŒæƒé™
    if (request.Action == "delete")
        await RequirePermissionAsync("resource", "delete");
    else if (request.Action == "approve")
        await RequirePermissionAsync("resource", "approve");
    else
        await RequirePermissionAsync("resource", "update");
    
    // ä¸šåŠ¡é€»è¾‘...
}
```

### åœºæ™¯ 2: è‡ªå·±æˆ–æœ‰æƒé™

```csharp
[HttpGet("{id}")]
[Authorize]
public async Task<IActionResult> GetUserById(string id)
{
    // æŸ¥çœ‹è‡ªå·±ä¸éœ€è¦æƒé™ï¼ŒæŸ¥çœ‹ä»–äººéœ€è¦æƒé™
    var currentUserId = CurrentUserId;
    if (currentUserId != id && !await HasPermissionAsync("user", "read"))
    {
        throw new UnauthorizedAccessException("æ— æƒæŸ¥çœ‹å…¶ä»–ç”¨æˆ·ä¿¡æ¯");
    }
    
    var user = await _userService.GetUserByIdAsync(id);
    return Success(user);
}
```

### åœºæ™¯ 3: å¤æ‚æƒé™é€»è¾‘

```csharp
[HttpPost("advanced-operation")]
[Authorize]
public async Task<IActionResult> AdvancedOperation([FromBody] AdvancedRequest request)
{
    // éœ€è¦å¤šä¸ªæƒé™çš„ç»„åˆ
    if (!await HasPermissionAsync("resource", "read") || 
        !await HasPermissionAsync("resource", "update"))
    {
        throw new UnauthorizedAccessException("æƒé™ä¸è¶³");
    }
    
    // ä¸šåŠ¡é€»è¾‘...
}
```

## ğŸ“‹ æ ‡å‡† CRUD æƒé™æ˜ å°„

| HTTP æ–¹æ³• | æ“ä½œ | æƒé™ä»£ç  | ç‰¹æ€§ |
|-----------|------|---------|------|
| `GET` (åˆ—è¡¨/è¯¦æƒ…) | æŸ¥çœ‹ | `resource:read` | `[RequirePermission("resource", "read")]` |
| `POST` | åˆ›å»º | `resource:create` | `[RequirePermission("resource", "create")]` |
| `PUT` / `PATCH` | æ›´æ–° | `resource:update` | `[RequirePermission("resource", "update")]` |
| `DELETE` | åˆ é™¤ | `resource:delete` | `[RequirePermission("resource", "delete")]` |

### ç¤ºä¾‹

```csharp
// ç”¨æˆ·ç®¡ç†
[RequirePermission("user", "create")]
[RequirePermission("user", "read")]
[RequirePermission("user", "update")]
[RequirePermission("user", "delete")]

// è§’è‰²ç®¡ç†
[RequirePermission("role", "create")]
[RequirePermission("role", "read")]
[RequirePermission("role", "update")]
[RequirePermission("role", "delete")]

// èœå•ç®¡ç†
[RequirePermission("menu", "create")]
[RequirePermission("menu", "read")]
[RequirePermission("menu", "update")]
[RequirePermission("menu", "delete")]
```

## ğŸ”§ BaseApiController è¾…åŠ©æ–¹æ³•

### å¯ç”¨æ–¹æ³•

```csharp
// 1. æ£€æŸ¥å•ä¸ªæƒé™ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰
protected async Task<bool> HasPermissionAsync(string resource, string action)

// 2. è¦æ±‚æƒé™ï¼ˆæ— æƒé™æŠ›å¼‚å¸¸ï¼‰
protected async Task RequirePermissionAsync(string resource, string action)

// 3. æ£€æŸ¥æ˜¯å¦æœ‰ä»»æ„ä¸€ä¸ªæƒé™
protected async Task<bool> HasAnyPermissionAsync(params string[] permissionCodes)

// 4. æ£€æŸ¥æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æƒé™
protected async Task<bool> HasAllPermissionsAsync(params string[] permissionCodes)
```

### ä½¿ç”¨åœºæ™¯

```csharp
// åœºæ™¯ 1: ç®€å•åˆ¤æ–­
if (await HasPermissionAsync("user", "delete"))
{
    // æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
}

// åœºæ™¯ 2: å¿…é¡»æœ‰æƒé™
await RequirePermissionAsync("user", "create");  // æ— æƒé™æŠ›å¼‚å¸¸

// åœºæ™¯ 3: ä»»æ„æƒé™å³å¯
if (await HasAnyPermissionAsync("user:read", "user:update"))
{
    // æœ‰è¯»æˆ–å†™æƒé™å³å¯
}

// åœºæ™¯ 4: å¿…é¡»å…¨éƒ¨æ‹¥æœ‰
if (await HasAllPermissionsAsync("user:read", "user:update", "user:delete"))
{
    // å¿…é¡»åŒæ—¶æ‹¥æœ‰ä¸‰ä¸ªæƒé™
}
```

## ğŸš« é¿å…çš„åšæ³•

### âŒ é”™è¯¯ç¤ºä¾‹

```csharp
// âŒ é”™è¯¯ 1: åªç”¨ [Authorize]ï¼Œæ²¡æœ‰æƒé™æ£€æŸ¥
[HttpPost]
[Authorize]  // ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œ
public async Task<IActionResult> SensitiveOperation()
{
    // ç¼ºå°‘æƒé™æ£€æŸ¥ï¼
}

// âŒ é”™è¯¯ 2: ä½¿ç”¨è¿‡æ—¶çš„ Roles æˆæƒ
[HttpGet]
[Authorize(Roles = "admin")]  // v2.0 å·²åºŸå¼ƒ
public async Task<IActionResult> GetData()

// âŒ é”™è¯¯ 3: ä¸å¿…è¦çš„æ–¹æ³•è°ƒç”¨ï¼ˆåº”è¯¥ç”¨ç‰¹æ€§ï¼‰
[HttpPost]
[Authorize]
public async Task<IActionResult> Create(...)
{
    await RequirePermissionAsync("resource", "create");  // âŒ åº”è¯¥ç”¨ç‰¹æ€§
    // ...
}

// âŒ é”™è¯¯ 4: å¿˜è®°æ·»åŠ  [Authorize]
[ApiController]
public class MyController : BaseApiController  // âŒ ç¼ºå°‘ [Authorize]

// âŒ é”™è¯¯ 5: æ‰‹åŠ¨æ£€æŸ¥è§’è‰²
if (User.IsInRole("admin"))  // âŒ ä¸è¦æ‰‹åŠ¨æ£€æŸ¥è§’è‰²
{
    // ...
}

// âŒ é”™è¯¯ 6: ä½¿ç”¨ IsAdmin å±æ€§
if (IsAdmin)  // âŒ å·²è¿‡æ—¶ï¼Œä½¿ç”¨æƒé™ç³»ç»Ÿ
{
    // ...
}
```

### âœ… æ­£ç¡®ç¤ºä¾‹

```csharp
// âœ… æ­£ç¡® 1: ä½¿ç”¨ç‰¹æ€§
[HttpPost]
[RequirePermission("resource", "create")]
public async Task<IActionResult> Create(...)

// âœ… æ­£ç¡® 2: æ§åˆ¶å™¨çº§åˆ«æ·»åŠ  [Authorize]
[ApiController]
[Route("api/[controller]")]
[Authorize]
public class MyController : BaseApiController

// âœ… æ­£ç¡® 3: å…¬å…±æ¥å£ï¼ˆåªéœ€ç™»å½•ï¼‰
[HttpGet("public-data")]
[Authorize]  // åªæ£€æŸ¥ç™»å½•ï¼Œä¸æ£€æŸ¥æƒé™
public async Task<IActionResult> GetPublicData()

// âœ… æ­£ç¡® 4: æ¡ä»¶æƒé™æ£€æŸ¥ï¼ˆæ–¹æ³•è°ƒç”¨ï¼‰
[HttpPost("bulk")]
[Authorize]
public async Task<IActionResult> Bulk(...)
{
    if (request.Action == "delete")
        await RequirePermissionAsync("resource", "delete");
    else
        await RequirePermissionAsync("resource", "update");
}

// âœ… æ­£ç¡® 5: ä½¿ç”¨æƒé™ç³»ç»Ÿ
if (await HasPermissionAsync("user", "delete"))
{
    // æœ‰æƒé™æ‰æ‰§è¡Œ
}
```

## ğŸ“– å®Œæ•´ç¤ºä¾‹

### æ ‡å‡†çš„èµ„æºæ§åˆ¶å™¨

```csharp
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Platform.ApiService.Attributes;
using Platform.ApiService.Models;
using Platform.ApiService.Services;

namespace Platform.ApiService.Controllers;

[ApiController]
[Route("api/[controller]")]
[Authorize]  // âœ… æ‰€æœ‰æ¥å£é»˜è®¤éœ€è¦ç™»å½•
public class ProductController : BaseApiController
{
    private readonly IProductService _productService;

    public ProductController(IProductService productService)
    {
        _productService = productService;
    }

    /// <summary>
    /// è·å–æ‰€æœ‰äº§å“
    /// </summary>
    [HttpGet]
    [RequirePermission("product", "read")]  // âœ… å£°æ˜å¼æƒé™æ£€æŸ¥
    public async Task<IActionResult> GetAll()
    {
        var products = await _productService.GetAllAsync();
        return Success(products);
    }

    /// <summary>
    /// æ ¹æ®IDè·å–äº§å“
    /// </summary>
    [HttpGet("{id}")]
    [RequirePermission("product", "read")]
    public async Task<IActionResult> GetById(string id)
    {
        var product = await _productService.GetByIdAsync(id);
        if (product == null)
            throw new KeyNotFoundException($"äº§å“ {id} ä¸å­˜åœ¨");
        
        return Success(product);
    }

    /// <summary>
    /// åˆ›å»ºäº§å“
    /// </summary>
    [HttpPost]
    [RequirePermission("product", "create")]
    public async Task<IActionResult> Create([FromBody] CreateProductRequest request)
    {
        if (string.IsNullOrEmpty(request.Name))
            throw new ArgumentException("äº§å“åç§°ä¸èƒ½ä¸ºç©º");
        
        var userId = GetRequiredUserId();
        var product = await _productService.CreateAsync(request, userId);
        
        return Success(product, "åˆ›å»ºæˆåŠŸ");
    }

    /// <summary>
    /// æ›´æ–°äº§å“
    /// </summary>
    [HttpPut("{id}")]
    [RequirePermission("product", "update")]
    public async Task<IActionResult> Update(string id, [FromBody] UpdateProductRequest request)
    {
        var success = await _productService.UpdateAsync(id, request);
        if (!success)
            throw new KeyNotFoundException($"äº§å“ {id} ä¸å­˜åœ¨");
        
        return Success("æ›´æ–°æˆåŠŸ");
    }

    /// <summary>
    /// åˆ é™¤äº§å“
    /// </summary>
    [HttpDelete("{id}")]
    [RequirePermission("product", "delete")]
    public async Task<IActionResult> Delete(string id)
    {
        var success = await _productService.DeleteAsync(id);
        if (!success)
            throw new KeyNotFoundException($"äº§å“ {id} ä¸å­˜åœ¨");
        
        return Success("åˆ é™¤æˆåŠŸ");
    }

    /// <summary>
    /// æ‰¹é‡æ“ä½œäº§å“ï¼ˆæ¡ä»¶æƒé™æ£€æŸ¥ï¼‰
    /// </summary>
    [HttpPost("bulk-action")]
    [Authorize]  // âš ï¸ ç‰¹æ®Šæƒ…å†µï¼šæ¡ä»¶æƒé™æ£€æŸ¥
    public async Task<IActionResult> BulkAction([FromBody] BulkActionRequest request)
    {
        // æ ¹æ®æ“ä½œç±»å‹æ£€æŸ¥ä¸åŒæƒé™
        if (request.Action == "delete")
            await RequirePermissionAsync("product", "delete");
        else
            await RequirePermissionAsync("product", "update");
        
        var success = await _productService.BulkActionAsync(request);
        return Success("æ‰¹é‡æ“ä½œæˆåŠŸ");
    }
}
```

## ğŸ”§ BaseApiController æä¾›çš„æ–¹æ³•

### æƒé™æ£€æŸ¥æ–¹æ³•

```csharp
// 1. æ£€æŸ¥å•ä¸ªæƒé™ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰
bool hasPermission = await HasPermissionAsync("resource", "action");

// 2. è¦æ±‚æƒé™ï¼ˆæ— æƒé™æŠ›å¼‚å¸¸ï¼‰
await RequirePermissionAsync("resource", "action");

// 3. æ£€æŸ¥æ˜¯å¦æœ‰ä»»æ„ä¸€ä¸ªæƒé™
bool hasAny = await HasAnyPermissionAsync("user:read", "user:update");

// 4. æ£€æŸ¥æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æƒé™
bool hasAll = await HasAllPermissionsAsync("user:read", "user:update");
```

### ä½¿ç”¨ç¤ºä¾‹

```csharp
// åœºæ™¯ 1: è‡ªå·±æˆ–æœ‰æƒé™
[HttpGet("{id}")]
[Authorize]
public async Task<IActionResult> GetUser(string id)
{
    // å¯ä»¥æŸ¥çœ‹è‡ªå·±ï¼Œæˆ–è€…éœ€è¦ user:read æƒé™
    if (CurrentUserId != id && !await HasPermissionAsync("user", "read"))
    {
        throw new UnauthorizedAccessException("æ— æƒæŸ¥çœ‹å…¶ä»–ç”¨æˆ·ä¿¡æ¯");
    }
    
    var user = await _userService.GetUserByIdAsync(id);
    return Success(user);
}

// åœºæ™¯ 2: æ¡ä»¶æƒé™
[HttpPost("action")]
[Authorize]
public async Task<IActionResult> DoAction([FromBody] ActionRequest request)
{
    if (request.IsAdminAction)
        await RequirePermissionAsync("resource", "admin");
    else
        await RequirePermissionAsync("resource", "normal");
}
```

## ğŸ“‹ æƒé™å‘½åè§„èŒƒ

### æ ‡å‡†æ ¼å¼

```
{resource}:{action}
```

### èµ„æºå‘½å

ä½¿ç”¨å•æ•°ã€å°å†™ã€è¿å­—ç¬¦åˆ†éš”ï¼š

```csharp
âœ… "user"              // ç”¨æˆ·
âœ… "role"              // è§’è‰²
âœ… "menu"              // èœå•
âœ… "activity-log"      // æ´»åŠ¨æ—¥å¿—
âœ… "user-profile"      // ç”¨æˆ·èµ„æ–™

âŒ "users"             // ä¸è¦ç”¨å¤æ•°
âŒ "User"              // ä¸è¦ç”¨å¤§å†™
âŒ "user_profile"      // ä¸è¦ç”¨ä¸‹åˆ’çº¿
```

### æ“ä½œå‘½å

ä½¿ç”¨æ ‡å‡† CRUD æ“ä½œï¼š

```csharp
âœ… "create"            // åˆ›å»º
âœ… "read"              // æŸ¥çœ‹
âœ… "update"            // æ›´æ–°
âœ… "delete"            // åˆ é™¤

// æ‰©å±•æ“ä½œï¼ˆç‰¹æ®Šæƒ…å†µï¼‰
âœ… "approve"           // å®¡æ‰¹
âœ… "export"            // å¯¼å‡º
âœ… "import"            // å¯¼å…¥
```

### å®Œæ•´ç¤ºä¾‹

```csharp
[RequirePermission("user", "create")]          // âœ… åˆ›å»ºç”¨æˆ·
[RequirePermission("user", "read")]            // âœ… æŸ¥çœ‹ç”¨æˆ·
[RequirePermission("user", "update")]          // âœ… æ›´æ–°ç”¨æˆ·
[RequirePermission("user", "delete")]          // âœ… åˆ é™¤ç”¨æˆ·
[RequirePermission("order", "approve")]        // âœ… å®¡æ‰¹è®¢å•
[RequirePermission("report", "export")]        // âœ… å¯¼å‡ºæŠ¥è¡¨
[RequirePermission("activity-log", "read")]    // âœ… æŸ¥çœ‹æ—¥å¿—
```

## ğŸš« ç¦æ­¢çš„åšæ³•

### 1. ä½¿ç”¨è¿‡æ—¶çš„è§’è‰²æˆæƒ

```csharp
// âŒ ç¦æ­¢ï¼šv2.0 å·²åºŸå¼ƒ
[Authorize(Roles = "admin")]
[Authorize(Roles = "user")]

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æƒé™ç³»ç»Ÿ
[RequirePermission("resource", "action")]
```

### 2. åªæ£€æŸ¥ç™»å½•ï¼Œä¸æ£€æŸ¥æƒé™

```csharp
// âŒ ç¦æ­¢ï¼šæ•æ„Ÿæ“ä½œåªæ£€æŸ¥ç™»å½•
[HttpPost]
[Authorize]  // ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œ
public async Task<IActionResult> SensitiveOperation()

// âœ… æ­£ç¡®ï¼šæ·»åŠ æƒé™æ£€æŸ¥
[HttpPost]
[RequirePermission("resource", "action")]
public async Task<IActionResult> SensitiveOperation()
```

### 3. æ‰‹åŠ¨æ£€æŸ¥è§’è‰²æˆ–ä½¿ç”¨ IsAdmin

```csharp
// âŒ ç¦æ­¢ï¼šæ‰‹åŠ¨æ£€æŸ¥è§’è‰²
if (User.IsInRole("admin"))
{
    // ...
}

// âŒ ç¦æ­¢ï¼šä½¿ç”¨ IsAdmin å±æ€§
if (IsAdmin)  // å·²è¿‡æ—¶
{
    // ...
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æƒé™æ£€æŸ¥
if (await HasPermissionAsync("resource", "admin"))
{
    // ...
}
```

### 4. åœ¨ä¸éœ€è¦æ—¶ä½¿ç”¨æ–¹æ³•è°ƒç”¨

```csharp
// âŒ ä¸æ¨èï¼šç®€å•æƒé™æ£€æŸ¥ä½¿ç”¨æ–¹æ³•
[HttpPost]
[Authorize]
public async Task<IActionResult> Create(...)
{
    await RequirePermissionAsync("resource", "create");  // åº”è¯¥ç”¨ç‰¹æ€§
    // ...
}

// âœ… æ¨èï¼šä½¿ç”¨ç‰¹æ€§
[HttpPost]
[RequirePermission("resource", "create")]
public async Task<IActionResult> Create(...)
{
    // æƒé™è‡ªåŠ¨æ£€æŸ¥
    // ...
}
```

## ğŸ“ ä»£ç å®¡æŸ¥æ¸…å•

åœ¨ç¼–å†™æˆ–å®¡æŸ¥ API æ§åˆ¶å™¨æ—¶æ£€æŸ¥ï¼š

- [ ] æ§åˆ¶å™¨ç»§æ‰¿ `BaseApiController`
- [ ] æ§åˆ¶å™¨çº§åˆ«æœ‰ `[Authorize]` ç‰¹æ€§
- [ ] æ•æ„Ÿæ¥å£æœ‰ `[RequirePermission]` ç‰¹æ€§
- [ ] å…¬å…±æ¥å£åªæœ‰ `[Authorize]`ï¼ˆæ—  RequirePermissionï¼‰
- [ ] ä¸ä½¿ç”¨ `[Authorize(Roles = ...)]`
- [ ] ä¸ä½¿ç”¨ `IsAdmin` æˆ–æ‰‹åŠ¨è§’è‰²æ£€æŸ¥
- [ ] æƒé™ä»£ç éµå¾ªå‘½åè§„èŒƒï¼ˆ`resource:action`ï¼‰
- [ ] æ¡ä»¶æƒé™æ£€æŸ¥æœ‰æ˜ç¡®æ³¨é‡Š
- [ ] æœ‰ä¸šåŠ¡è§„åˆ™ä¿æŠ¤ï¼ˆå¦‚ä¸èƒ½åˆ é™¤è‡ªå·±ï¼‰
- [ ] æœ‰ XML æ–‡æ¡£æ³¨é‡Š

## ğŸ¯ æƒé™æ§åˆ¶æ¨¡å¼

### æ¨¡å¼ 1: æ ‡å‡† CRUDï¼ˆ97% çš„æƒ…å†µï¼‰

```csharp
[RequirePermission("resource", "action")]
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ ‡å‡†çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
- æƒé™è¦æ±‚å›ºå®šä¸å˜
- ä¸éœ€è¦æ¡ä»¶åˆ¤æ–­

### æ¨¡å¼ 2: æ¡ä»¶æƒé™ï¼ˆ3% çš„æƒ…å†µï¼‰

```csharp
[Authorize]
public async Task<IActionResult> Operation(...)
{
    if (condition)
        await RequirePermissionAsync("resource", "action1");
    else
        await RequirePermissionAsync("resource", "action2");
}
```

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦æ ¹æ®å‚æ•°åˆ¤æ–­æƒé™
- å¤æ‚çš„æƒé™é€»è¾‘
- å¤šç§æ“ä½œç±»å‹çš„æ‰¹é‡æ¥å£

### æ¨¡å¼ 3: å…¬å…±æ¥å£ï¼ˆæ— æƒé™è¦æ±‚ï¼‰

```csharp
[Authorize]  // åªæ£€æŸ¥ç™»å½•
public async Task<IActionResult> GetPublicData()
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ‰€æœ‰ç™»å½•ç”¨æˆ·éƒ½å¯è®¿é—®çš„åŠŸèƒ½
- æŸ¥çœ‹é€šçŸ¥ã€è·å–å…¬å…±é…ç½®ç­‰

### æ¨¡å¼ 4: åŒ¿åè®¿é—®

```csharp
[AllowAnonymous]
public async Task<IActionResult> GetAnonymousData()
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ç™»å½•ã€æ³¨å†Œã€å¿˜è®°å¯†ç ç­‰
- å…¬å¼€çš„APIæ–‡æ¡£
- å¥åº·æ£€æŸ¥ç«¯ç‚¹

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [RequirePermission ç‰¹æ€§å®ç°](mdc:Platform.ApiService/Attributes/RequirePermissionAttribute.cs)
- [BaseApiController åŸºç±»](mdc:Platform.ApiService/Controllers/BaseApiController.cs)
- [æƒé™æ£€æŸ¥æœåŠ¡](mdc:Platform.ApiService/Services/PermissionCheckService.cs)
- [æƒé™ç³»ç»Ÿå®Œæ•´æ–‡æ¡£](mdc:docs/permissions/CRUD-PERMISSION-SYSTEM.md)
- [ç»Ÿä¸€æƒé™æ§åˆ¶æ–‡æ¡£](mdc:docs/features/UNIFIED-PERMISSION-CONTROL.md)

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **å£°æ˜å¼ä¼˜å…ˆ** - ä½¿ç”¨ `[RequirePermission]` ç‰¹æ€§è€Œä¸æ˜¯æ–¹æ³•è°ƒç”¨
2. **æƒé™è¦†ç›– 100%** - æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½å¿…é¡»æœ‰æƒé™æ£€æŸ¥
3. **ä»£ç ä¸€è‡´æ€§** - ç»Ÿä¸€çš„å®ç°æ–¹å¼
4. **å®‰å…¨ç¬¬ä¸€** - é»˜è®¤æ‹’ç»ï¼Œæ˜¾å¼æˆæƒ
5. **ç®€æ´æ˜äº†** - æƒé™è¦æ±‚åœ¨æ–¹æ³•ç­¾åä¸Šä¸€ç›®äº†ç„¶

éµå¾ªè¿™äº›è§„èŒƒï¼Œä»£ç å°†æ›´å®‰å…¨ã€æ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤ï¼
