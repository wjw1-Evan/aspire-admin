---
alwaysApply: true
description: é¡¹ç›®ç»“æ„å’Œæ¶æ„æŒ‡å—
---

# Aspire Admin Platform é¡¹ç›®ç»“æ„æŒ‡å—

è¿™æ˜¯ä¸€ä¸ªåŸºäº .NET Aspire æ„å»ºçš„ç°ä»£åŒ–å¾®æœåŠ¡ç®¡ç†å¹³å°ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç»„ä»¶

- **Platform.AppHost** - Aspire åº”ç”¨ä¸»æœºï¼Œè´Ÿè´£æœåŠ¡ç¼–æ’å’Œé…ç½®
- **Platform.DataInitializer** - æ•°æ®åˆå§‹åŒ–å¾®æœåŠ¡ï¼Œè´Ÿè´£æ•°æ®åº“ç´¢å¼•åˆ›å»ºå’Œèœå•åˆå§‹åŒ–
- **Platform.ApiService** - API æœåŠ¡ï¼Œæä¾›ç”¨æˆ·ç®¡ç†ã€è®¤è¯ç­‰ REST API
- **Platform.Admin** - React + Ant Design Pro ä¼ä¸šçº§ç®¡ç†åå°
- **Platform.App** - React Native + Expo è·¨å¹³å°ç§»åŠ¨åº”ç”¨
- **Platform.ServiceDefaults** - å…±äº«æœåŠ¡é…ç½®

### æŠ€æœ¯æ ˆ

- **åç«¯**: .NET 10.0, .NET Aspire, MongoDB, YARP, Scalar API æ–‡æ¡£
- **å‰ç«¯**: React 19, Ant Design Pro, UmiJS, TypeScript, Biome
- **ç§»åŠ¨ç«¯**: React Native, Expo, Expo Router, TypeScript

## ğŸ“ ç›®å½•ç»“æ„

```text
Platform/
â”œâ”€â”€ Platform.AppHost/          # åº”ç”¨ç¼–æ’å’Œé…ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ AppHost.cs            # Aspire ç¼–æ’é…ç½®
â”‚   â””â”€â”€ appsettings.json      # åº”ç”¨é…ç½®
â”œâ”€â”€ Platform.DataInitializer/  # æ•°æ®åˆå§‹åŒ–å¾®æœåŠ¡ (C#)
â”‚   â”œâ”€â”€ Models/              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ Services/            # æ•°æ®åˆå§‹åŒ–æœåŠ¡
â”‚   â”œâ”€â”€ Scripts/             # ç´¢å¼•åˆ›å»ºè„šæœ¬
â”‚   â””â”€â”€ Program.cs           # æœåŠ¡å…¥å£
â”œâ”€â”€ Platform.ApiService/       # API æœåŠ¡ (C#)
â”‚   â”œâ”€â”€ Controllers/          # API æ§åˆ¶å™¨ï¼ˆ15ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ AuthController.cs          # è®¤è¯ï¼šç™»å½•ã€æ³¨å†Œã€å¯†ç ç®¡ç†ã€éªŒè¯ç 
â”‚   â”‚   â”œâ”€â”€ UserController.cs          # ç”¨æˆ·ç®¡ç†ï¼šCRUDã€è§’è‰²åˆ†é…ã€çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ CompanyController.cs       # ä¼ä¸šç®¡ç†ï¼šæ³¨å†Œã€æˆå‘˜ç®¡ç†ã€è®¾ç½®
â”‚   â”‚   â”œâ”€â”€ RoleController.cs          # è§’è‰²ç®¡ç†ï¼šè§’è‰² CRUDã€æƒé™åˆ†é…
â”‚   â”‚   â”œâ”€â”€ MenuController.cs          # èœå•ç®¡ç†ï¼šæŸ¥è¯¢ç”¨æˆ·å¯è§èœå•æ ‘
â”‚   â”‚   â”œâ”€â”€ RuleController.cs          # è§„åˆ™ç®¡ç†ï¼šä¸šåŠ¡è§„åˆ™ CRUD
â”‚   â”‚   â”œâ”€â”€ NoticeController.cs        # é€šçŸ¥ç®¡ç†ï¼šç³»ç»Ÿé€šçŸ¥ CRUD
â”‚   â”‚   â”œâ”€â”€ JoinRequestController.cs    # åŠ å…¥ç”³è¯·ï¼šä¼ä¸šåŠ å…¥å®¡æ‰¹æµç¨‹
â”‚   â”‚   â”œâ”€â”€ FriendsController.cs       # å¥½å‹ç®¡ç†ï¼šå¥½å‹åˆ—è¡¨ã€æœç´¢ã€è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ ChatSessionsController.cs   # èŠå¤©ä¼šè¯ï¼šä¼šè¯ CRUDã€åˆ—è¡¨æŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ ChatMessagesController.cs  # èŠå¤©æ¶ˆæ¯ï¼šæ¶ˆæ¯ CRUDã€åˆ†é¡µæŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ ChatAiController.cs        # AI èŠå¤©ï¼šæ™ºèƒ½å›å¤ã€åŒ¹é…æ¨è
â”‚   â”‚   â”œâ”€â”€ SocialController.cs        # ç¤¾äº¤åŠŸèƒ½ï¼šé™„è¿‘çš„äººã€ä½ç½®ä¸ŠæŠ¥
â”‚   â”‚   â”œâ”€â”€ SystemMonitorController.cs # ç³»ç»Ÿç›‘æ§ï¼šèµ„æºç›‘æ§ã€å¥åº·æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ MaintenanceController.cs  # ç»´æŠ¤è„šæœ¬ï¼šæ•°æ®ä¿®å¤ã€æ¸…ç†ä»»åŠ¡
â”‚   â”œâ”€â”€ Services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡ï¼ˆ31ä¸ªï¼‰
â”‚   â”œâ”€â”€ Models/              # æ•°æ®æ¨¡å‹å’Œ DTO
â”‚   â”œâ”€â”€ Extensions/          # æ‰©å±•æ–¹æ³•
â”‚   â”œâ”€â”€ Middleware/          # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ Hubs/                # SignalR Hub
â”‚   â””â”€â”€ Program.cs           # æœåŠ¡å…¥å£
â”œâ”€â”€ Platform.Admin/            # ç®¡ç†åå° (React + Ant Design Pro)
â”‚   â”œâ”€â”€ config/              # UmiJS é…ç½®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/       # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ app.tsx         # åº”ç”¨å…¥å£é…ç½®
â”‚   â”œâ”€â”€ biome.json          # Biome é…ç½®
â”‚   â””â”€â”€ package.json        # ä¾èµ–é…ç½®
â”œâ”€â”€ Platform.App/              # ç§»åŠ¨åº”ç”¨ (React Native + Expo)
â”‚   â”œâ”€â”€ app/                # Expo Router é¡µé¢
â”‚   â”œâ”€â”€ components/         # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ contexts/           # React Context
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ services/           # API æœåŠ¡
â”‚   â”œâ”€â”€ types/              # TypeScript ç±»å‹
â”‚   â””â”€â”€ app.json            # Expo é…ç½®
â””â”€â”€ Platform.ServiceDefaults/  # å…±äº«æœåŠ¡é…ç½®
    â””â”€â”€ Extensions.cs        # æœåŠ¡æ‰©å±•æ–¹æ³•
```

## ğŸ”§ å¼€å‘æŒ‡å—

### å¯åŠ¨é¡¹ç›®

```bash
# å®Œæ•´å¯åŠ¨ï¼ˆæ¨èï¼‰
dotnet run --project Platform.AppHost

# ä»…å¯åŠ¨æ•°æ®åˆå§‹åŒ–æœåŠ¡ï¼ˆç”¨äºè°ƒè¯•ï¼‰
dotnet run --project Platform.DataInitializer

# ä»…å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç”¨äºè°ƒè¯•ï¼‰
dotnet run --project Platform.ApiService

# ä»…å¯åŠ¨ç®¡ç†åå°
cd Platform.Admin && npm start

# ä»…å¯åŠ¨ç§»åŠ¨åº”ç”¨
cd Platform.App && npm start
```

> âš ï¸ **é‡è¦æç¤º**ï¼š
> - è°ƒè¯•æ—¶è¯·åŠ¡å¿…é€šè¿‡ `Platform.AppHost` å¯åŠ¨é¡¹ç›®ï¼Œå¦åˆ™å¾®æœåŠ¡ã€API åŠå‰ç«¯åº”ç”¨å°†æ— æ³•æ­£ç¡®ç¼–æ’å’Œè”åŠ¨
> - AppHost ä¼šè‡ªåŠ¨å¯åŠ¨ MongoDBã€æ•°æ®åˆå§‹åŒ–æœåŠ¡ã€API æœåŠ¡ã€ç®¡ç†åå°å’Œç§»åŠ¨åº”ç”¨
> - AppHost æä¾›ç»Ÿä¸€çš„æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†
> - æ•°æ®åˆå§‹åŒ–æœåŠ¡å¿…é¡»åœ¨ API æœåŠ¡ä¹‹å‰å¯åŠ¨

### è®¿é—®åœ°å€

- **Aspire Dashboard**: <http://localhost:15003> (æœåŠ¡ç›‘æ§é¢æ¿)
- **ç®¡ç†åå°**: <http://localhost:15001>
- **ç§»åŠ¨åº”ç”¨**: <http://localhost:15002>
- **API ç½‘å…³**: <http://localhost:15000>
- **API æ–‡æ¡£**: <http://localhost:15000/scalar/v1>
- **æ•°æ®åˆå§‹åŒ–æœåŠ¡**: <http://localhost:15000/datainitializer> (å†…éƒ¨æœåŠ¡)
- **MongoDB Express**: <http://localhost:8081> (æ•°æ®åº“ç®¡ç†)

### é»˜è®¤è´¦æˆ·

- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`
- è§’è‰²: `admin`

## ğŸ¯ .NET Aspire æ¶æ„

### æœåŠ¡ç¼–æ’

Platform.AppHost è´Ÿè´£æ•´ä¸ªåº”ç”¨çš„æœåŠ¡ç¼–æ’ï¼š

```csharp
// AppHost.cs æ ¸å¿ƒé…ç½®
var builder = DistributedApplication.CreateBuilder(args);

// 1. æ·»åŠ  OpenAI æœåŠ¡ï¼ˆAI èƒ½åŠ›ï¼‰
var openai = builder.AddOpenAI("openai")
    .WithEndpoint(openAiEndpoint);
var chat = openai.AddModel("chat", "gpt-4o-mini");

// 2. æ·»åŠ  MongoDB æ•°æ®åº“
var mongo = builder.AddMongoDB("mongo")
    .WithMongoExpress()
    .WithLifetime(ContainerLifetime.Persistent)
    .WithDataVolume();
var mongodb = mongo.AddDatabase("mongodb", "aspire-admin-db");

// 3. æ·»åŠ æ•°æ®åˆå§‹åŒ–å¾®æœåŠ¡ï¼ˆä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆåè‡ªåŠ¨åœæ­¢ï¼‰
var datainitializer = builder.AddProject<Projects.Platform_DataInitializer>("datainitializer")
    .WaitFor(mongodb)
    .WithReference(mongodb)
    .WithHttpEndpoint();

// 4. æ·»åŠ  API æœåŠ¡ï¼ˆä¾èµ–æ•°æ®åˆå§‹åŒ–æœåŠ¡å’Œ OpenAIï¼‰
var apiservice = builder.AddProject<Projects.Platform_ApiService>("apiservice")
    .WithReference(mongodb)
    .WaitForCompletion(datainitializer)
    .WithReference(chat)
    .WithHttpEndpoint()
    .WithReplicas(1)
    .WithHttpHealthCheck("/health")
    .WithEnvironment("Jwt__SecretKey", jwtSecretKey);

// 5. é…ç½® YARP ç½‘å…³
var yarp = builder.AddYarp("apigateway")
    .WithHostPort(15000)
    .WithConfiguration(config => {
        // å¾®æœåŠ¡è·¯ç”±é…ç½® - ç»Ÿä¸€é€šè¿‡/{service}è·¯å¾„è®¿é—®
        config.AddRoute("/apiservice/{**catch-all}", config.AddCluster(apiservice))
            .WithTransformPathRouteValues("/{**catch-all}");
    });

// 6. æ·»åŠ å‰ç«¯åº”ç”¨
builder.AddNpmApp("admin", "../Platform.Admin")
    .WithReference(yarp)
    .WaitFor(yarp)
    .WithHttpEndpoint(env: "PORT", port: 15001, targetPort: 8080);

builder.AddNpmApp("app", "../Platform.App")
    .WithReference(yarp)
    .WaitFor(yarp)
    .WithHttpEndpoint(env: "PORT", port: 15002, targetPort: 8081);

// 7. é…ç½® Scalar API æ–‡æ¡£ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
if (builder.Environment.IsDevelopment())
{
    var scalar = builder.AddScalarApiReference();
    scalar.WithApiReference(apiservice);
}
```

### æœåŠ¡ä¾èµ–å…³ç³»

```
OpenAI â†’ Chat Model
MongoDB â†’ DataInitializer â†’ ApiService â†’ YARP Gateway
                                    â†“
                            Admin/App (å‰ç«¯åº”ç”¨)
                                    â†“
                            Scalar API Docs (å¼€å‘ç¯å¢ƒ)
```

### æœåŠ¡å‘ç°

- æ‰€æœ‰æœåŠ¡é€šè¿‡ Aspire è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°
- API ç½‘å…³ (YARP) æä¾›ç»Ÿä¸€å…¥å£
- å‰ç«¯åº”ç”¨é€šè¿‡ç¯å¢ƒå˜é‡è·å– API åœ°å€

### å¥åº·æ£€æŸ¥

- DataInitializer æœåŠ¡æä¾› `/health` ç«¯ç‚¹
- API æœåŠ¡æä¾› `/health` ç«¯ç‚¹
- Aspire Dashboard å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€
- è‡ªåŠ¨é‡å¯å¤±è´¥çš„æœåŠ¡

## ğŸ” è®¤è¯ç³»ç»Ÿæ¶æ„

### ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ

é¡¹ç›®é‡‡ç”¨å‰åç«¯ç»Ÿä¸€çš„è®¤è¯æ¶æ„ï¼š

- **JWT Token è®¤è¯** - åŸºäº JWT çš„ token æœºåˆ¶ï¼ŒåŒ…å« Access Token å’Œ Refresh Token
- **ç»Ÿä¸€ API æ¥å£** - å‰åç«¯ä½¿ç”¨ç›¸åŒçš„è®¤è¯ç«¯ç‚¹
- **åŸºäº access å­—æ®µçš„æƒé™ç³»ç»Ÿ** - ç®€åŒ–çš„æƒé™æ§åˆ¶
- **è‡ªåŠ¨ token åˆ·æ–°** - æ™ºèƒ½çš„ token åˆ·æ–°å’Œé‡è¯•æœºåˆ¶

### è®¤è¯æµç¨‹

1. **ç™»å½•**: `POST /login/account` â†’ è·å– JWT token å’Œ refresh token
2. **æƒé™æ£€æŸ¥**: åŸºäº `user.access` å­—æ®µè¿›è¡Œæƒé™éªŒè¯
3. **Token åˆ·æ–°**: Token è¿‡æœŸæ—¶è‡ªåŠ¨è°ƒç”¨ `/refresh-token` åˆ·æ–°
4. **Token éªŒè¯**: å®šæœŸè°ƒç”¨ `/currentUser` éªŒè¯ token æœ‰æ•ˆæ€§
5. **ç™»å‡º**: `POST /login/outLogin` â†’ æ¸…é™¤æœ¬åœ° token

### æƒé™ç³»ç»Ÿ

- **Admin æƒé™**: `access: 'admin'` - å®Œå…¨ç®¡ç†æƒé™
- **User æƒé™**: `access: 'user'` - æ™®é€šç”¨æˆ·æƒé™
- **Guest æƒé™**: `access: 'guest'` - è®¿å®¢æƒé™

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ

- é€šè¿‡ `dotnet run --project Platform.AppHost` å¯åŠ¨
- æ‰€æœ‰æœåŠ¡åœ¨æœ¬åœ°è¿è¡Œ
- MongoDB ä½¿ç”¨ Docker å®¹å™¨

### ç”Ÿäº§ç¯å¢ƒ

- ä½¿ç”¨ Docker Compose æˆ– Kubernetes éƒ¨ç½²
- API æœåŠ¡ç‹¬ç«‹æ‰©å±•
- å‰ç«¯åº”ç”¨é€šè¿‡ CDN åˆ†å‘
- MongoDB ä½¿ç”¨äº‘æœåŠ¡ï¼ˆå¦‚ MongoDB Atlasï¼‰

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒé…ç½®

é¡¹ç›®æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼š

```json
// appsettings.json (é»˜è®¤)
// appsettings.Development.json (å¼€å‘ç¯å¢ƒ)
// appsettings.Production.json (ç”Ÿäº§ç¯å¢ƒ)
{
  "ConnectionStrings": {
    "mongodb": "mongodb://localhost:27017"
  },
  "JwtSettings": {
    "SecretKey": "your-secret-key",
    "Issuer": "Platform.ApiService",
    "Audience": "Platform.Users",
    "ExpirationMinutes": 60,
    "RefreshTokenExpirationDays": 7
  }
}
```

### å‰ç«¯é…ç½®

```typescript
// Platform.Admin/config/proxy.ts - å¼€å‘ä»£ç†é…ç½®
// Platform.Admin/.env - ç¯å¢ƒå˜é‡
// Platform.App/constants/apiConfig.ts - API é…ç½®
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### Aspire Dashboard

- æœåŠ¡çŠ¶æ€å®æ—¶ç›‘æ§
- è¯·æ±‚è¿½è¸ªå’Œæ€§èƒ½åˆ†æ
- æ—¥å¿—èšåˆå’ŒæŸ¥è¯¢
- æŒ‡æ ‡å¯è§†åŒ–

### æ—¥å¿—ç³»ç»Ÿ

- ä½¿ç”¨ .NET å†…ç½®æ—¥å¿—æ¡†æ¶
- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- æ”¯æŒæ—¥å¿—çº§åˆ«é…ç½®

## ğŸš« å¸¸è§é—®é¢˜

### Q: å¯åŠ¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
2. ç¡®ä¿ç«¯å£æœªè¢«å ç”¨ï¼ˆ15000-15003, 27017, 8081ï¼‰
3. æ¸…ç† Docker å®¹å™¨ï¼š`docker system prune`
4. é‡æ–°æ„å»ºï¼š`dotnet build`

### Q: å¦‚ä½•å•ç‹¬è°ƒè¯•æŸä¸ªæœåŠ¡ï¼Ÿ

- API æœåŠ¡ï¼š`dotnet run --project Platform.ApiService`
- ç®¡ç†åå°ï¼š`cd Platform.Admin && npm start`
- ç§»åŠ¨åº”ç”¨ï¼š`cd Platform.App && npm start`

### Q: æ•°æ®åº“å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ

- AppHost å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ– MongoDB
- Platform.ApiService å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
- æŸ¥çœ‹ `Platform.ApiService/Scripts/` ç›®å½•äº†è§£åˆå§‹åŒ–é€»è¾‘

## ğŸ“š é‡è¦æ–‡æ¡£

- [è®¤è¯ç³»ç»Ÿæ¶æ„è¯´æ˜](mdc:Platform.App/AUTH-ARCHITECTURE.md)
- [è®¤è¯ç³»ç»Ÿç»Ÿä¸€æ€»ç»“](mdc:Platform.App/AUTH-SYNC-SUMMARY.md)
- [è®¤è¯ç³»ç»Ÿä½¿ç”¨æŒ‡å—](mdc:Platform.App/README-AUTH.md)

## ğŸ¯ æœ€ä½³å®è·µ

1. **å§‹ç»ˆé€šè¿‡ AppHost å¯åŠ¨** - ç¡®ä¿æ‰€æœ‰æœåŠ¡æ­£ç¡®ç¼–æ’
2. **ä½¿ç”¨ Aspire Dashboard** - ç›‘æ§æœåŠ¡çŠ¶æ€å’Œæ€§èƒ½
3. **éµå¾ªä»£ç è§„èŒƒ** - ä½¿ç”¨ Biome (å‰ç«¯) å’Œ .editorconfig (åç«¯)
4. **ç¼–å†™å•å…ƒæµ‹è¯•** - ä¿è¯ä»£ç è´¨é‡
5. **æ›´æ–°æ–‡æ¡£** - åŠæ—¶æ›´æ–°é¡¹ç›®æ–‡æ¡£å’Œè§„åˆ™

