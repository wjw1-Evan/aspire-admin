---
description: èµ„æºæ£€æŸ¥è§„èŒƒ - ä½¿ç”¨ ResourceExtensions æ‰©å±•æ–¹æ³•
globs: Platform.ApiService/Controllers/*.cs,Platform.ApiService/Services/*.cs
---

# èµ„æºæ£€æŸ¥æ‰©å±•æ–¹æ³•ä½¿ç”¨è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

ä½¿ç”¨ `ResourceExtensions` æ‰©å±•æ–¹æ³•ç®€åŒ– null æ£€æŸ¥å’Œé”™è¯¯æŠ›å‡ºï¼Œè®©ä»£ç æ›´æµç•…æ˜“è¯»ã€‚

## âœ… æ¨èçš„ä½¿ç”¨æ–¹å¼

### 1. EnsureFound - ç¡®ä¿èµ„æºå­˜åœ¨

```csharp
// æ§åˆ¶å™¨å±‚
[HttpGet("{id}")]
public async Task<IActionResult> GetById(string id)
{
    var user = await _userService.GetUserByIdAsync(id);
    return Success(user.EnsureFound("ç”¨æˆ·", id));  // âœ… æµç•…çš„é“¾å¼è°ƒç”¨
}

// æœåŠ¡å±‚
public async Task<User> GetUserAsync(string id)
{
    var user = await _repository.GetByIdAsync(id);
    return user.EnsureFound("ç”¨æˆ·", id);  // âœ… ä¸å­˜åœ¨åˆ™æŠ›å¼‚å¸¸
}
```

### 2. EnsureSuccess - ç¡®ä¿æ“ä½œæˆåŠŸ

```csharp
[HttpPut("{id}/activate")]
public async Task<IActionResult> Activate(string id)
{
    var success = await _service.ActivateAsync(id);
    success.EnsureSuccess("ç”¨æˆ·", id);  // âœ… å¤±è´¥åˆ™æŠ›å¼‚å¸¸
    return Success("æ¿€æ´»æˆåŠŸ");
}

[HttpDelete("{id}")]
public async Task<IActionResult> Delete(string id)
{
    var success = await _service.DeleteAsync(id);
    success.EnsureSuccess("ç”¨æˆ·", id);  // âœ… ç®€æ´æ¸…æ™°
    return Success(ErrorMessages.DeleteSuccess);
}
```

## âŒ ç¦æ­¢çš„åšæ³•

```csharp
// âŒ ä¸è¦æ‰‹åŠ¨æ£€æŸ¥ null
[HttpGet("{id}")]
public async Task<IActionResult> GetById(string id)
{
    var user = await _userService.GetUserByIdAsync(id);
    if (user == null)
        throw new KeyNotFoundException($"ç”¨æˆ· {id} ä¸å­˜åœ¨");
    return Success(user);
}

// âŒ ä¸è¦æ‰‹åŠ¨æ£€æŸ¥å¸ƒå°”ç»“æœ
[HttpPut("{id}/activate")]
public async Task<IActionResult> Activate(string id)
{
    var success = await _service.ActivateAsync(id);
    if (!success)
        throw new KeyNotFoundException($"ç”¨æˆ· {id} ä¸å­˜åœ¨");
    return Success("æ¿€æ´»æˆåŠŸ");
}

// âŒ ä¸è¦ä½¿ç”¨ä¸ä¸€è‡´çš„é”™è¯¯æ¶ˆæ¯
throw new KeyNotFoundException($"ç”¨æˆ·ID {id} ä¸å­˜åœ¨");
throw new KeyNotFoundException($"æ‰¾ä¸åˆ°ç”¨æˆ· {id}");
```

## ğŸ”§ æ‰©å±•æ–¹æ³•è¯¦è§£

### EnsureFound<T>

```csharp
// ç­¾å
public static T EnsureFound<T>(this T? resource, string resourceName, string? resourceId = null) where T : class

// ç”¨æ³•ç¤ºä¾‹
var user = await GetUserByIdAsync(id);
return user.EnsureFound("ç”¨æˆ·", id);

// ä¸æä¾› ID çš„æƒ…å†µ
var settings = await GetSettingsAsync();
return settings.EnsureFound("ç³»ç»Ÿè®¾ç½®");

// å¦‚æœ resource ä¸º nullï¼Œä¼šæŠ›å‡º KeyNotFoundException
// æ¶ˆæ¯æ ¼å¼: "{resourceName} {resourceId} ä¸å­˜åœ¨" æˆ– "{resourceName}ä¸å­˜åœ¨"
```

### EnsureSuccess

```csharp
// ç­¾å
public static void EnsureSuccess(this bool success, string resourceName, string? resourceId = null)

// ç”¨æ³•ç¤ºä¾‹
var success = await UpdateAsync(id, request);
success.EnsureSuccess("ç”¨æˆ·", id);

// ä¸æä¾› ID çš„æƒ…å†µ
var success = await SendEmailAsync();
success.EnsureSuccess("é‚®ä»¶å‘é€");

// å¦‚æœ success ä¸º falseï¼Œä¼šæŠ›å‡º KeyNotFoundException
// æ¶ˆæ¯æ ¼å¼: "{resourceName} {resourceId} ä¸å­˜åœ¨" æˆ– "{resourceName}ä¸å­˜åœ¨"
```

## ğŸ’¡ ä½¿ç”¨æ¨¡å¼

### æ¨¡å¼ 1: é“¾å¼è°ƒç”¨ï¼ˆæœ€æ¨èï¼‰
```csharp
[HttpGet("{id}")]
public async Task<IActionResult> GetById(string id)
{
    var entity = await _service.GetByIdAsync(id);
    return Success(entity.EnsureFound("å®ä½“", id));  // âœ… ä¸€è¡Œæå®š
}
```

### æ¨¡å¼ 2: ä¸­é—´éªŒè¯
```csharp
public async Task<User> ProcessUser(string id)
{
    var user = await _repository.GetByIdAsync(id);
    user.EnsureFound("ç”¨æˆ·", id);  // âœ… éªŒè¯åç»§ç»­å¤„ç†
    
    // ç»§ç»­å¤„ç†ç”¨æˆ·...
    return user;
}
```

### æ¨¡å¼ 3: å¸ƒå°”ç»“æœæ£€æŸ¥
```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Update(string id, [FromBody] UpdateRequest request)
{
    var success = await _service.UpdateAsync(id, request);
    success.EnsureSuccess("å®ä½“", id);  // âœ… æ£€æŸ¥æ“ä½œç»“æœ
    return Success(ErrorMessages.UpdateSuccess);
}
```

## ğŸ¯ ä¸å…¶ä»–æ‰©å±•æ–¹æ³•é…åˆ

```csharp
// é…åˆ ValidationExtensions
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateRequest request)
{
    request.Name.EnsureNotEmpty("åç§°");  // ValidationExtensions
    request.Email.EnsureValidEmail();     // ValidationExtensions
    
    var entity = await _service.CreateAsync(request);
    return Success(entity, ErrorMessages.CreateSuccess);  // ErrorMessages
}

// é…åˆ BaseRepository
public async Task<Entity> GetActiveEntity(string id)
{
    var entity = await _repository.GetByIdAsync(id);
    return entity.EnsureFound("å®ä½“", id);  // ResourceExtensions
}
```

## ğŸ“š å‚è€ƒå®ç°

æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶ä½œä¸ºæ ‡å‡†ç¤ºä¾‹ï¼š
- [UserController.cs](mdc:Platform.ApiService/Controllers/UserController.cs)
- [RoleController.cs](mdc:Platform.ApiService/Controllers/RoleController.cs)
- [MenuController.cs](mdc:Platform.ApiService/Controllers/MenuController.cs)
- [ResourceExtensions.cs](mdc:Platform.ApiService/Extensions/ResourceExtensions.cs)
- [åŸºç¡€ç»„ä»¶ä½¿ç”¨æŒ‡å—](mdc:docs/optimization/BASE-COMPONENTS-GUIDE.md)
