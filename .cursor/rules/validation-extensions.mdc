---
description: å‚æ•°éªŒè¯è§„èŒƒ - ä½¿ç”¨ ValidationExtensions æ‰©å±•æ–¹æ³•
globs: Platform.ApiService/Controllers/*.cs,Platform.ApiService/Services/*.cs
---

# å‚æ•°éªŒè¯è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

ä½¿ç”¨ `ValidationExtensions` æ‰©å±•æ–¹æ³•è¿›è¡Œå‚æ•°éªŒè¯ï¼Œé¿å…å†—é•¿çš„ if-else åˆ¤æ–­ã€‚

## âœ… æ¨èçš„éªŒè¯æ–¹å¼

```csharp
// å­—ç¬¦ä¸²éªŒè¯
request.Username.EnsureNotEmpty("ç”¨æˆ·å");
request.Email.EnsureValidEmail();
request.Password.EnsureValidPassword();

// å¯¹è±¡éªŒè¯
request.EnsureNotNull("è¯·æ±‚å¯¹è±¡");

// é›†åˆéªŒè¯
request.UserIds.EnsureNotEmpty("ç”¨æˆ·IDåˆ—è¡¨");

// é•¿åº¦éªŒè¯
request.Name.EnsureLength("å§“å", 2, 50);

// èŒƒå›´éªŒè¯
request.Age.EnsureInRange("å¹´é¾„", 18, 120);

// å¯é€‰éªŒè¯ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰
if (email.IsValidEmail())
{
    // å¤„ç†æœ‰æ•ˆçš„é‚®ç®±
}
```

## âŒ ç¦æ­¢çš„åšæ³•

```csharp
// âŒ ä¸è¦ä½¿ç”¨å†—é•¿çš„ if åˆ¤æ–­
if (string.IsNullOrEmpty(request.Username))
    throw new ArgumentException(string.Format(ErrorMessages.ParameterRequired, "ç”¨æˆ·å"));

// âŒ ä¸è¦é‡å¤ç¼–å†™éªŒè¯é€»è¾‘
if (string.IsNullOrWhiteSpace(email))
{
    throw new ArgumentException("é‚®ç®±ä¸èƒ½ä¸ºç©º");
}
try
{
    var addr = new System.Net.Mail.MailAddress(email);
    if (addr.Address != email)
    {
        throw new ArgumentException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
    }
}
catch
{
    throw new ArgumentException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
}

// âŒ ä¸è¦ç¡¬ç¼–ç é”™è¯¯æ¶ˆæ¯
throw new ArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");

// âœ… åº”è¯¥ä½¿ç”¨
request.Username.EnsureNotEmpty("ç”¨æˆ·å");
```

## ğŸ“‹ å¯ç”¨çš„éªŒè¯æ–¹æ³•

### å­—ç¬¦ä¸²éªŒè¯
- `EnsureNotEmpty(paramName)` - ç¡®ä¿ä¸ä¸ºç©º
- `EnsureLength(paramName, min, max)` - éªŒè¯é•¿åº¦èŒƒå›´
- `EnsureValidEmail(paramName)` - éªŒè¯é‚®ç®±æ ¼å¼
- `EnsureValidUsername(paramName)` - éªŒè¯ç”¨æˆ·åæ ¼å¼ï¼ˆ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰
- `EnsureValidPassword(paramName)` - éªŒè¯å¯†ç å¼ºåº¦ï¼ˆ6-50å­—ç¬¦ï¼‰

### å¯¹è±¡éªŒè¯
- `EnsureNotNull(paramName)` - ç¡®ä¿å¯¹è±¡ä¸ä¸ºnull

### é›†åˆéªŒè¯
- `EnsureNotEmpty(paramName)` - ç¡®ä¿é›†åˆä¸ä¸ºç©ºä¸”æœ‰å…ƒç´ 

### æ•°å€¼éªŒè¯
- `EnsureInRange(paramName, min, max)` - éªŒè¯å€¼åœ¨èŒƒå›´å†…

### åˆ¤æ–­æ–¹æ³•ï¼ˆä¸æŠ›å¼‚å¸¸ï¼‰
- `IsValidEmail()` - åˆ¤æ–­é‚®ç®±æ˜¯å¦æœ‰æ•ˆ
- `IsValidUsername()` - åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦æœ‰æ•ˆ
- `IsValidPassword()` - åˆ¤æ–­å¯†ç æ˜¯å¦æœ‰æ•ˆ

### å®ç”¨æ–¹æ³•
- `NullIfEmpty()` - ç©ºå­—ç¬¦ä¸²è½¬ nullï¼ˆç”¨äºå¯é€‰å‚æ•°ï¼‰
- `Truncate(maxLength)` - æˆªæ–­å­—ç¬¦ä¸²åˆ°æŒ‡å®šé•¿åº¦

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### æ§åˆ¶å™¨å±‚
```csharp
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateRequest request)
{
    // âœ… ä½¿ç”¨æ‰©å±•æ–¹æ³•éªŒè¯
    request.Name.EnsureNotEmpty("åç§°");
    request.Email.EnsureValidEmail();
    request.UserIds.EnsureNotEmpty("ç”¨æˆ·åˆ—è¡¨");
    
    var result = await _service.CreateAsync(request);
    return Success(result, ErrorMessages.CreateSuccess);
}
```

### æœåŠ¡å±‚
```csharp
public async Task<User> CreateUserAsync(CreateUserRequest request)
{
    // âœ… åœ¨æœåŠ¡å±‚ä¹Ÿå¯ä»¥ä½¿ç”¨
    request.Username.EnsureValidUsername();
    request.Password.EnsureValidPassword();
    request.Email.EnsureValidEmail();
    
    // ä¸šåŠ¡é€»è¾‘...
}
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [ValidationExtensions.cs](mdc:Platform.ApiService/Extensions/ValidationExtensions.cs)
- [ErrorMessages å¸¸é‡](mdc:Platform.ApiService/Constants/UserConstants.cs)
- [åŸºç¡€ç»„ä»¶ä½¿ç”¨æŒ‡å—](mdc:docs/optimization/BASE-COMPONENTS-GUIDE.md)
