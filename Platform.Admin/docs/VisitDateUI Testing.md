# 走访时间必填字段 - 前端测试用例

## 🧪 测试场景

### 1. 新建走访任务

#### 测试步骤
1. 访问: http://localhost:15001/park-management/visit-task
2. 点击"新增任务"按钮
3. **不填写**走访时间，填写其他必填字段
4. 点击"确定"按钮

#### 预期结果
- ❌ 应该显示"请选择走访时间"的红色错误提示
- ❌ 表单提交失败，数据不会保存
- ❌ DatePicker 组件显示红色边框

#### 正确测试步骤
1. 访问: http://localhost:15001/park-management/visit-task
2. 点击"新增任务"按钮
3. **走访时间**应该**自动设置为当前时间**
4. 填写其他必填字段
5. 点击"确定"按钮

#### 预期结果
- ✅ 应该成功创建走访任务
- ✅ 应该显示"添加成功"的消息提示
- ✅ 走访时间应该有有效值

### 2. 编辑走访任务

#### 测试步骤
1. 在列表中找到一个**没有走访时间**的历史任务
2. 点击该任务的"编辑"按钮
3. **走访时间**应该**自动设置为当前时间**
4. 修改其他字段
5. 点击"确定"按钮

#### 预期结果
- ✅ 应该成功更新走访任务
- ✅ 走访时间应该被设置为当前时间
- ✅ 应该显示"修改成功"的消息提示

#### 测试有时间的记录
1. 在列表中找到一个**有走访时间**的任务
2. 点击该任务的"编辑"按钮
3. **走访时间**应该**显示原有的时间值**
4. 修改走访时间为其他时间
5. 点击"确定"按钮

#### 预期结果
- ✅ 应该成功更新走访任务
- ✅ 走访时间应该显示更新后的时间
- ✅ 应该显示"修改成功"的消息提示

### 3. 表单验证测试

#### 测试步骤
1. 点击"新增任务"按钮
2. 尝试清空走访时间字段
3. 点击其他表单字段触发验证

#### 预期结果
- ❌ 走访时间字段应该立即显示验证错误
- ❌ 错误消息为"请选择走访时间"
- ❌ "确定"按钮应该保持禁用状态（如果有基于验证的禁用逻辑）

## 🎯 验证要点

### 1. UI验证
- [ ] 走访时间字段有红色星号（*）标识必填
- [ ] 未选择时间时显示红色错误提示
- [ ] DatePicker 组件在验证失败时有红色边框
- [ ] 错误提示文字为"请选择走访时间"

### 2. 功能验证
- [ ] 新建任务时自动设置当前时间为默认值
- [ ] 编辑有时间的任务时保留原有时间
- [ ] 编辑无时间的任务时自动设置当前时间
- [ ] 时间选择器支持日期和时间选择
- [ ] 时间格式显示为 "YYYY-MM-DD HH:mm"

### 3. 数据验证
- [ ] 不选择时间无法提交表单
- [ ] 选择时间后可以正常提交表单
- [ ] 提交的时间数据格式正确 (ISO string)
- [ ] 后端API接收到的visitDate字段不为空

### 4. 交互验证
- [ ] 点击编辑按钮时表单数据正确填充
- [ ] 点击取消按钮时表单正确重置
- [ ] 新建和编辑切换时表单状态正确
- [ ] 重复提交处理正确

## 🐛 常见问题及解决方案

### 问题1: 表单验证不生效
**现象**: 不选择时间也能提交表单
**可能原因**: 
- rules 属性配置错误
- form.setFieldsValue 覆盖了验证

**解决方案**:
```tsx
// 确保rules配置正确
rules={[{ required: true, message: '请选择走访时间' }]}

// 避免在setFieldsValue时覆盖验证
form.setFieldsValue({
  ...values,
  // 不要覆盖 visitDate 的验证状态
});
```

### 问题2: 默认时间不显示
**现象**: 新建任务时时间字段为空
**可能原因**: 
- useEffect 依赖项不正确
- dayjs() 调用时机不对

**解决方案**:
```tsx
// 确保在模态框打开后设置默认值
useEffect(() => {
    if (isModalVisible && !editingTask) {
        form.setFieldsValue({
            visitDate: dayjs()
        });
    }
}, [isModalVisible, editingTask, form]);
```

### 问题3: 编辑时时间格式错误
**现象**: 编辑时时间显示不正确或提交失败
**可能原因**: 
- 后端返回的时间格式解析错误
- dayjs 格式化参数错误

**解决方案**:
```tsx
// 确保时间格式正确
visitDate: editingTask.visitDate ? dayjs(editingTask.visitDate) : dayjs()

// 提交时正确格式化
visitDate: values.visitDate.toISOString()
```

## 📱 移动端测试要点

### 响应式布局
- [ ] 移动端 DatePicker 显示正常
- [ ] 错误提示在小屏幕上可读
- [ ] 表单按钮间距合适

### 触摸操作
- [ ] 时间选择器在移动端可正常操作
- [ ] 表单提交按钮触摸响应正常
- [ ] 表单重置功能正常

---

## ✅ 测试完成清单

完成以上测试后，走访时间字段将成为真正意义上的必填字段，确保所有走访任务都有准确的时间信息，为统计报表提供可靠的数据基础。