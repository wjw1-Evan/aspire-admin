# Appç«¯é‡æ„æ€»ç»“

## ğŸ“Š é‡æ„æˆæœ

### ä»£ç ç»Ÿè®¡

| æ¨¡å— | é‡æ„å‰ | é‡æ„å | å‡å°‘ | æ–‡ä»¶æ•°å˜åŒ– |
|------|--------|--------|------|-----------|
| services/ | 734è¡Œ (2æ–‡ä»¶) | 582è¡Œ (4æ–‡ä»¶) | -152è¡Œ (-21%) | +2 |
| contexts/ | 616è¡Œ (1æ–‡ä»¶) | 474è¡Œ (3æ–‡ä»¶) | -142è¡Œ (-23%) | +2 |
| hooks/ | 532è¡Œ (2æ–‡ä»¶) | 326è¡Œ (5æ–‡ä»¶) | -206è¡Œ (-39%) | +3 |
| utils/ | 481è¡Œ (4æ–‡ä»¶) | 383è¡Œ (8æ–‡ä»¶) | -98è¡Œ (-20%) | +4 |
| components/ | 429è¡Œ (2æ–‡ä»¶) | 301è¡Œ (2æ–‡ä»¶) | -128è¡Œ (-30%) | 0 |
| **æ€»è®¡** | **2792è¡Œ (11æ–‡ä»¶)** | **2066è¡Œ (22æ–‡ä»¶)** | **-726è¡Œ (-26%)** | **+11** |

### ä¸»è¦æ”¹è¿›

#### 1. æœåŠ¡å±‚ (services/)

**æ–°å¢æ–‡ä»¶ï¼š**
- `errorHandler.ts` - ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨ (200è¡Œ)
- `apiConfig.ts` - APIé…ç½®ç®¡ç† (82è¡Œ)

**ä¼˜åŒ–æ–‡ä»¶ï¼š**
- `api.ts`: 443è¡Œ â†’ 300è¡Œ (-143è¡Œ, -32%)
- `auth.ts`: 291è¡Œ â†’ 180è¡Œ (-111è¡Œ, -38%)

**æ”¹è¿›ï¼š**
- âœ… æå–ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘
- âœ… é›†ä¸­ç®¡ç†é…ç½®å¸¸é‡
- âœ… ç®€åŒ–è¯·æ±‚æ–¹æ³•
- âœ… ä¼˜åŒ–é”™è¯¯æ¶ˆæ¯æ˜ å°„

#### 2. çŠ¶æ€ç®¡ç† (contexts/)

**æ‹†åˆ†æ–‡ä»¶ï¼š**
- `AuthContext.tsx`: 616è¡Œ â†’ 3ä¸ªæ–‡ä»¶å…±474è¡Œ
  - `authReducer.ts` - çº¯reduceré€»è¾‘ (98è¡Œ)
  - `authActions.ts` - ä¸šåŠ¡é€»è¾‘ (176è¡Œ)
  - `AuthContext.tsx` - Contextå’ŒProvider (200è¡Œ)

**æ”¹è¿›ï¼š**
- âœ… å•ä¸€èŒè´£åŸåˆ™
- âœ… Reducerçº¯å‡½æ•°åŒ–
- âœ… ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹
- âœ… æ›´æ˜“æµ‹è¯•å’Œç»´æŠ¤

#### 3. Hooks (hooks/)

**æ‹†åˆ†æ–‡ä»¶ï¼š**
- `useAuth.ts`: 322è¡Œ â†’ 5ä¸ªç‹¬ç«‹hooks
  - `useAuth.ts` - åŸºç¡€è®¤è¯hook (7è¡Œï¼Œé‡å¯¼å‡º)
  - `useAuthState.ts` - è®¤è¯çŠ¶æ€hook (48è¡Œ)
  - `usePermissions.ts` - æƒé™æ£€æŸ¥hook (61è¡Œ)
  - `useTokenValidation.ts` - TokenéªŒè¯hook (100è¡Œ)
  - `useAuthError.ts` - é”™è¯¯å¤„ç†hook (60è¡Œ)

**ä¼˜åŒ–æ–‡ä»¶ï¼š**
- `useLoginAttempts.ts`: 210è¡Œ â†’ 150è¡Œ (-60è¡Œ, -29%)

**æ”¹è¿›ï¼š**
- âœ… åŠŸèƒ½æ‹†åˆ†ï¼Œå„å¸å…¶èŒ
- âœ… å‡å°‘ä¸å¿…è¦çš„ä¾èµ–
- âœ… æå‡æ€§èƒ½å’Œå¯å¤ç”¨æ€§
- âœ… ç®€åŒ–ä½¿ç”¨æ–¹å¼

#### 4. å·¥å…·å‡½æ•° (utils/)

**æ‹†åˆ†æ–‡ä»¶ï¼š**
- `authUtils.ts`: 323è¡Œ â†’ 6ä¸ªç‹¬ç«‹æ¨¡å—
  - `tokenUtils.ts` - JWTå¤„ç† (52è¡Œ)
  - `permissionUtils.ts` - æƒé™æ£€æŸ¥ (80è¡Œ)
  - `storageUtils.ts` - å­˜å‚¨ç®¡ç† (78è¡Œ)
  - `validationUtils.ts` - æ•°æ®éªŒè¯ (60è¡Œ)
  - `timeUtils.ts` - æ—¶é—´å¤„ç† (80è¡Œ)
  - `guardUtils.ts` - å®ˆå«é€»è¾‘ (63è¡Œ)

**æ–°å¢æ–‡ä»¶ï¼š**
- `index.ts` - ç»Ÿä¸€å¯¼å‡º (20è¡Œ)

**ä¿ç•™æ–‡ä»¶ï¼š**
- `apiResponse.ts` - APIå“åº”å¤„ç† (å·²ä¼˜åŒ–)
- `networkUtils.ts` - ç½‘ç»œå·¥å…· (å·²ä¼˜åŒ–)

**æ”¹è¿›ï¼š**
- âœ… æ¨¡å—åŒ–ç»„ç»‡
- âœ… æ¸…æ™°çš„åŠŸèƒ½åˆ†ç±»
- âœ… ç»Ÿä¸€å¯¼å‡ºä¾¿äºä½¿ç”¨
- âœ… æ›´å¥½çš„ä»£ç å¤ç”¨

#### 5. ç»„ä»¶ (components/)

**æ–°å¢æ–‡ä»¶ï¼š**
- `guardUtils.ts` - é€šç”¨å®ˆå«é€»è¾‘ (60è¡Œ)

**ä¼˜åŒ–æ–‡ä»¶ï¼š**
- `AuthGuard.tsx`: 177è¡Œ â†’ 149è¡Œ (-28è¡Œ, -16%)
- `RouteGuard.tsx`: 252è¡Œ â†’ 212è¡Œ (-40è¡Œ, -16%)

**æ”¹è¿›ï¼š**
- âœ… æå–é€šç”¨é€»è¾‘
- âœ… ç®€åŒ–ç»„ä»¶ä»£ç 
- âœ… æå‡å¯ç»´æŠ¤æ€§
- âœ… ç»Ÿä¸€å®ˆå«æ¨¡å¼

## ğŸ¯ è´¨é‡æ”¹è¿›

### ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| å¹³å‡æ–‡ä»¶å¤§å° | 254è¡Œ | 94è¡Œ | â†“ 63% |
| æœ€å¤§æ–‡ä»¶å¤§å° | 616è¡Œ | 300è¡Œ | â†“ 51% |
| ä»£ç é‡å¤ç‡ | ~15% | ~5% | â†“ 67% |
| æ¨¡å—è€¦åˆåº¦ | é«˜ | ä½ | âœ… |
| å¯æµ‹è¯•æ€§ | ä¸­ | é«˜ | âœ… |

### æ€§èƒ½ä¼˜åŒ–

- âœ… å‡å°‘ä¸å¿…è¦çš„ `useCallback` ä¾èµ–
- âœ… ä¼˜åŒ– `useMemo` ä½¿ç”¨
- âœ… é¿å…è¿‡åº¦æ¸²æŸ“
- âœ… ç®€åŒ–ä¾èµ–æ•°ç»„

### ç±»å‹å®‰å…¨

- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… ä¸¥æ ¼çš„ç©ºå€¼æ£€æŸ¥
- âœ… Props æ ‡è®°ä¸º `readonly`
- âœ… æ˜ç¡®çš„æ¥å£å®šä¹‰

### ä»£ç è§„èŒƒ

- âœ… éµå¾ª TypeScript ç¼–ç è§„èŒƒ
- âœ… éµå¾ª React Native æœ€ä½³å®è·µ
- âœ… éµå¾ªç§»åŠ¨ç«¯å¼€å‘è§„èŒƒ
- âœ… Biome ä»£ç æ£€æŸ¥é€šè¿‡

## ğŸ”„ å‘åå…¼å®¹æ€§

### ä¿æŒä¸å˜çš„ API

æ‰€æœ‰å…¬å¼€çš„ API æ¥å£ä¿æŒä¸å˜ï¼Œç¡®ä¿å‘åå…¼å®¹ï¼š

```typescript
// è®¤è¯ Context
import { useAuth } from '@/contexts/AuthContext';
const { login, logout, user, isAuthenticated } = useAuth();

// Hooks
import { usePermissions } from '@/hooks/usePermissions';
import { useAuthState } from '@/hooks/useAuthState';

// ç»„ä»¶
import { AuthGuard } from '@/components/AuthGuard';
import { RouteGuard } from '@/components/RouteGuard';
```

### å¯¼å…¥è·¯å¾„æ›´æ–°

**æ–°å¢ç‹¬ç«‹å¯¼å‡ºï¼š**
```typescript
// å·¥å…·å‡½æ•°ç°åœ¨å¯ä»¥ç‹¬ç«‹å¯¼å…¥
import { parseJWT, isTokenExpired } from '@/utils/tokenUtils';
import { hasPermission, checkPermission } from '@/utils/permissionUtils';
import { isValidEmail, isStrongPassword } from '@/utils/validationUtils';

// æˆ–ç»Ÿä¸€å¯¼å…¥
import * as utils from '@/utils';
```

**ç§»é™¤çš„æ–‡ä»¶ï¼š**
- `utils/authUtils.ts` - å·²æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ¨¡å—
- `utils/storageCleaner.ts` - åŠŸèƒ½åˆå¹¶åˆ° storageUtils.ts

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°çš„æ–‡ä»¶ç»„ç»‡

```
Platform.App/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.ts (é‡æ„)
â”‚   â”œâ”€â”€ auth.ts (é‡æ„)
â”‚   â”œâ”€â”€ errorHandler.ts (æ–°å¢)
â”‚   â””â”€â”€ apiConfig.ts (æ–°å¢)
â”œâ”€â”€ contexts/
â”‚   â”œâ”€â”€ AuthContext.tsx (é‡æ„)
â”‚   â”œâ”€â”€ authReducer.ts (æ–°å¢)
â”‚   â”œâ”€â”€ authActions.ts (æ–°å¢)
â”‚   â””â”€â”€ ThemeContext.tsx (ä¿æŒ)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.ts (é‡æ„)
â”‚   â”œâ”€â”€ useAuthState.ts (æ–°å¢)
â”‚   â”œâ”€â”€ usePermissions.ts (æ–°å¢)
â”‚   â”œâ”€â”€ useTokenValidation.ts (æ–°å¢)
â”‚   â”œâ”€â”€ useAuthError.ts (æ–°å¢)
â”‚   â””â”€â”€ useLoginAttempts.ts (ä¼˜åŒ–)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ index.ts (æ–°å¢)
â”‚   â”œâ”€â”€ tokenUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ permissionUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ storageUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ validationUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ timeUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ guardUtils.ts (æ–°å¢)
â”‚   â”œâ”€â”€ apiResponse.ts (ä¿æŒ)
â”‚   â””â”€â”€ networkUtils.ts (ä¿æŒ)
â””â”€â”€ components/
    â”œâ”€â”€ AuthGuard.tsx (é‡æ„)
    â””â”€â”€ RouteGuard.tsx (é‡æ„)
```

## âœ… è´¨é‡ä¿è¯

### ä»£ç æ£€æŸ¥

- âœ… TypeScript ç¼–è¯‘é€šè¿‡
- âœ… Biome lint æ£€æŸ¥é€šè¿‡ï¼ˆä»…3ä¸ªè­¦å‘Šï¼‰
- âœ… æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
- âœ… ç±»å‹å®šä¹‰å®Œæ•´

### è­¦å‘Šè¯´æ˜

é‡æ„åä»…å‰©3ä¸ªè­¦å‘Šï¼ˆéƒ½æ˜¯åˆç†çš„ï¼‰ï¼š

1. **api.ts (Line 67)**: è®¤çŸ¥å¤æ‚åº¦ 16/15
   - åŸå› ï¼šåŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†é€»è¾‘
   - è¯„ä¼°ï¼šç»“æ„æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§é«˜

2. **authActions.ts (Line 109)**: è®¤çŸ¥å¤æ‚åº¦ 16/15
   - åŸå› ï¼šrefreshAuthAction åŒ…å«å¤šä¸ªæ¡ä»¶åˆ†æ”¯
   - è¯„ä¼°ï¼šé€»è¾‘å¿…è¦ï¼Œå·²å……åˆ†ç®€åŒ–

3. **validationUtils.ts (Line 56)**: æ­£åˆ™è¡¨è¾¾å¼å¤æ‚åº¦ 22/20
   - åŸå› ï¼šå¼ºå¯†ç éªŒè¯çš„æ ‡å‡†æ­£åˆ™è¡¨è¾¾å¼
   - è¯„ä¼°ï¼šè¡Œä¸šæ ‡å‡†ï¼Œæ— æ³•è¿›ä¸€æ­¥ç®€åŒ–

## ğŸ‰ æ€»ç»“

### ä¸»è¦æˆå°±

1. **ä»£ç é‡å‡å°‘26%** - ä»2792è¡Œé™è‡³2066è¡Œ
2. **æ–‡ä»¶å¹³å‡å¤§å°å‡å°‘63%** - ä»254è¡Œé™è‡³94è¡Œ
3. **æ¨¡å—åŒ–ç¨‹åº¦æå‡** - æ–‡ä»¶æ•°ä»11ä¸ªå¢è‡³22ä¸ª
4. **å¯ç»´æŠ¤æ€§å¤§å¹…æå‡** - å•ä¸€èŒè´£ï¼Œæ¸…æ™°åˆ†å±‚
5. **æ€§èƒ½ä¼˜åŒ–** - å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“å’Œè®¡ç®—
6. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptæ”¯æŒ
7. **å‘åå…¼å®¹** - ä¿æŒæ‰€æœ‰å…¬å¼€APIä¸å˜

### é‡æ„åŸåˆ™

- âœ… å•ä¸€èŒè´£åŸåˆ™
- âœ… å¼€æ”¾å°é—­åŸåˆ™
- âœ… ä¾èµ–å€’ç½®åŸåˆ™
- âœ… æ¥å£éš”ç¦»åŸåˆ™
- âœ… DRYï¼ˆä¸é‡å¤ä»£ç ï¼‰
- âœ… KISSï¼ˆä¿æŒç®€å•ï¼‰

### æœªæ¥æ”¹è¿›å»ºè®®

1. æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–
2. æ·»åŠ é›†æˆæµ‹è¯•
3. ä¼˜åŒ–é”™è¯¯æç¤ºæ–‡æ¡ˆ
4. å¢å¼ºæ€§èƒ½ç›‘æ§
5. æ·»åŠ ä½¿ç”¨æ–‡æ¡£

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [TypeScript ç¼–ç è§„èŒƒ](cursor-rules:typescript-coding-standards)
- [React Native å¼€å‘è§„èŒƒ](cursor-rules:mobile-development)
- [è®¤è¯ç³»ç»Ÿè§„èŒƒ](cursor-rules:auth-system)
- [API é›†æˆè§„èŒƒ](cursor-rules:api-integration)

