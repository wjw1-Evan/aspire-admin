<view class="container">
  <!-- Period Selector -->
  <view class="period-selector card-style">
    <view 
      class="period-item {{currentPeriod === item.value ? 'active' : ''}}" 
      wx:for="{{periods}}" 
      wx:key="value"
      bindtap="switchPeriod"
      data-value="{{item.value}}"
    >
      {{item.label}}
    </view>
  </view>

  <loading wx:if="{{loading}}" />

  <block wx:if="{{!loading && statistics}}">
    <!-- Top Stats Grid -->
    <view class="stats-grid">
      <view class="stat-card card-style">
        <view class="card-header">
          <view class="icon-box blue">项</view>
          <text class="title">项目总数</text>
        </view>
        <view class="card-body">
          <text class="value">{{statistics.project.totalProjects}}</text>
          <view class="progress-box">
             <view class="progress-info">
               <text>完成度</text>
               <text>{{projectCompletion}}%</text>
             </view>
             <progress percent="{{projectCompletion}}" stroke-width="4" color="#1890ff" />
          </view>
        </view>
      </view>

      <view class="stat-card card-style">
        <view class="card-header">
          <view class="icon-box green">任</view>
          <text class="title">任务总数</text>
        </view>
        <view class="card-body">
          <text class="value">{{statistics.task.totalTasks}}</text>
          <view class="progress-box">
             <view class="progress-info">
               <text>完成率</text>
               <text>{{statistics.task.completionRate}}%</text>
             </view>
             <progress percent="{{statistics.task.completionRate}}" stroke-width="4" color="#52c41a" />
          </view>
        </view>
      </view>
    </view>

    <!-- Detail Sections -->
    <view class="section-card card-style">
      <view class="section-header">项目状态分布</view>
      <view class="status-rows">
        <view class="status-row">
          <text class="label">进行中</text>
          <text class="num primary">{{statistics.project.inProgressProjects}}</text>
        </view>
        <view class="status-row">
          <text class="label">已完成</text>
          <text class="num success">{{statistics.project.completedProjects}}</text>
        </view>
        <view class="status-row">
          <text class="label">延迟项目</text>
          <text class="num danger">{{statistics.project.delayedProjects}}</text>
        </view>
      </view>
    </view>

    <view class="section-card card-style">
      <view class="section-header">里程碑与团队</view>
      <view class="split-stats">
        <view class="split-item">
          <text class="label">里程碑总数</text>
          <text class="num">{{statistics.milestone.totalMilestones}}</text>
          <view class="sub-tags">
            <text class="tag-success">已达成 {{statistics.milestone.achievedMilestones}}</text>
          </view>
        </view>
        <view class="split-item">
          <text class="label">团队人数</text>
          <text class="num">{{statistics.member.totalMembers}}</text>
          <view class="sub-tags">
             <text class="tag-blue">核心成员</text>
          </view>
        </view>
      </view>
    </view>

    <!-- AI Action -->
    <view class="ai-button-wrap">
      <button class="ai-btn" bindtap="generateAiReport" loading="{{aiLoading}}">
        <text class="sparkle">✨</text> AI 深度分析报告
      </button>
    </view>
  </block>

  <view class="empty-state" wx:if="{{!loading && !statistics}}">
    <text>暂无统计数据</text>
  </view>
</view>
