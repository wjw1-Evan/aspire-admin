<view class="container">
  <!-- Period Selector -->
  <view class="period-selector card-style">
    <view 
      class="period-item {{currentPeriod === item.value ? 'active' : ''}}" 
      wx:for="{{periods}}" 
      wx:key="value"
      bindtap="switchPeriod"
      data-value="{{item.value}}"
    >
      {{item.label}}
    </view>
  </view>

  <loading wx:if="{{loading}}" />

  <block wx:if="{{!loading && statistics}}">
    <!-- Top Stats Grid -->
    <view class="stats-grid">
      <view class="stat-card card-style">
        <view class="card-header">
          <view class="icon-box blue">项</view>
          <text class="title">{{t['stats.project_total']}}</text>
        </view>
        <view class="card-body">
          <text class="value">{{statistics.project.totalProjects}}</text>
          <view class="progress-box">
             <view class="progress-info">
               <text>{{t['stats.completion_label']}}</text>
               <text>{{projectCompletion}}%</text>
             </view>
             <progress percent="{{projectCompletion}}" stroke-width="4" color="#1890ff" />
          </view>
        </view>
      </view>

      <view class="stat-card card-style">
        <view class="card-header">
          <view class="icon-box green">任</view>
          <text class="title">{{t['stats.task_total']}}</text>
        </view>
        <view class="card-body">
          <text class="value">{{statistics.task.totalTasks}}</text>
          <view class="progress-box">
             <view class="progress-info">
               <text>{{t['stats.completion_rate_label']}}</text>
               <text>{{statistics.task.completionRate}}%</text>
             </view>
             <progress percent="{{statistics.task.completionRate}}" stroke-width="4" color="#52c41a" />
          </view>
        </view>
      </view>
    </view>

    <!-- Detail Sections -->
    <view class="section-card card-style">
      <view class="section-header">{{t['stats.project_status']}}</view>
      <view class="status-rows">
        <view class="status-row">
          <text class="label">{{t['stats.in_progress']}}</text>
          <text class="num primary">{{statistics.project.inProgressProjects}}</text>
        </view>
        <view class="status-row">
          <text class="label">{{t['stats.completed']}}</text>
          <text class="num success">{{statistics.project.completedProjects}}</text>
        </view>
        <view class="status-row">
          <text class="label">{{t['stats.delayed']}}</text>
          <text class="num danger">{{statistics.project.delayedProjects}}</text>
        </view>
      </view>
    </view>

    <view class="section-card card-style">
      <view class="section-header">{{t['stats.milestone_team']}}</view>
      <view class="split-stats">
        <view class="split-item">
          <text class="label">{{t['stats.milestones_total']}}</text>
          <text class="num">{{statistics.milestone.totalMilestones}}</text>
          <view class="sub-tags">
            <text class="tag-success">{{t['stats.milestones_achieved']}} {{statistics.milestone.achievedMilestones}}</text>
          </view>
        </view>
        <view class="split-item">
          <text class="label">{{t['stats.team_size']}}</text>
          <text class="num">{{statistics.member.totalMembers}}</text>
          <view class="sub-tags">
             <text class="tag-blue">{{t['stats.core_members']}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- AI Action -->
    <view class="ai-button-wrap">
      <button class="ai-btn" bindtap="generateAiReport" loading="{{aiLoading}}">
        {{t['stats.ai_deep_report']}}
      </button>
    </view>
  </block>

  <view class="empty-state" wx:if="{{!loading && !statistics}}">
    <text>{{t['stats.no_data']}}</text>
  </view>
</view>
