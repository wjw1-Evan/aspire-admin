<view class="container">
  <!-- Statistics Section -->
  <view class="biz-card" wx:if="{{statistics}}" style="margin: 0 0 24rpx 0; border-radius: 0;">
    <view class="stats-overview">
      <view class="stats-item">
        <text class="num">{{statistics.totalTasks || 0}}</text>
        <text class="label">{{t['task.list.total']}}</text>
      </view>
      <view class="stats-item">
        <text class="num" style="color: #1890ff;">{{statistics.inProgressTasks || 0}}</text>
        <text class="label">{{t['task.list.in_progress']}}</text>
      </view>
      <view class="stats-item">
        <text class="num" style="color: #52c41a;">{{statistics.completedTasks || 0}}</text>
        <text class="label">{{t['task.list.completed']}}</text>
      </view>
      <view class="stats-item">
        <text class="num" style="color: #faad14;">{{statistics.completionRate || 0}}%</text>
        <text class="label">{{t['task.list.completion_rate']}}</text>
      </view>
    </view>
  </view>

  <!-- Filter Tabs (Sticky) -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentStatus === item.value ? 'active' : ''}}" 
      wx:for="{{statusTabs}}" 
      wx:key="value"
      bindtap="switchTab"
      data-status="{{item.value}}"
    >
      {{item.label}}
    </view>
  </view>

  <!-- Task List -->
  <view class="list-container">
    <block wx:if="{{tasks.length > 0}}">
      <view 
        class="biz-card" 
        wx:for="{{tasks}}" 
        wx:key="id"
        bindtap="goToDetail"
        data-id="{{item.id}}"
      >
        <view class="card-header">
          <view style="flex: 1; overflow: hidden;">
            <view class="card-title">{{item.taskName}}</view>
            <view class="project-tag" wx:if="{{item.projectName}}">{{item.projectName}}</view>
          </view>
          <view class="priority-tag priority-{{item.priority}}">{{priorityMap[item.priority]}}</view>
        </view>

        <view class="card-body">
          <view class="info-row">
            <text class="info-label">{{t['task.list.assignee']}}</text>
            <text class="info-value">{{item.assignedToName || t['task.list.unassigned']}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">{{t['task.list.deadline']}}</text>
            <text class="info-value">{{item.plannedEndTime || '-'}}</text>
          </view>

          <!-- Status & Progress -->
          <view style="margin-top: 24rpx;">
            <view class="flex justify-between" style="margin-bottom: 8rpx; font-size: 24rpx;">
              <text class="status-tag status-{{item.status === 2 ? 'Processing' : (item.status === 3 ? 'Completed' : 'Pending')}}">{{statusMap[item.status]}}</text>
              <text style="font-weight: bold; color: #1890ff;">{{item.completionPercentage}}%</text>
            </view>
            <progress 
              percent="{{item.completionPercentage}}" 
              stroke-width="6" 
              color="{{item.status === 3 ? '#52c41a' : '#1890ff'}}" 
              border-radius="4"
            />
          </view>
        </view>
      </view>
    </block>

    <!-- Empty State -->
    <view class="empty-wrap" wx:elif="{{!loading}}">
      <view class="iconfont icon-task" style="font-size: 120rpx; color: #eee;"></view>
      <text>{{t['task.list.no_data']}}</text>
    </view>

    <!-- Loading -->
    <view class="loading-wrap" wx:if="{{loading}}">
      <view class="loading"></view>
      <text>{{t['task.list.loading_more']}}</text>
    </view>

    <view class="text-secondary" style="text-align: center; padding: 30rpx 0; font-size: 24rpx;" wx:if="{{!hasMore && tasks.length > 0}}">
      {{t['task.list.no_more']}}
    </view>
  </view>

  <!-- Floating Action Button (Fixed) -->
  <view class="fab-group">
    <view class="add-btn" bindtap="goToCreate">
      <text class="iconfont icon-plus"></text>
    </view>
  </view>
</view>
