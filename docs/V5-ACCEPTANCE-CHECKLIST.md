# v5.0 éªŒæ”¶æ£€æŸ¥æ¸…å•

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯

**ç‰ˆæœ¬**: v5.0  
**å‘å¸ƒæ—¥æœŸ**: 2025-01-14  
**æ£€æŸ¥æ—¥æœŸ**: _______  
**æ£€æŸ¥äºº**: _______

## âœ… ä»£ç æ£€æŸ¥

### ç¼–è¯‘å’Œæ„å»º

- [ ] åç«¯ç¼–è¯‘æ— é”™è¯¯ï¼š`dotnet build Platform.ApiService/Platform.ApiService.csproj`
- [ ] åç«¯ç¼–è¯‘æ— è­¦å‘Šï¼ˆæˆ–åªæœ‰å·²çŸ¥çš„å¯æ¥å—è­¦å‘Šï¼‰
- [ ] å‰ç«¯æ„å»ºæ— é”™è¯¯ï¼š`cd Platform.Admin && npm run build`
- [ ] å‰ç«¯ lint æ£€æŸ¥é€šè¿‡ï¼š`cd Platform.Admin && npm run lint`

### ä»£ç è´¨é‡

- [ ] Program.cs åˆå§‹åŒ–ä»£ç åªæœ‰ 5 è¡Œ
- [ ] Scripts ç›®å½•åªæœ‰ 1 ä¸ªæ–‡ä»¶ï¼šCreateAllIndexes.cs
- [ ] Menu æ¨¡å‹ç»§æ‰¿ BaseEntityï¼ˆä¸æ˜¯ MultiTenantEntityï¼‰
- [ ] MenuService ä¸ä½¿ç”¨ BaseRepository
- [ ] æ²¡æœ‰èœå•ç®¡ç†ç›¸å…³çš„å‰ç«¯é¡µé¢
- [ ] routes.ts ä¸­ä¸šåŠ¡è·¯ç”±éƒ½æ ‡è®° hideInMenu: true

## ğŸ—„ï¸ æ•°æ®åº“æ£€æŸ¥

### ç©ºæ•°æ®åº“å¯åŠ¨

- [ ] æ¸…ç©ºæ•°æ®åº“ï¼š`mongo aspire-admin --eval "db.dropDatabase()"`
- [ ] å¯åŠ¨åº”ç”¨ï¼š`dotnet run --project Platform.AppHost`
- [ ] æ£€æŸ¥èœå•æ•°é‡ï¼š`db.menus.countDocuments()` = 6
- [ ] æ£€æŸ¥èœå•æ—  CompanyIdï¼š`db.menus.findOne({}, {companyId: 1})` æ— æ­¤å­—æ®µ
- [ ] æ£€æŸ¥ç³»ç»Ÿé”ï¼š`db.system_locks.countDocuments()` = 1
- [ ] æ£€æŸ¥æ— é»˜è®¤ä¼ä¸šï¼š`db.companies.countDocuments()` = 0
- [ ] å¯åŠ¨æ—¶é—´ < 5ç§’

### ç”¨æˆ·æ³¨å†Œæµ‹è¯•

- [ ] è®¿é—®æ³¨å†Œé¡µé¢æ­£å¸¸
- [ ] æ³¨å†Œæ–°ç”¨æˆ·æˆåŠŸ
- [ ] æ£€æŸ¥ä¼ä¸šåˆ›å»ºï¼š`db.companies.countDocuments()` = 1
- [ ] æ£€æŸ¥æƒé™æ•°é‡ï¼š`db.permissions.countDocuments()` = 24ï¼ˆä¸æ˜¯32ï¼‰
- [ ] æ£€æŸ¥è§’è‰²åˆ›å»ºï¼š`db.roles.countDocuments()` = 1
- [ ] æ£€æŸ¥èœå•ä¸å¢åŠ ï¼š`db.menus.countDocuments()` = 6ï¼ˆä»ç„¶ï¼‰
- [ ] æ£€æŸ¥ UserCompany åˆ›å»ºï¼š`db.user_companies.countDocuments()` = 1

### èœå•æ˜¾ç¤ºæµ‹è¯•

- [ ] ç™»å½•åçœ‹åˆ°èœå•
- [ ] å·¦ä¾§æ˜¾ç¤º 6 ä¸ªèœå•é¡¹
- [ ] æ§åˆ¶å°æ˜¾ç¤ºï¼š"âœ… ä½¿ç”¨æ•°æ®åº“èœå•"
- [ ] æ§åˆ¶å°ä¸æ˜¾ç¤ºï¼š"Using default menus"
- [ ] æ‰€æœ‰èœå•éƒ½èƒ½æ­£ç¡®è·³è½¬
- [ ] æ²¡æœ‰ 404 é”™è¯¯

## ğŸ”’ å¹¶å‘å®‰å…¨æ£€æŸ¥

### å¤šå®ä¾‹å¯åŠ¨

- [ ] è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`./test-concurrent-startup.sh`
- [ ] åªæœ‰ 1 ä¸ªå®ä¾‹æ‰§è¡Œåˆå§‹åŒ–
- [ ] å…¶ä»–å®ä¾‹æ—¥å¿—æ˜¾ç¤ºï¼š"é”å·²è¢«å…¶ä»–å®ä¾‹æŒæœ‰ï¼Œè·³è¿‡æ‰§è¡Œ"
- [ ] æ‰€æœ‰å®ä¾‹æ­£å¸¸å¯åŠ¨
- [ ] æ•°æ®åº“ä¸­åªæœ‰ 1 æ¡é”è®°å½•
- [ ] èœå•æ•°é‡ä»ä¸º 6ï¼ˆæ— é‡å¤åˆ›å»ºï¼‰

### åˆ†å¸ƒå¼é”æµ‹è¯•

- [ ] é”é›†åˆå­˜åœ¨ï¼š`db.system_locks.find().pretty()`
- [ ] é”æœ‰ TTL ç´¢å¼•ï¼š`db.system_locks.getIndexes()`
- [ ] é”æœ‰ LockName å”¯ä¸€ç´¢å¼•
- [ ] é”èƒ½è‡ªåŠ¨è¿‡æœŸ

## ğŸ“Š ç´¢å¼•æ£€æŸ¥

### å…³é”®ç´¢å¼•

- [ ] companies.code å”¯ä¸€ç´¢å¼•
- [ ] users.username å…¨å±€å”¯ä¸€ç´¢å¼•
- [ ] users.email å…¨å±€å”¯ä¸€ç´¢å¼•ï¼ˆsparseï¼‰
- [ ] menus.name å…¨å±€å”¯ä¸€ç´¢å¼•
- [ ] roles.companyId + name å”¯ä¸€ç´¢å¼•
- [ ] permissions.companyId + code å”¯ä¸€ç´¢å¼•
- [ ] user_companies.userId + companyId å”¯ä¸€ç´¢å¼•

éªŒè¯æ–¹æ³•ï¼š
```javascript
db.companies.getIndexes()
db.users.getIndexes()
db.menus.getIndexes()
db.roles.getIndexes()
db.permissions.getIndexes()
```

## ğŸ¯ åŠŸèƒ½æµ‹è¯•

### èœå•ç›¸å…³

- [ ] ç®¡ç†å‘˜çœ‹åˆ°æ‰€æœ‰èœå•
- [ ] åˆ›å»ºå—é™è§’è‰²ï¼Œåªåˆ†é…éƒ¨åˆ† MenuIds
- [ ] å—é™ç”¨æˆ·åªçœ‹åˆ°åˆ†é…çš„èœå•
- [ ] èœå•ç®¡ç†é¡µé¢å·²åˆ é™¤ï¼ˆè®¿é—® /system/menu-management åº” 404ï¼‰
- [ ] å°è¯•åˆ›å»ºèœå•è¿”å› 404ï¼ˆAPI ä¸å­˜åœ¨ï¼‰

### æƒé™ç›¸å…³

- [ ] æŸ¥çœ‹æƒé™åˆ—è¡¨ä¸åŒ…å« menu:* æƒé™
- [ ] æŸ¥çœ‹æƒé™åˆ—è¡¨ä¸åŒ…å« permission:* æƒé™
- [ ] æƒé™æ€»æ•°ä¸º 24ï¼ˆ6èµ„æº Ã— 4æ“ä½œï¼‰
- [ ] æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ

### ç”¨æˆ·ç®¡ç†

- [ ] åˆ›å»ºç”¨æˆ·æˆåŠŸ
- [ ] ç¼–è¾‘ç”¨æˆ·æˆåŠŸ
- [ ] åˆ é™¤ç”¨æˆ·æˆåŠŸ
- [ ] ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- [ ] æƒé™è¿‡æ»¤æ­£å¸¸

## ğŸ“ æ–‡æ¡£æ£€æŸ¥

### æ–‡æ¡£å®Œæ•´æ€§

- [ ] å­˜åœ¨ `docs/V5-QUICK-REFERENCE.md`
- [ ] å­˜åœ¨ `docs/V5-ACCEPTANCE-CHECKLIST.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- [ ] å­˜åœ¨ `docs/reports/V5-OPTIMIZATION-COMPLETE.md`
- [ ] å­˜åœ¨ `docs/features/GLOBAL-MENU-ARCHITECTURE.md`
- [ ] å­˜åœ¨ `docs/features/MENU-RENDERING-MECHANISM.md`
- [ ] å­˜åœ¨ `docs/features/DYNAMIC-MENU-ONLY.md`
- [ ] å­˜åœ¨ `docs/optimization/DATABASE-INITIALIZATION-OPTIMIZATION.md`

### Cursor Rules

- [ ] å­˜åœ¨ `.cursor/rules/database-initialization.mdc`
- [ ] å­˜åœ¨ `.cursor/rules/distributed-lock-usage.mdc`
- [ ] å­˜åœ¨ `.cursor/rules/mongodb-atomic-operations.mdc`
- [ ] å­˜åœ¨ `.cursor/rules/multi-instance-deployment.mdc`
- [ ] å­˜åœ¨ `.cursor/rules/global-menu-architecture.mdc`
- [ ] `.cursor/rules/README.md` å·²æ›´æ–°ä¸º 32 ä¸ªè§„åˆ™

## ğŸš€ éƒ¨ç½²æ£€æŸ¥

### å¼€å‘ç¯å¢ƒ

- [ ] `dotnet run --project Platform.AppHost` æ­£å¸¸å¯åŠ¨
- [ ] Aspire Dashboard å¯è®¿é—®ï¼šhttp://localhost:15003
- [ ] ç®¡ç†åå°å¯è®¿é—®ï¼šhttp://localhost:15001
- [ ] API ç½‘å…³å¯è®¿é—®ï¼šhttp://localhost:15000
- [ ] API æ–‡æ¡£å¯è®¿é—®ï¼šhttp://localhost:15000/scalar/v1

### ç”Ÿäº§ç¯å¢ƒå‡†å¤‡

- [ ] Docker é•œåƒæ„å»ºæˆåŠŸ
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´
- [ ] MongoDB è¿æ¥å­—ç¬¦ä¸²æ­£ç¡®
- [ ] JWT SecretKey å·²é…ç½®
- [ ] CORS é…ç½®é€‚åˆç”Ÿäº§ç¯å¢ƒ
- [ ] æ—¥å¿—çº§åˆ«é€‚åˆç”Ÿäº§ç¯å¢ƒ

## ğŸ¯ æ€§èƒ½éªŒè¯

### å¯åŠ¨æ€§èƒ½

- [ ] é¦–æ¬¡å¯åŠ¨ï¼ˆç©ºæ•°æ®åº“ï¼‰< 5ç§’
- [ ] åç»­å¯åŠ¨ < 1ç§’
- [ ] å¤šå®ä¾‹å¹¶å‘å¯åŠ¨å®‰å…¨æ— å†²çª

### è¿è¡Œæ€§èƒ½

- [ ] ç”¨æˆ·æ³¨å†Œ < 1ç§’
- [ ] ç”¨æˆ·ç™»å½• < 0.5ç§’
- [ ] è·å–èœå• < 100ms
- [ ] API å“åº”æ­£å¸¸

## ğŸ” å®‰å…¨æ£€æŸ¥

### æ•°æ®éš”ç¦»

- [ ] ä¸åŒä¼ä¸šæ•°æ®å®Œå…¨éš”ç¦»
- [ ] æ— æ³•è·¨ä¼ä¸šè®¿é—®æ•°æ®
- [ ] èœå•è™½æ˜¯å…¨å±€ï¼Œä½†é€šè¿‡æƒé™æ§åˆ¶

### æƒé™ç³»ç»Ÿ

- [ ] æƒé™æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- [ ] æ— æƒé™æ—¶è¿”å› 403
- [ ] æƒé™ä¸èœå•å¯¹åº”æ­£ç¡®

## ğŸ“Š éªŒæ”¶ç»“è®º

### æ£€æŸ¥ç»“æœ

- æ€»æ£€æŸ¥é¡¹ï¼šçº¦ 70 é¡¹
- é€šè¿‡é¡¹ï¼š_____ é¡¹
- å¤±è´¥é¡¹ï¼š_____ é¡¹
- é€šè¿‡ç‡ï¼š_____ %

### éªŒæ”¶å†³å®š

- [ ] âœ… é€šè¿‡éªŒæ”¶ï¼Œå¯ä»¥å‘å¸ƒ
- [ ] âš ï¸ æœ‰å°é—®é¢˜ï¼Œä½†å¯æ¥å—
- [ ] âŒ ä¸é€šè¿‡ï¼Œéœ€è¦ä¿®å¤

### å¤‡æ³¨

```
___________________________________________________
___________________________________________________
___________________________________________________
```

---

**æ£€æŸ¥äººç­¾å**: __________  
**æ—¥æœŸ**: __________  
**çŠ¶æ€**: [ ] é€šè¿‡ [ ] ä¸é€šè¿‡

