# MCP 服务使用指南 - 与小科查询数据

## 概述

MCP（Model Context Protocol）服务已集成到"小科"AI 助手中，现在你可以通过自然语言与小科对话来查询系统中的各种数据。

## 可用查询模块

### 1. 用户管理模块

#### 查询用户信息
**示例对话：**
- "帮我查一下用户 admin 的信息"
- "查询用户ID为 xxx 的详细信息"
- "查找邮箱是 xxx@example.com 的用户"

**小科会使用：** `get_user_info` 工具

#### 搜索用户列表
**示例对话：**
- "搜索所有用户"
- "查找名字包含'张'的用户"
- "显示所有活跃用户"
- "查询第2页的用户列表，每页20条"

**小科会使用：** `search_users` 工具

---

### 2. 角色管理模块

#### 获取所有角色
**示例对话：**
- "有哪些角色？"
- "显示所有角色列表"
- "查询所有角色，包括每个角色有多少用户"
- "获取角色列表，包含统计信息"

**小科会使用：** `get_all_roles` 工具

#### 查询角色详细信息
**示例对话：**
- "查询角色ID为 xxx 的详细信息"
- "角色 admin 有哪些权限？"
- "查看角色 xxx 关联了哪些菜单"

**小科会使用：** `get_role_info` 工具

---

### 3. 企业管理模块

#### 查询企业信息
**示例对话：**
- "查询当前企业信息"
- "获取企业ID为 xxx 的详细信息"
- "查看我们公司的信息"

**小科会使用：** `get_company_info` 工具

#### 搜索企业
**示例对话：**
- "搜索名称包含'科技'的企业"
- "查找企业代码为 xxx 的企业"
- "搜索所有企业"

**小科会使用：** `search_companies` 工具

---

### 4. 我的活动模块

#### 查询活动日志
**示例对话：**
- "查看我的活动记录"
- "显示我最近的登录记录"
- "查询我今天的所有操作"
- "查看我上个月的活动日志"
- "显示我的操作记录，只显示登录和登出"
- "查询2024年1月1日到1月31日的活动记录"

**小科会使用：** `get_my_activity_logs` 工具

**支持的筛选条件：**
- 操作类型（action）：如 `login`、`logout`、`create`、`update`、`delete` 等
- 开始日期（startDate）：ISO 8601 格式，如 `2024-01-01T00:00:00Z`
- 结束日期（endDate）：ISO 8601 格式
- 分页：页码（page）和每页数量（pageSize）

---

### 5. 聊天模块

#### 查询聊天会话
**示例对话：**
- "显示我的所有聊天会话"
- "查找包含'项目'关键词的会话"

**小科会使用：** `get_chat_sessions` 工具

#### 查询聊天消息
**示例对话：**
- "查看会话 xxx 的所有消息"
- "显示会话 xxx 的第2页消息"

**小科会使用：** `get_chat_messages` 工具

---

### 6. 社交模块

#### 查询附近用户
**示例对话：**
- "查找我附近2公里内的用户"
- "搜索坐标 (30.27415, 120.15515) 附近1000米内的用户"

**小科会使用：** `get_nearby_users` 工具

---

## 使用技巧

### 1. 自然语言查询
直接使用自然语言描述你的需求，小科会自动选择合适的工具：

```
你：有哪些角色？
小科：[使用 get_all_roles 工具] 系统中目前有以下角色：...
```

### 2. 组合查询
可以连续提问，小科会记住上下文：

```
你：查询角色 admin 的详细信息
小科：[使用 get_role_info 工具] 角色 admin 的信息如下：...

你：这个角色有多少用户？
小科：[使用 get_all_roles 工具，包含统计信息] 角色 admin 目前有 X 个用户
```

### 3. 筛选和分页
在查询时可以使用筛选条件：

```
你：查询我最近10条登录记录
小科：[使用 get_my_activity_logs 工具，action=login, pageSize=10] 你的最近登录记录如下：...
```

### 4. 时间范围查询
可以指定时间范围查询活动日志：

```
你：查询我2024年1月的所有操作
小科：[使用 get_my_activity_logs 工具，startDate=2024-01-01, endDate=2024-01-31] 你在2024年1月的活动记录如下：...
```

---

## 完整示例对话

### 示例 1：查询角色信息

```
你：系统中有哪些角色？
小科：[使用 get_all_roles 工具]
系统中目前有以下角色：
1. admin - 管理员角色
2. user - 普通用户角色
3. guest - 访客角色

你：查询 admin 角色的详细信息
小科：[使用 get_role_info 工具]
角色 admin 的详细信息：
- 角色ID: xxx
- 角色名称: admin
- 角色标题: 管理员
- 描述: 系统管理员，拥有所有权限
- 关联菜单数: 25
- 菜单ID列表: [menu1, menu2, ...]
```

### 示例 2：查询我的活动

```
你：查看我今天的活动记录
小科：[使用 get_my_activity_logs 工具，startDate=今天]
你今天共有 15 条活动记录：
1. 08:30 - login - 用户登录
2. 09:15 - create - 创建用户
3. 10:20 - update - 更新角色
...

你：只显示登录和登出操作
小科：[使用 get_my_activity_logs 工具，action=login]
你的登录记录：
1. 08:30 - login - 用户登录
2. 12:00 - logout - 用户登出
3. 13:30 - login - 用户登录
```

### 示例 3：查询企业信息

```
你：查询当前企业信息
小科：[使用 get_company_info 工具]
当前企业信息：
- 企业ID: xxx
- 企业名称: 示例科技有限公司
- 企业代码: EXAMPLE001
- 描述: 专注于企业级管理平台开发

你：搜索名称包含'科技'的企业
小科：[使用 search_companies 工具，keyword=科技]
找到以下企业：
1. 示例科技有限公司
2. 创新科技有限公司
```

### 示例 4：查询用户列表

```
你：搜索所有用户，显示前10个
小科：[使用 search_users 工具，pageSize=10]
找到以下用户（共 50 个，显示前 10 个）：
1. admin - admin@example.com
2. user1 - user1@example.com
...

你：查找名字包含'张'的用户
小科：[使用 search_users 工具，keyword=张]
找到以下用户：
1. 张三 - zhang@example.com
2. 张四 - zhangsi@example.com
```

---

## 注意事项

1. **权限控制**：所有查询都基于当前登录用户的权限，只能查询有权限访问的数据
2. **多租户隔离**：查询结果会自动过滤，只显示当前企业的数据
3. **分页限制**：默认每页 20 条，最大 100 条（活动日志最大 100 条，消息最大 200 条）
4. **时间格式**：使用 ISO 8601 格式，如 `2024-01-01T00:00:00Z`

---

## 技术实现

MCP 服务通过以下 API 端点提供：

- `POST /api/mcp/initialize` - 初始化 MCP 服务器
- `POST /api/mcp/tools/list` - 列出所有可用工具
- `POST /api/mcp/tools/call` - 调用工具
- `POST /api/mcp/resources/list` - 列出所有可用资源
- `POST /api/mcp/resources/read` - 读取资源
- `POST /api/mcp/prompts/list` - 列出所有可用提示词
- `POST /api/mcp/prompts/get` - 获取提示词

所有端点都需要 JWT 认证，请在请求头中包含：
```
Authorization: Bearer <your-jwt-token>
```

---

## 更新日志

- **2024-01-XX**: 初始版本，支持用户、聊天、社交模块查询
- **2024-01-XX**: 新增角色管理、企业管理、我的活动模块查询功能

