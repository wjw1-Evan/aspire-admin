# 用户加入系统指南

## 🎯 概述

在多租户架构下，所有用户必须关联到某个企业。本文档说明用户如何加入系统。

## 📋 用户加入方式

### 方式1：注册新企业（成为管理员）⭐ 推荐

**适用场景：** 您是企业负责人，需要为您的公司创建账户

**步骤：**

1. **访问企业注册页面**
   ```
   http://localhost:15001/company/register
   ```

2. **填写企业信息**
   - 企业名称
   - 企业代码（唯一标识，注册后不可修改）
   - 所属行业（可选）
   - 联系信息（可选）

3. **设置管理员账户**
   - 管理员用户名
   - 管理员密码
   - 管理员邮箱

4. **提交注册**
   - 系统自动创建企业
   - 创建默认权限和角色
   - 创建管理员账户
   - 自动登录

5. **开始使用**
   - 您将成为企业管理员
   - 可以创建和管理企业用户
   - 拥有所有管理权限

### 方式2：管理员创建用户（加入现有企业）

**适用场景：** 您要加入已有企业，由管理员创建账户

**步骤（管理员操作）：**

1. **登录系统**
   - 使用管理员账户登录

2. **创建新用户**
   - 访问"系统设置" → "用户管理"
   - 点击"新建用户"按钮

3. **填写用户信息**
   ```
   用户名：newuser
   密码：User@123
   邮箱：user@example.com
   角色：选择适当的角色
   状态：启用
   ```

4. **保存用户**
   - 系统自动将用户关联到当前企业
   - CompanyId 自动设置

5. **通知新用户**
   - 将用户名和密码发送给新用户
   - 新用户可以登录系统

**步骤（新用户操作）：**

1. **接收凭证**
   - 从管理员处获取用户名和密码

2. **登录系统**
   ```
   http://localhost:15001/user/login
   ```

3. **修改密码**
   - 首次登录后建议修改密码
   - 访问"个人中心" → "修改密码"

### 方式3：邀请码注册（计划中 v3.1+）

**适用场景：** 通过邀请链接自助注册

**流程（规划中）：**

1. **管理员生成邀请码**
   - 在系统中生成邀请链接
   - 设置默认角色和有效期

2. **发送邀请链接**
   - 将链接发送给新用户
   - 如：`/user/register?code=INVITE123`

3. **新用户注册**
   - 点击邀请链接
   - 填写用户信息
   - 提交注册

4. **审核（可选）**
   - 如设置需要审核
   - 管理员审核通过后激活

5. **开始使用**
   - 自动加入企业
   - 登录系统

## ❌ 个人注册已禁用

### 为什么禁用？

在 v3.0 多租户架构下，用户必须属于某个企业才能正常使用系统。个人注册无法确定用户应该加入哪个企业，因此已禁用。

### 访问 /user/register 会看到什么？

访问个人注册页面时，您会看到：

```
┌─────────────────────────────────┐
│   个人注册已禁用                 │
│                                 │
│   在多租户架构下，用户需要       │
│   关联到企业。请选择以下方式     │
│   加入系统：                     │
│                                 │
│   [注册新企业]  [返回登录]      │
│                                 │
│   💡 如何加入系统？              │
│                                 │
│   方式1：注册新企业              │
│   如果您是企业管理员，点击       │
│   "注册新企业"...               │
│                                 │
│   方式2：加入现有企业            │
│   请联系企业管理员为您创建       │
│   账户...                       │
└─────────────────────────────────┘
```

### API 响应

调用 `POST /api/register` 会返回：

```json
{
  "success": false,
  "errorCode": "REGISTRATION_DISABLED",
  "errorMessage": "个人注册功能已禁用。\n\n如需加入系统，请：\n• 注册新企业：访问企业注册页面创建您的企业账户\n• 加入现有企业：联系企业管理员为您创建账户\n\n未来版本将支持邀请码注册功能。"
}
```

## 🔄 用户生命周期

### 1. 企业管理员

```
企业注册 → 自动成为管理员 → 拥有所有权限 → 可以创建和管理用户
```

### 2. 普通用户（管理员创建）

```
管理员创建用户
    ↓
设置用户名、密码、角色
    ↓
通知用户凭证
    ↓
用户登录
    ↓
（可选）修改密码
    ↓
开始使用系统
```

### 3. 普通用户（未来：邀请码）

```
管理员生成邀请码
    ↓
发送邀请链接
    ↓
用户点击链接注册
    ↓
填写个人信息
    ↓
（可选）等待审核
    ↓
激活后登录使用
```

## 📖 最佳实践

### 对于企业管理员

**1. 创建用户账户**
```
系统设置 → 用户管理 → 新建用户
```

**2. 设置合适的角色**
- 根据用户职责分配角色
- 避免过度授权

**3. 通知新用户**
- 发送用户名和初始密码
- 建议用户首次登录后修改密码

**4. 定期审查**
- 定期检查用户列表
- 停用离职员工账户
- 删除不再需要的账户

### 对于新用户

**1. 获取凭证**
- 联系企业管理员
- 获取用户名和密码

**2. 首次登录**
```
http://localhost:15001/user/login
```

**3. 修改密码**
- 个人中心 → 修改密码
- 设置一个安全的密码

**4. 完善资料**
- 个人中心 → 编辑资料
- 更新邮箱、姓名等信息

## 🔐 安全建议

### 密码安全

- ✅ 使用强密码（至少6个字符）
- ✅ 包含字母、数字
- ✅ 首次登录后立即修改初始密码
- ✅ 定期更新密码

### 账户安全

- ✅ 不要共享账户
- ✅ 离职时通知管理员停用账户
- ✅ 定期检查账户活动日志

## 📊 对比：企业注册 vs 用户创建

| 特性 | 企业注册 | 管理员创建用户 |
|------|----------|---------------|
| 创建企业 | ✅ 是 | ❌ 否 |
| 创建用户 | ✅ 是（管理员） | ✅ 是 |
| 成为管理员 | ✅ 自动 | ❌ 取决于分配的角色 |
| 默认权限 | ✅ 所有权限 | ❌ 根据角色 |
| 默认菜单 | ✅ 5个基础菜单 | ❌ 使用企业现有菜单 |
| 使用场景 | 首次使用，创建企业 | 添加企业成员 |

## 🚧 v3.1 规划：邀请码系统

### 功能特性

- ✅ 管理员生成邀请码
- ✅ 设置邀请码有效期
- ✅ 设置最大使用次数
- ✅ 设置默认角色
- ✅ 可选：审核机制
- ✅ 邀请记录和统计

### 使用流程

**管理员端：**
```
1. 访问"邀请管理"
2. 点击"生成邀请码"
3. 设置有效期和默认角色
4. 复制邀请链接
5. 发送给新用户
```

**用户端：**
```
1. 收到邀请链接
2. 点击链接访问注册页
3. 填写用户名、密码、邮箱
4. 提交注册
5. 自动加入企业
```

### 实施计划

**预计时间：** v3.1 版本  
**工作量：** 2-3天

## 📞 常见问题

### Q: 我要注册账号，应该访问哪个页面？

**A:** 取决于您的情况：
- **创建新企业**：访问 `/company/register`
- **加入现有企业**：联系企业管理员，由管理员在系统中创建账户

### Q: 为什么不能个人注册？

**A:** 在多租户架构下，用户必须属于某个企业。个人注册无法确定应该加入哪个企业，因此已禁用。未来将提供邀请码注册功能。

### Q: 如何添加新员工？

**A:** 作为企业管理员：
1. 登录系统
2. 访问"用户管理"
3. 点击"新建用户"
4. 填写员工信息
5. 将用户名和密码发送给员工

### Q: 用户可以同时属于多个企业吗？

**A:** 当前版本（v3.0）不支持。一个用户只能属于一个企业。未来版本可能支持跨企业切换。

### Q: 离职员工如何处理？

**A:** 管理员应该：
1. 停用用户账户（而非删除）
2. 或者软删除用户
3. 保留活动日志用于审计

## 📚 相关文档

- [用户加入企业设计](./USER-JOIN-COMPANY-DESIGN.md) - 详细的技术设计
- [多租户系统文档](./MULTI-TENANT-SYSTEM.md) - 系统架构说明
- [API 端点汇总](./API-ENDPOINTS-SUMMARY.md) - API 接口文档

---

**版本**: v3.0  
**更新时间**: 2025-01-13  
**状态**: ✅ 已实施

